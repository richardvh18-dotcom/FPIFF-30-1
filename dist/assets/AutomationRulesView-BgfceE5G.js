import{c as ie,e as c,d as u,j as e,A as oe,f as $,k as ee,Z as te}from"./index-DNbqce-j.js";import{r as _}from"./react-vendor-CkwvfVK2.js";import{k as S,j as h,s as N,l as D,y as M,D as v,q as U,w as C,o as ae,B as de}from"./firebase-DdpHYWNd.js";import{U as le}from"./upload-DE5XOlRL.js";import{P as ce}from"./plus-fTGSighL.js";import{S as ue}from"./square-pen-D8PjMHhY.js";import{P as pe}from"./play-CtmZkelb.js";import{T as ge}from"./trash-2-CmT6fCSF.js";import{B as me,T as xe}from"./trending-down-BdnZJ9c2.js";import{C as se}from"./clock-yngyoSLs.js";import{U as he}from"./users-BzjIxhpA.js";import{A as be}from"./alert-triangle-BUFzzSRW.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=ie("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),fe=async i=>{const{threshold:s=0}=i,l=await v(h(c,...u.OCCUPANCY)),o=await v(h(c,...u.PLANNING)),d=l.docs.map(y=>y.data()),n=o.docs.map(y=>y.data()),r=d.reduce((y,f)=>y+(f.hoursPerWeek||0),0),m=n.reduce((y,f)=>y+(f.estimatedHours||0),0),g=m-r;return{triggered:g>s,message:g>s?`âš ï¸ Capaciteitstekort: ${Math.round(g)}h tekort (threshold: ${s}h)`:null,severity:"warning",data:{totalCapacity:r,totalDemand:m,shortage:g}}},ve=async i=>{const{threshold:s=80}=i,o=(await v(h(c,...u.OCCUPANCY))).docs.map(r=>r.data()),d=o.reduce((r,m)=>{const g=m.productionHours>0?(m.actualHours||0)/m.productionHours:0;return r+g},0)/(o.length||1),n=Math.round(d*100);return{triggered:n<s,message:n<s?`ðŸ“‰ Lage efficiency: ${n}% (threshold: ${s}%)`:null,severity:"warning",data:{avgEfficiency:n,threshold:s}}},je=async i=>{const{minDelayedOrders:s=1}=i,o=(await v(h(c,...u.PLANNING))).docs.map(r=>({id:r.id,...r.data()})),d=new Date,n=o.filter(r=>!r.plannedDate||r.status==="shipped"||r.status==="completed"?!1:(r.plannedDate.toDate?r.plannedDate.toDate():new Date(r.plannedDate))<d);return{triggered:n.length>=s,message:n.length>=s?`ðŸ• ${n.length} order(s) zijn vertraagd`:null,severity:"critical",data:{delayedCount:n.length,delayedOrderIds:n.map(r=>r.orderId).slice(0,5)}}},Ne=async i=>{const{threshold:s=1}=i,d=(await v(h(c,...u.OCCUPANCY))).docs.map(n=>n.data()).filter(n=>!n.operatorName||n.operatorName==="");return{triggered:d.length>=s,message:d.length>=s?`ðŸ‘¤ ${d.length} machine(s) zonder operator`:null,severity:"warning",data:{count:d.length,machines:d.map(n=>n.station||n.machine).slice(0,5)}}},we=async i=>{const{threshold:s=1}=i,o=(await v(h(c,...u.PLANNING))).docs.map(n=>({id:n.id,...n.data()})),d=o.filter(n=>!n.dependencies||n.dependencies.length===0||n.status==="shipped"||n.status==="completed"?!1:!n.dependencies.every(m=>{const g=o.find(y=>y.id===m);return g&&(g.status==="shipped"||g.status==="completed")}));return{triggered:d.length>=s,message:d.length>=s?`ðŸ”— ${d.length} order(s) geblokkeerd door dependencies`:null,severity:"info",data:{blockedCount:d.length,blockedOrderIds:d.map(n=>n.orderId).slice(0,5)}}},_e=async i=>{const{daysOverdue:s=7,station:l=null}=i,n=(await v(h(c,...u.TRACKING))).docs.map(r=>({id:r.id,...r.data()})).filter(r=>{var j,a;if(l&&r.currentStation!==l||!(((j=r.inspection)==null?void 0:j.status)==="Tijdelijke afkeur"))return!1;const g=(a=r.inspection)==null?void 0:a.timestamp;if(!g)return!1;const y=new Date(g);return Math.floor((Date.now()-y.getTime())/(1e3*60*60*24))>=s&&!r.reminderSent});return{triggered:n.length>0,message:n.length>0?`â° ${n.length} product(en) ${s}+ dagen in tijdelijke afkeur`:null,severity:"alert",data:{overdueCount:n.length,products:n.map(r=>({lotNumber:r.lotNumber,station:r.currentStation,daysSince:Math.floor((Date.now()-new Date(r.inspection.timestamp).getTime())/(1e3*60*60*24))})).slice(0,5)}}},Se=async i=>{const{minSamples:s=5,minDeviation:l=5}=i,d=(await v(h(c,...u.PRODUCTION_STANDARDS))).docs.map(r=>({id:r.id,...r.data()})),n=[];for(const r of d){const m=U(h(c,...u.TRACKING),C("item","==",r.itemCode),C("originMachine","==",r.machine),C("status","==","completed")),f=(await v(m)).docs.map(b=>b.data()).filter(b=>{var w,A,k;return((w=b.timestamps)==null?void 0:w.station_start)&&(((A=b.timestamps)==null?void 0:A.completed)||((k=b.timestamps)==null?void 0:k.finished))});if(f.length<s)continue;const j=f.map(b=>{var k,T;const w=b.timestamps.station_start.toDate?b.timestamps.station_start.toDate():new Date(b.timestamps.station_start),A=(k=b.timestamps.completed)!=null&&k.toDate?b.timestamps.completed.toDate():(T=b.timestamps.finished)!=null&&T.toDate?b.timestamps.finished.toDate():new Date(b.timestamps.completed||b.timestamps.finished);return Math.round((A-w)/6e4)}).filter(b=>b>0);if(j.length===0)continue;const a=[...j].sort((b,w)=>b-w),p=a[Math.floor(a.length/2)],I=r.standardMinutes,R=(p-I)/I*100;Math.abs(R)>=l&&n.push({itemCode:r.itemCode,machine:r.machine,currentStandard:I,observedMedian:p,deviation:Math.round(R*10)/10,sampleCount:j.length})}return{triggered:n.length>0,message:n.length>0?`ðŸ“Š ${n.length} standaard(en) wijken significant af`:null,severity:"info",data:{deviatingCount:n.length,standards:n.slice(0,5)}}},ke=async i=>{const{targetStatus:s="in_production",orderId:l=null}=i,n=(await v(h(c,...u.PLANNING))).docs.map(r=>({id:r.id,...r.data()})).filter(r=>l&&r.orderId!==l?!1:r.status===s);return{triggered:n.length>0,message:n.length>0?`ðŸ“‹ ${n.length} order(s) hebben status "${s}"`:null,severity:"info",data:{count:n.length,orderIds:n.map(r=>r.orderId).slice(0,5)}}},Ae=async(i,s)=>{const{message:l="Automation regel uitgevoerd",severity:o="info",recipients:d=[]}=i;return await S(h(c,...u.NOTIFICATION_LOGS),{message:l||s.message,severity:o||s.severity,recipients:d,type:"automation",status:"unread",createdAt:N(),data:s.data}),await S(h(c,...u.MESSAGES),{to:"admin",subject:`ðŸ”” Automation: ${s.message||"Systeem Alert"}`,content:l||s.message,senderId:"system_automation",senderName:"Automation Engine",from:"system@futurefactory.local",timestamp:N(),read:!1,archived:!1,type:"automation_alert",priority:o==="critical"||o==="alert"?"urgent":"normal"}),{success:!0,message:"Notificatie verzonden"}},Ce=async(i,s)=>{const{targetCollection:l="planning",targetStatus:o="in_progress"}=i;return{success:!0,message:`Status update naar ${o} gepland`}},Ie=async(i,s)=>{const{logMessage:l="Automation log"}=i;return await S(h(c,...u.MESSAGES),{to:"admin",subject:"ðŸ¤– Automation Event",content:l||s.message,senderId:"system_automation",senderName:"Automation Engine",from:"system@futurefactory.local",timestamp:N(),read:!1,archived:!1,type:"system_log",priority:"normal",data:s.data}),{success:!0,message:"Log entry aangemaakt"}},Oe=async(i,s)=>{var r;const{learningRate:l=.3,dryRun:o=!0}=i;if(!((r=s.data)!=null&&r.standards))return{success:!1,message:"Geen standaarden gevonden in trigger data"};const d=s.data.standards;let n=0;for(const m of d){const g=m.currentStandard,y=m.observedMedian,f=(y-g)*l,j=Math.round(g+f);if(!o){const a=await v(U(h(c,...u.PRODUCTION_STANDARDS),C("itemCode","==",m.itemCode),C("machine","==",m.machine)));if(!a.empty){const p=a.docs[0];await M(D(c,...u.PRODUCTION_STANDARDS,p.id),{standardMinutes:j,updatedAt:N(),autoLearning:{lastUpdate:new Date().toISOString(),sampleCount:m.sampleCount,previousStandard:g,observedMedian:y,deviation:m.deviation}}),n++}}}return{success:!0,message:o?`${d.length} standaard(en) zouden bijgewerkt worden`:`${n} standaard(en) bijgewerkt`}},De=async(i,s)=>{var o;if(!((o=s.data)!=null&&o.products))return{success:!1,message:"Geen producten gevonden in trigger data"};let l=0;for(const d of s.data.products)await S(h(c,...u.MESSAGES),{to:"admin",subject:"â° Reminder: Tijdelijke Afkeur",content:`Product ${d.lotNumber} ligt al ${d.daysSince}+ dagen op ${d.station} ter reparatie. Graag actie.`,senderId:"system_automation",senderName:"Automation Engine",from:"system@futurefactory.local",timestamp:N(),read:!1,archived:!1,type:"alert",priority:"urgent",relatedLot:d.lotNumber}),l++;return{success:!0,message:`${l} reminder(s) verzonden`}},Re=async i=>{const{trigger:s,action:l}=i;let o;switch(s.type){case"capacity_shortage":o=await fe(s.conditions||{});break;case"low_efficiency":o=await ve(s.conditions||{});break;case"order_delay":o=await je(s.conditions||{});break;case"missing_operator":o=await Ne(s.conditions||{});break;case"dependency_blocked":o=await we(s.conditions||{});break;case"inspection_overdue":o=await _e(s.conditions||{});break;case"standard_deviation":o=await Se(s.conditions||{});break;case"order_status_change":o=await ke(s.conditions||{});break;default:return{triggered:!1,message:`Unknown trigger type: ${s.type}`}}if(o.triggered){let d;switch(l.type){case"send_notification":d=await Ae(l.params||{},o);break;case"create_log":d=await Ie(l.params||{},o);break;case"auto_learning_update":d=await Oe(l.params||{},o);break;case"inspection_reminder":d=await De(l.params||{},o);break;case"update_status":d=await Ce(l.params||{});break;default:d={success:!1,message:`Unknown action type: ${l.type}`}}return{...o,actionResult:d}}return o},Te=async(i,s=60)=>{const l=new Date(Date.now()-s*60*1e3);return(await v(U(h(c,...u.AUTOMATION_EXECUTIONS),C("ruleId","==",i)))).docs.map(n=>n.data()).filter(n=>n.executedAt?(n.executedAt.toDate?n.executedAt.toDate():new Date(n.executedAt))>l:!1).length>0},Me=async i=>{if(i.debounceMinutes&&await Te(i.id,i.debounceMinutes))return{skipped:!0,message:"Skipped due to recent execution (debounce)"};try{const s=await Re(i);if(await S(h(c,...u.AUTOMATION_EXECUTIONS),{ruleId:i.id,ruleName:i.name,trigger:i.trigger,action:i.action,status:s.triggered?"success":"no_trigger",message:s.message||"No trigger match",data:s.data||null,actionResult:s.actionResult||null,executedAt:N()}),s.triggered){const l=D(c,...u.AUTOMATION_RULES,i.id);await M(l,{executionCount:(i.executionCount||0)+1,lastExecuted:N()})}return s}catch(s){return console.error(`Error executing rule ${i.name}:`,s),await S(h(c,...u.AUTOMATION_EXECUTIONS),{ruleId:i.id,ruleName:i.name,trigger:i.trigger,action:i.action,status:"error",message:s.message,executedAt:N()}),{triggered:!1,error:s.message}}},qe=()=>{var z,G,P,B,W,H,V,X,q,F,K,Y,Z,Q,J;const[i,s]=_.useState([]),[l,o]=_.useState([]),[d,n]=_.useState(!1),[r,m]=_.useState(!1),[g,y]=_.useState(null),[f,j]=_.useState(!1),[a,p]=_.useState({name:"",trigger:{type:"capacity_shortage",conditions:{threshold:0}},action:{type:"send_notification",params:{severity:"warning"}},enabled:!0,debounceMinutes:60});_.useEffect(()=>{const t=ae(h(c,...u.AUTOMATION_RULES),E=>{const L=E.docs.map(O=>({id:O.id,...O.data()}));s(L)}),x=ae(h(c,...u.AUTOMATION_EXECUTIONS),E=>{const L=E.docs.map(O=>({id:O.id,...O.data()}));o(L.slice(0,100))});return()=>{t(),x()}},[]);const I=async()=>{if(!a.name){alert("Geef de regel een naam");return}g?await M(D(c,...u.AUTOMATION_RULES,g.id),{...a,updatedAt:N()}):await S(h(c,...u.AUTOMATION_RULES),{...a,createdAt:N(),executionCount:0,lastExecuted:null}),y(null),p({name:"",trigger:{type:"capacity_shortage",conditions:{threshold:0}},action:{type:"send_notification",params:{severity:"warning"}},enabled:!0,debounceMinutes:60}),n(!1)},R=t=>{y(t),p({...t}),n(!0)},b=async t=>{confirm("Weet je zeker dat je deze automation regel wilt verwijderen?")&&await de(D(c,...u.AUTOMATION_RULES,t))},w=async(t,x)=>{await M(D(c,...u.AUTOMATION_RULES,t),{enabled:!x})},A=async t=>{m(!0);try{const x=await Me(t);x.skipped?alert(`â¸ï¸ ${x.message}`):x.error?alert(`âŒ Error: ${x.error}`):x.triggered?alert(`âœ… Regel uitgevoerd!

${x.message||"Actie succesvol uitgevoerd"}`):alert(`â„¹ï¸ Trigger niet geactiveerd

${x.message||"Condities niet voldaan"}`)}catch(x){console.error("Test error:",x),alert(`âŒ Fout bij uitvoeren: ${x.message}`)}finally{m(!1)}},k=t=>({order_status_change:"Order Status Wijziging",capacity_threshold:"Capaciteit Threshold",time_based:"Tijd-gebaseerd",dependency_complete:"Dependency Voltooid",efficiency_drop:"Efficiency Daling",capacity_shortage:"Capaciteitstekort",low_efficiency:"Lage Efficiency",order_delay:"Order Vertraging",missing_operator:"Ontbrekende Operator",dependency_blocked:"Geblokkeerde Dependencies",inspection_overdue:"Inspectie Overdue",standard_deviation:"Standaard Afwijking"})[t.type]||t.type,T=t=>({send_notification:"Stuur Notificatie",update_status:"Update Status",assign_operator:"Wijs Operator Toe",reschedule_order:"Herplan Order",create_log:"Maak Log Entry",auto_learning_update:"Update Standaarden (AI)",inspection_reminder:"Stuur Inspectie Reminder"})[t.type]||t.type,ne=t=>({capacity_shortage:e.jsx(be,{className:"text-orange-600",size:14}),low_efficiency:e.jsx(xe,{className:"text-red-600",size:14}),order_delay:e.jsx(se,{className:"text-amber-600",size:14}),missing_operator:e.jsx(he,{className:"text-purple-600",size:14}),dependency_blocked:e.jsx(ye,{className:"text-blue-600",size:14}),inspection_overdue:e.jsx(se,{className:"text-red-600",size:14}),standard_deviation:e.jsx(me,{className:"text-indigo-600",size:14}),order_status_change:e.jsx($,{className:"text-emerald-600",size:14})})[t]||e.jsx(te,{className:"text-slate-600",size:14}),re=async()=>{if(!confirm("Dit importeert vooraf geconfigureerde automation rules gebaseerd op de oude hardcoded logica. Doorgaan?"))return;j(!0);const t=[{name:"âš ï¸ Capaciteitstekort Waarschuwing",trigger:{type:"capacity_shortage",conditions:{threshold:40}},action:{type:"send_notification",params:{severity:"warning"}},enabled:!0,debounceMinutes:60,description:"Gemigreerd van NotificationRulesView"},{name:"ðŸ“‰ Lage Efficiency Alert",trigger:{type:"low_efficiency",conditions:{threshold:80}},action:{type:"send_notification",params:{severity:"warning"}},enabled:!0,debounceMinutes:120,description:"Gemigreerd van NotificationRulesView"},{name:"ðŸ• Vertraagde Orders Notificatie",trigger:{type:"order_delay",conditions:{minDelayedOrders:1}},action:{type:"send_notification",params:{severity:"critical"}},enabled:!0,debounceMinutes:360,description:"Gemigreerd van NotificationRulesView"},{name:"ðŸ‘¤ Ontbrekende Operators Waarschuwing",trigger:{type:"missing_operator",conditions:{threshold:1}},action:{type:"send_notification",params:{severity:"warning"}},enabled:!0,debounceMinutes:60,description:"Gemigreerd van NotificationRulesView"},{name:"ðŸ”— Geblokkeerde Dependencies Alert",trigger:{type:"dependency_blocked",conditions:{threshold:1}},action:{type:"send_notification",params:{severity:"info"}},enabled:!0,debounceMinutes:180,description:"Gemigreerd van NotificationRulesView"},{name:"â° Inspectie Reminder (7+ dagen)",trigger:{type:"inspection_overdue",conditions:{daysOverdue:7}},action:{type:"inspection_reminder",params:{}},enabled:!0,debounceMinutes:1440,description:"Gemigreerd van WorkstationHub"},{name:"ðŸ“Š Productie Standaarden Afwijking Rapport",trigger:{type:"standard_deviation",conditions:{minSamples:5,minDeviation:5}},action:{type:"send_notification",params:{severity:"info"}},enabled:!0,debounceMinutes:10080,description:"Gemigreerd van autoLearningService (rapportage)"},{name:"ðŸ¤– AI Auto-Learning Standaarden (Dry Run)",trigger:{type:"standard_deviation",conditions:{minSamples:5,minDeviation:10}},action:{type:"auto_learning_update",params:{learningRate:.3,dryRun:!0}},enabled:!1,debounceMinutes:10080,description:"Gemigreerd van autoLearningService (TEST EERST!)"}];try{for(const x of t)await S(h(c,...u.AUTOMATION_RULES),{...x,createdAt:N(),executionCount:0,lastExecuted:null});alert(`âœ… ${t.length} standaard automation rules geÃ¯mporteerd!`)}catch(x){console.error("Import error:",x),alert(`âŒ Fout bij importeren: ${x.message}`)}finally{j(!1)}};return e.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border-2 border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-800",children:["Automation ",e.jsx("span",{className:"text-purple-600",children:"Rules"})]}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:'"When X happens, then Y" - Automatiseer acties op basis van triggers'})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"px-4 py-2 bg-purple-50 border-2 border-purple-200 rounded-xl",children:[e.jsx("div",{className:"text-xs text-purple-600 font-bold uppercase",children:"Active Rules"}),e.jsx("div",{className:"text-2xl font-black text-purple-600",children:i.filter(t=>t.enabled).length})]}),e.jsxs("button",{onClick:re,disabled:f,className:`flex items-center gap-2 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl font-bold transition-colors ${f?"opacity-50 cursor-not-allowed":""}`,title:"Importeer vooraf geconfigureerde rules van oude modules",children:[e.jsx(le,{size:16}),f?"Importeren...":"Importeer Defaults"]}),e.jsxs("button",{onClick:()=>{y(null),n(!d)},className:"flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-xl font-bold transition-colors",children:[e.jsx(ce,{size:16}),"Nieuwe Regel"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-2 space-y-4",children:[d&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-purple-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:g?"Automation Regel Bewerken":"Nieuwe Automation Regel"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase mb-2 block",children:"Regel Naam"}),e.jsx("input",{type:"text",placeholder:"Bijv: Auto-notify bij productie start",value:a.name,onChange:t=>p({...a,name:t.target.value}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase mb-2 block",children:"WHEN (Trigger)"}),e.jsxs("select",{value:a.trigger.type,onChange:t=>p({...a,trigger:{type:t.target.value,conditions:{}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm mb-2",children:[e.jsxs("optgroup",{label:"ðŸ“Š Capaciteit & Planning",children:[e.jsx("option",{value:"capacity_shortage",children:"Capaciteitstekort"}),e.jsx("option",{value:"low_efficiency",children:"Lage Efficiency"}),e.jsx("option",{value:"order_delay",children:"Order Vertraging"}),e.jsx("option",{value:"missing_operator",children:"Ontbrekende Operator"})]}),e.jsxs("optgroup",{label:"ðŸ”— Dependencies & Workflow",children:[e.jsx("option",{value:"dependency_blocked",children:"Geblokkeerde Dependencies"}),e.jsx("option",{value:"order_status_change",children:"Order Status Wijziging"})]}),e.jsx("optgroup",{label:"ðŸ” Kwaliteit & Inspectie",children:e.jsx("option",{value:"inspection_overdue",children:"Inspectie Overdue"})}),e.jsx("optgroup",{label:"ðŸ¤– AI & Learning",children:e.jsx("option",{value:"standard_deviation",children:"Standaard Afwijking"})}),e.jsx("optgroup",{label:"â° Tijd & Scheduling",children:e.jsx("option",{value:"time_based",children:"Tijd-gebaseerd"})})]}),a.trigger.type==="capacity_shortage"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Tekort threshold (uren)"}),e.jsx("input",{type:"number",placeholder:"Bijv: 40",value:((z=a.trigger.conditions)==null?void 0:z.threshold)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{threshold:parseInt(t.target.value)||0}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),a.trigger.type==="low_efficiency"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Minimum efficiency (%)"}),e.jsx("input",{type:"number",placeholder:"Bijv: 80",value:((G=a.trigger.conditions)==null?void 0:G.threshold)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{threshold:parseInt(t.target.value)||80}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),a.trigger.type==="order_delay"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Minimum vertraagde orders"}),e.jsx("input",{type:"number",placeholder:"Bijv: 1",value:((P=a.trigger.conditions)==null?void 0:P.minDelayedOrders)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{minDelayedOrders:parseInt(t.target.value)||1}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),a.trigger.type==="missing_operator"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Minimum machines zonder operator"}),e.jsx("input",{type:"number",placeholder:"Bijv: 1",value:((B=a.trigger.conditions)==null?void 0:B.threshold)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{threshold:parseInt(t.target.value)||1}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),a.trigger.type==="dependency_blocked"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Minimum geblokkeerde orders"}),e.jsx("input",{type:"number",placeholder:"Bijv: 1",value:((W=a.trigger.conditions)==null?void 0:W.threshold)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{threshold:parseInt(t.target.value)||1}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),a.trigger.type==="inspection_overdue"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Dagen overdue"}),e.jsx("input",{type:"number",placeholder:"Bijv: 7",value:((H=a.trigger.conditions)==null?void 0:H.daysOverdue)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{...a.trigger.conditions,daysOverdue:parseInt(t.target.value)||7}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"}),e.jsx("label",{className:"text-xs text-slate-600",children:"Station (optioneel)"}),e.jsx("input",{type:"text",placeholder:"Bijv: NABEWERKING",value:((V=a.trigger.conditions)==null?void 0:V.station)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{...a.trigger.conditions,station:t.target.value}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),a.trigger.type==="standard_deviation"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Minimum samples"}),e.jsx("input",{type:"number",placeholder:"Bijv: 5",value:((X=a.trigger.conditions)==null?void 0:X.minSamples)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{...a.trigger.conditions,minSamples:parseInt(t.target.value)||5}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"}),e.jsx("label",{className:"text-xs text-slate-600",children:"Minimum afwijking (%)"}),e.jsx("input",{type:"number",placeholder:"Bijv: 5",value:((q=a.trigger.conditions)==null?void 0:q.minDeviation)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{...a.trigger.conditions,minDeviation:parseInt(t.target.value)||5}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),a.trigger.type==="order_status_change"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Target status"}),e.jsxs("select",{value:((F=a.trigger.conditions)==null?void 0:F.targetStatus)||"",onChange:t=>p({...a,trigger:{...a.trigger,conditions:{targetStatus:t.target.value}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm",children:[e.jsx("option",{value:"planned",children:"Gepland"}),e.jsx("option",{value:"in_production",children:"In Productie"}),e.jsx("option",{value:"quality_check",children:"Controle"}),e.jsx("option",{value:"ready_to_ship",children:"Verzendklaar"}),e.jsx("option",{value:"shipped",children:"Verzonden"}),e.jsx("option",{value:"completed",children:"Voltooid"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase mb-2 block",children:"THEN (Action)"}),e.jsxs("select",{value:a.action.type,onChange:t=>p({...a,action:{type:t.target.value,params:{}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm mb-2",children:[e.jsx("option",{value:"send_notification",children:"Stuur Notificatie"}),e.jsx("option",{value:"create_log",children:"Maak Log Entry"}),e.jsx("option",{value:"inspection_reminder",children:"Stuur Inspectie Reminder"}),e.jsx("option",{value:"auto_learning_update",children:"Update Standaarden (AI)"}),e.jsx("option",{value:"update_status",children:"Update Status"}),e.jsx("option",{value:"assign_operator",children:"Wijs Operator Toe"}),e.jsx("option",{value:"reschedule_order",children:"Herplan Order"})]}),a.action.type==="send_notification"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Severity"}),e.jsxs("select",{value:((K=a.action.params)==null?void 0:K.severity)||"info",onChange:t=>p({...a,action:{...a.action,params:{...a.action.params,severity:t.target.value}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"alert",children:"Alert"})]}),e.jsx("label",{className:"text-xs text-slate-600",children:"Custom bericht (optioneel)"}),e.jsx("input",{type:"text",placeholder:"Laat leeg voor auto bericht",value:((Y=a.action.params)==null?void 0:Y.message)||"",onChange:t=>p({...a,action:{...a.action,params:{...a.action.params,message:t.target.value}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]}),a.action.type==="auto_learning_update"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Learning Rate (0-1)"}),e.jsx("input",{type:"number",step:"0.1",placeholder:"Bijv: 0.3",value:((Z=a.action.params)==null?void 0:Z.learningRate)||"",onChange:t=>p({...a,action:{...a.action,params:{...a.action.params,learningRate:parseFloat(t.target.value)||.3}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:((Q=a.action.params)==null?void 0:Q.dryRun)||!1,onChange:t=>p({...a,action:{...a.action,params:{...a.action.params,dryRun:t.target.checked}}})}),e.jsx("span",{className:"text-xs text-slate-600",children:"Dry Run (alleen simuleren)"})]})]}),a.action.type==="create_log"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600",children:"Log bericht (optioneel)"}),e.jsx("input",{type:"text",placeholder:"Laat leeg voor auto bericht",value:((J=a.action.params)==null?void 0:J.logMessage)||"",onChange:t=>p({...a,action:{...a.action,params:{...a.action.params,logMessage:t.target.value}}}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-200",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase mb-2 block",children:"Debounce (minuten)"}),e.jsx("input",{type:"number",placeholder:"Bijv: 60",value:a.debounceMinutes||"",onChange:t=>p({...a,debounceMinutes:parseInt(t.target.value)||60}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Voorkomt dubbele executions binnen deze tijd"})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t-2 border-slate-200",children:[e.jsx("button",{onClick:I,className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-bold transition-colors",children:g?"Wijzigingen Opslaan":"Regel Opslaan"}),e.jsx("button",{onClick:()=>{n(!1),y(null)},className:"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg font-bold transition-colors",children:"Annuleren"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200",children:[e.jsx("div",{className:"p-4 border-b-2 border-slate-200 bg-slate-50",children:e.jsx("h3",{className:"text-sm font-bold text-slate-800",children:"Automation Regels"})}),e.jsx("div",{className:"p-4 space-y-3",children:i.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Nog geen automation rules geconfigureerd"}):i.map(t=>e.jsxs("div",{className:`p-4 rounded-xl border-2 transition-all ${t.enabled?"border-purple-200 bg-purple-50":"border-slate-200 bg-slate-50 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-bold text-sm text-slate-800 mb-1 flex items-center gap-2",children:[t.name,t.debounceMinutes&&e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded font-normal",children:[t.debounceMinutes,"min debounce"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded font-bold flex items-center gap-1",children:[ne(t.trigger.type),"WHEN"]}),e.jsx("span",{className:"text-slate-600",children:k(t.trigger)}),e.jsx(oe,{size:12,className:"text-slate-400"}),e.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded font-bold",children:"THEN"}),e.jsx("span",{className:"text-slate-600",children:T(t.action)})]}),t.trigger.conditions&&Object.keys(t.trigger.conditions).length>0&&e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:[t.trigger.type==="capacity_shortage"&&`Threshold: ${t.trigger.conditions.threshold}h`,t.trigger.type==="low_efficiency"&&`Min: ${t.trigger.conditions.threshold}%`,t.trigger.type==="order_delay"&&`Min orders: ${t.trigger.conditions.minDelayedOrders||1}`,t.trigger.type==="missing_operator"&&`Min machines: ${t.trigger.conditions.threshold||1}`,t.trigger.type==="dependency_blocked"&&`Min blocked: ${t.trigger.conditions.threshold||1}`,t.trigger.type==="inspection_overdue"&&`${t.trigger.conditions.daysOverdue||7} dagen${t.trigger.conditions.station?` @ ${t.trigger.conditions.station}`:""}`,t.trigger.type==="standard_deviation"&&`Min samples: ${t.trigger.conditions.minSamples||5}, Dev: ${t.trigger.conditions.minDeviation||5}%`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(t),className:"p-1 hover:bg-blue-100 rounded-lg transition-colors",title:"Bewerken",children:e.jsx(ue,{className:"text-blue-600",size:14})}),e.jsx("button",{onClick:()=>A(t),disabled:r,className:`p-1 rounded-lg transition-colors ${r?"bg-slate-100 cursor-not-allowed":"hover:bg-blue-100"}`,title:"Test uitvoeren",children:e.jsx(pe,{className:r?"text-slate-400":"text-blue-600",size:14})}),e.jsx("button",{onClick:()=>w(t.id,t.enabled),className:`p-1 rounded-lg transition-colors ${t.enabled?"bg-emerald-100 hover:bg-emerald-200":"bg-slate-200 hover:bg-slate-300"}`,children:t.enabled?e.jsx($,{className:"text-emerald-600",size:16}):e.jsx(ee,{className:"text-slate-500",size:16})}),e.jsx("button",{onClick:()=>b(t.id),className:"p-1 hover:bg-red-100 rounded-lg transition-colors",children:e.jsx(ge,{className:"text-red-600",size:14})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("span",{children:["Uitgevoerd: ",t.executionCount||0,"x"]}),t.lastExecuted&&e.jsxs("span",{children:["Laatst: ",new Date(t.lastExecuted.seconds*1e3).toLocaleString("nl-NL",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]})]})]},t.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200",children:[e.jsx("div",{className:"p-4 border-b-2 border-slate-200 bg-slate-50",children:e.jsx("h3",{className:"text-sm font-bold text-slate-800",children:"Execution History"})}),e.jsx("div",{className:"p-4 space-y-2 max-h-[700px] overflow-y-auto",children:l.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400 text-sm",children:"Nog geen executions"}):l.map(t=>e.jsxs("div",{className:`p-3 rounded-lg border ${t.status==="success"?"border-emerald-200 bg-emerald-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("div",{className:"text-xs font-bold text-slate-800",children:t.ruleName}),t.status==="success"?e.jsx($,{className:"text-emerald-600",size:12}):e.jsx(ee,{className:"text-red-600",size:12})]}),e.jsx("div",{className:"text-xs text-slate-600",children:t.message||"No message"}),t.executedAt&&e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:new Date(t.executedAt.seconds*1e3).toLocaleString("nl-NL",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]},t.id))})]})]}),e.jsx("div",{className:"mt-6 bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-6 border-2 border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(te,{className:"text-purple-600 flex-shrink-0",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Centralized Automation Engine ðŸš€"}),e.jsxs("div",{className:"text-sm text-slate-700 space-y-1",children:[e.jsxs("p",{children:["âœ… ",e.jsx("strong",{children:"Gemigreerde Logica:"})," Alle hardcoded automation rules zijn nu data-driven"]}),e.jsxs("p",{children:["âœ… ",e.jsx("strong",{children:"8 Trigger Types:"})," Capacity shortage, Low efficiency, Order delay, Missing operator, Dependency blocked, Inspection overdue, Standard deviation, Status change"]}),e.jsxs("p",{children:["âœ… ",e.jsx("strong",{children:"7 Action Types:"})," Notificaties, Logs, Inspectie reminders, AI learning updates, Status updates, Operator toewijzingen, Herplanningen"]}),e.jsxs("p",{children:["âœ… ",e.jsx("strong",{children:"Smart Debouncing:"})," Voorkomt dubbele executions binnen geconfigureerde tijd"]}),e.jsxs("p",{children:["âœ… ",e.jsx("strong",{children:"Real-time Testing:"})," Test elke regel direct met actuele data via Play knop"]}),e.jsxs("p",{children:["âœ… ",e.jsx("strong",{children:"Execution History:"})," Volledige logging van alle uitgevoerde rules"]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-white/50 rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-xs font-bold text-purple-700 mb-1",children:"ðŸŽ¯ Migratie Succesvol:"}),e.jsxs("p",{className:"text-xs text-slate-600",children:[e.jsx("strong",{children:"NotificationRulesView:"})," 5 trigger types â†’ Automation Rules",e.jsx("br",{}),e.jsx("strong",{children:"WorkstationHub:"})," Inspection reminders â†’ Automation Rules",e.jsx("br",{}),e.jsx("strong",{children:"autoLearningService:"})," AI standard updates â†’ Automation Rules"]})]})]})]})})]})};export{qe as default};
