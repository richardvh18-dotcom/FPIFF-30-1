import{d,e as o,j as e,f as X,k as Y}from"./index-DNbqce-j.js";import{r as x}from"./react-vendor-CkwvfVK2.js";import{o as N,j as p,k as A,y as R,l as w,B as q,s as D}from"./firebase-DdpHYWNd.js";import{P as J}from"./plus-fTGSighL.js";import{T as K}from"./trash-2-CmT6fCSF.js";import{T as Q,B as Z}from"./AdminDashboard-BkhDkzix.js";import{U as ee}from"./users-BzjIxhpA.js";import"./arrow-left-CeHKlJCF.js";import"./clock-yngyoSLs.js";import"./book-open-Dw5UZXUq.js";const he=()=>{const[u,S]=x.useState([]),[j,L]=x.useState([]),[g,E]=x.useState([]),[b,z]=x.useState([]),[k,v]=x.useState(!1),[n,f]=x.useState({name:"",trigger:"capacity_shortage",threshold:10,recipients:"all",enabled:!0});x.useEffect(()=>{const s=N(p(o,...d.NOTIFICATION_RULES),l=>{const r=l.docs.map(m=>({id:m.id,...m.data()}));S(r)}),a=N(p(o,...d.NOTIFICATION_LOGS),l=>{const r=l.docs.map(m=>({id:m.id,...m.data()}));L(r.slice(0,50))}),c=N(p(o,...d.OCCUPANCY),l=>{E(l.docs.map(r=>({id:r.id,...r.data()})))}),h=N(p(o,...d.PLANNING),l=>{z(l.docs.map(r=>({id:r.id,...r.data()})))});return()=>{s(),a(),c(),h()}},[]),x.useEffect(()=>{u.length!==0&&u.forEach(s=>{s.enabled&&$(s)})},[g,b,u]);const $=async s=>{let a=!1,c="",h="info";switch(s.trigger){case"capacity_shortage":const l=g.reduce((t,i)=>t+(i.productionHours||0),0),m=b.reduce((t,i)=>t+(i.estimatedHours||0),0)-l;m>s.threshold&&(a=!0,c=`âš ï¸ Capaciteitstekort gedetecteerd: ${Math.round(m)}h tekort (threshold: ${s.threshold}h)`,h="warning");break;case"low_efficiency":const C=g.reduce((t,i)=>{const y=i.productionHours>0?(i.actualHours||0)/i.productionHours:0;return t+y},0)/(g.length||1);C<s.threshold/100&&(a=!0,c=`ðŸ“‰ Lage efficiency gedetecteerd: ${Math.round(C*100)}% (threshold: ${s.threshold}%)`,h="warning");break;case"order_delay":const V=new Date,O=b.filter(t=>!t.plannedDate||t.status==="shipped"?!1:new Date(t.plannedDate.seconds*1e3)<V);O.length>0&&(a=!0,c=`ðŸ• ${O.length} orders zijn vertraagd`,h="critical");break;case"missing_operator":const I=g.filter(t=>!t.operatorName||t.operatorName==="");I.length>=s.threshold&&(a=!0,c=`ðŸ‘¤ ${I.length} machines zonder operator`,h="warning");break;case"dependency_blocked":const T=b.filter(t=>!t.dependencies||t.dependencies.length===0?!1:!t.dependencies.every(y=>{const _=b.find(W=>W.id===y);return _&&_.status==="shipped"})&&t.status!=="shipped");T.length>=s.threshold&&(a=!0,c=`ðŸ”— ${T.length} orders geblokkeerd door dependencies`,h="info");break}a&&(j.find(r=>r.ruleId===s.id&&r.createdAt&&Date.now()-new Date(r.createdAt.seconds*1e3).getTime()<36e5)||await G({ruleId:s.id,ruleName:s.name,message:c,severity:h,recipients:s.recipients}))},G=async s=>{await A(p(o,...d.NOTIFICATION_LOGS),{...s,createdAt:D(),read:!1})},U=async()=>{if(!n.name){alert("Geef de regel een naam");return}await A(p(o,...d.NOTIFICATION_RULES),{...n,createdAt:D()}),f({name:"",trigger:"capacity_shortage",threshold:10,recipients:"all",enabled:!0}),v(!1)},F=async s=>{confirm("Weet je zeker dat je deze regel wilt verwijderen?")&&await q(w(o,...d.NOTIFICATION_RULES,s))},P=async(s,a)=>{await R(w(o,...d.NOTIFICATION_RULES,s),{enabled:!a})},H=async s=>{await R(w(o,...d.NOTIFICATION_LOGS,s),{read:!0})},B=s=>({capacity_shortage:"Capaciteitstekort",low_efficiency:"Lage Efficiency",order_delay:"Order Vertraging",missing_operator:"Ontbrekende Operator",dependency_blocked:"Geblokkeerde Dependencies"})[s]||s,M=s=>{const a={info:"bg-blue-50 border-blue-200 text-blue-800",warning:"bg-amber-50 border-amber-200 text-amber-800",critical:"bg-red-50 border-red-200 text-red-800"};return a[s]||a.info};return e.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border-2 border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-800",children:["Notification ",e.jsx("span",{className:"text-blue-600",children:"Rules"})]}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Configureer geautomatiseerde notificaties voor systeem events"})]}),e.jsxs("button",{onClick:()=>v(!k),className:"flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-bold transition-colors",children:[e.jsx(J,{size:16}),"Nieuwe Regel"]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200",children:[e.jsx("div",{className:"p-4 border-b-2 border-slate-200 bg-slate-50",children:e.jsx("h3",{className:"text-sm font-bold text-slate-800",children:"Actieve Regels"})}),e.jsxs("div",{className:"p-4 space-y-3 max-h-[600px] overflow-y-auto",children:[k&&e.jsxs("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-xl space-y-3",children:[e.jsx("input",{type:"text",placeholder:"Regel naam...",value:n.name,onChange:s=>f({...n,name:s.target.value}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"}),e.jsxs("select",{value:n.trigger,onChange:s=>f({...n,trigger:s.target.value}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm",children:[e.jsx("option",{value:"capacity_shortage",children:"Capaciteitstekort"}),e.jsx("option",{value:"low_efficiency",children:"Lage Efficiency"}),e.jsx("option",{value:"order_delay",children:"Order Vertraging"}),e.jsx("option",{value:"missing_operator",children:"Ontbrekende Operator"}),e.jsx("option",{value:"dependency_blocked",children:"Geblokkeerde Dependencies"})]}),e.jsx("input",{type:"number",placeholder:"Threshold...",value:n.threshold,onChange:s=>f({...n,threshold:parseInt(s.target.value)}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm"}),e.jsxs("select",{value:n.recipients,onChange:s=>f({...n,recipients:s.target.value}),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"Iedereen"}),e.jsx("option",{value:"admins",children:"Alleen Admins"}),e.jsx("option",{value:"teamleaders",children:"Teamleaders"}),e.jsx("option",{value:"engineers",children:"Engineers"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:U,className:"px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-bold transition-colors",children:"Opslaan"}),e.jsx("button",{onClick:()=>v(!1),className:"px-3 py-1.5 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-xs font-bold transition-colors",children:"Annuleren"})]})]}),u.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Nog geen notification rules"}):u.map(s=>e.jsxs("div",{className:`p-4 rounded-xl border-2 transition-all ${s.enabled?"border-blue-200 bg-blue-50":"border-slate-200 bg-slate-50 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-slate-800",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:B(s.trigger)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>P(s.id,s.enabled),className:`p-1 rounded-lg transition-colors ${s.enabled?"bg-emerald-100 hover:bg-emerald-200":"bg-slate-200 hover:bg-slate-300"}`,children:s.enabled?e.jsx(X,{className:"text-emerald-600",size:16}):e.jsx(Y,{className:"text-slate-500",size:16})}),e.jsx("button",{onClick:()=>F(s.id),className:"p-1 hover:bg-red-100 rounded-lg transition-colors",children:e.jsx(K,{className:"text-red-600",size:14})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[e.jsx(Q,{size:12}),e.jsxs("span",{children:["Threshold: ",s.threshold]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[e.jsx(ee,{size:12}),e.jsx("span",{children:s.recipients})]})]})]},s.id))]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200",children:[e.jsx("div",{className:"p-4 border-b-2 border-slate-200 bg-slate-50",children:e.jsx("h3",{className:"text-sm font-bold text-slate-800",children:"Recente Notificaties"})}),e.jsx("div",{className:"p-4 space-y-2 max-h-[600px] overflow-y-auto",children:j.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Geen notificaties"}):j.map(s=>e.jsxs("div",{className:`p-3 rounded-xl border-2 ${M(s.severity)} ${s.read?"opacity-50":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:14}),e.jsx("div",{className:"text-xs font-bold",children:s.ruleName})]}),!s.read&&e.jsx("button",{onClick:()=>H(s.id),className:"text-xs underline hover:no-underline",children:"Markeer gelezen"})]}),e.jsx("div",{className:"text-xs",children:s.message}),s.createdAt&&e.jsx("div",{className:"text-xs opacity-60 mt-2",children:new Date(s.createdAt.seconds*1e3).toLocaleString("nl-NL")})]},s.id))})]})]})]})};export{he as default};
