import{c as E,d as M,e as L,j as e,L as J,s as K,X as T,Z as F,p as X,A as Y,E as ee,l as te}from"./index-DNbqce-j.js";import{u as se,r}from"./react-vendor-CkwvfVK2.js";import{o as O,j as q}from"./firebase-DdpHYWNd.js";import{A as ae}from"./arrow-left-CeHKlJCF.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=E("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=E("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),de=()=>{const w=se(),[P,N]=r.useState(!0),[k,_]=r.useState([]),[y,$]=r.useState([]),[Q,f]=r.useState("idle"),[u,g]=r.useState(""),[C,S]=r.useState(null),[n,z]=r.useState(!1),[H,V]=r.useState(!1),[R,I]=r.useState(!1),[G,A]=r.useState(!1),i=r.useRef(null),j=r.useRef(null),o=r.useRef(null),d=r.useRef(null),h=r.useRef(!1),x=r.useRef(!1);r.useEffect(()=>{const s="jsqr-engine-v26";if(document.getElementById(s))A(!0);else{const t=document.createElement("script");t.id=s,t.src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js",t.async=!0,t.onload=()=>A(!0),document.head.appendChild(t)}const a=O(q(L,...M.PLANNING),t=>{_(t.docs.map(c=>({id:c.id,...c.data()})))},t=>{console.error("Orders listener error:",t)}),l=O(q(L,...M.TRACKING),t=>{$(t.docs.map(c=>({id:c.id,...c.data()}))),N(!1)},t=>{console.error("Products listener error:",t),N(!1)});return()=>{console.log("[MobileScanner] Cleanup: listeners worden afgesloten"),a(),l(),b()}},[]);const W=async()=>{S(null),z(!1),f("camera");try{const s={video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}},a=await navigator.mediaDevices.getUserMedia(s);if(i.current){i.current.srcObject=a,o.current=a,h.current=!0,x.current=!1;const l=a.getVideoTracks()[0],t=l.getCapabilities?l.getCapabilities():{};V(!!t.torch),i.current.setAttribute("playsinline","true"),await i.current.play(),d.current=requestAnimationFrame(p)}}catch(s){console.error("Camera fout:",s),S("Camera niet bereikbaar. Controleer uw instellingen."),f("idle")}},Z=async()=>{if(!o.current)return;const s=o.current.getVideoTracks()[0];try{const a=!R;await s.applyConstraints({advanced:[{torch:a}]}),I(a)}catch{console.warn("Zaklamp niet ondersteund door browser/hardware")}},b=()=>{h.current=!1,x.current=!1,I(!1),o.current&&(o.current.getTracks().forEach(s=>s.stop()),o.current=null),d.current&&cancelAnimationFrame(d.current),f("idle")},p=async()=>{if(!h.current||!i.current||!j.current||!window.jsQR){h.current&&(d.current=requestAnimationFrame(p));return}if(x.current){d.current=requestAnimationFrame(p);return}const s=i.current;if(s.readyState===4){x.current=!0;const a=j.current,l=a.getContext("2d",{willReadFrequently:!0}),t=Math.min(s.videoWidth,s.videoHeight)*.8,c=(s.videoWidth-t)/2,B=(s.videoHeight-t)/2;a.width=t,a.height=t,l.drawImage(s,c,B,t,t,0,0,t,t);const U=l.getImageData(0,0,t,t);try{const m=window.jsQR(U.data,t,t,{inversionAttempts:"attemptBoth"});if(m&&m.data){navigator.vibrate&&navigator.vibrate(100),z(!0),g(m.data),setTimeout(()=>{b()},500);return}}catch(m){console.error("Scan error:",m)}finally{x.current=!1}}d.current=requestAnimationFrame(p)},v=r.useMemo(()=>{const s=(u||"").toLowerCase().trim();if(!s)return[];const a=k.filter(t=>(t.orderId||"").toLowerCase().includes(s)||(t.itemCode||"").toLowerCase().includes(s)||(t.item||"").toLowerCase().includes(s)).map(t=>({...t,searchType:"order",displayId:t.orderId}));return[...y.filter(t=>(t.lotNumber||"").toLowerCase().includes(s)||(t.orderId||"").toLowerCase().includes(s)||(t.itemCode||"").toLowerCase().includes(s)).map(t=>({...t,searchType:"lot",displayId:t.lotNumber})),...a].slice(0,15)},[k,y,u]),D=s=>{const a=s.machine||s.stationLabel;a?w(`/terminal/${a}`,{state:{selectedId:s.id}}):alert("Geen machine gekoppeld aan dit item.")};return P||!G?e.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-slate-900 text-white",children:[e.jsx(J,{className:"animate-spin text-blue-500 mb-6",size:56}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest italic animate-pulse",children:"Systeem laden..."})]}):e.jsxs("div",{className:"fixed inset-0 bg-slate-50 flex flex-col z-[200] animate-in fade-in overflow-hidden text-left",children:[e.jsxs("div",{className:"p-6 bg-white border-b border-slate-200 flex items-center justify-between shadow-sm shrink-0",children:[e.jsx("button",{onClick:()=>w("/portal"),className:"p-3 -ml-3 text-slate-400 hover:text-slate-900 transition-colors",children:e.jsx(ae,{size:28})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-xl font-black uppercase italic tracking-tighter leading-none",children:["Global ",e.jsx("span",{className:"text-blue-600",children:"Scanner"})]}),e.jsx("p",{className:"text-[8px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Industrial Vision Core"})]}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8 pb-32",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("button",{onClick:W,className:"w-full py-12 bg-blue-600 text-white rounded-[45px] shadow-2xl shadow-blue-200 flex flex-col items-center justify-center gap-5 active:scale-95 transition-all border-4 border-blue-400/20 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-400/20 to-transparent opacity-50"}),e.jsx("div",{className:"p-6 bg-white/10 rounded-[30px] backdrop-blur-md relative z-10 group-hover:scale-110 transition-transform",children:e.jsx(le,{size:56,className:"text-white",strokeWidth:2.5})}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsx("span",{className:"font-black uppercase tracking-[0.3em] text-sm block",children:"Open Camera Scanner"}),e.jsx("span",{className:"text-[10px] font-bold text-blue-100/60 uppercase mt-2 italic tracking-widest",children:"Richt op de QR op de bon"})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(K,{className:"absolute left-5 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors",size:24}),e.jsx("input",{type:"text",placeholder:"Zoek Order, Lot of Item...",className:"w-full pl-14 pr-12 py-7 bg-white border-2 border-slate-100 rounded-[30px] shadow-sm outline-none focus:border-blue-500 font-bold transition-all text-lg",value:u,onChange:s=>g(s.target.value)}),u&&e.jsx("button",{onClick:()=>g(""),className:"absolute right-6 top-1/2 -translate-y-1/2 text-slate-300 hover:text-slate-600",children:e.jsx(T,{size:24})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest italic ml-4",children:["Resultaten (",v.length,")"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[v.map((s,a)=>e.jsxs("div",{onClick:()=>D(s),className:"bg-white p-7 rounded-[40px] border border-slate-100 shadow-sm flex items-center justify-between active:scale-95 transition-all group hover:border-blue-300 animate-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"flex items-center gap-6 text-left overflow-hidden",children:[e.jsx("div",{className:`p-4 rounded-[20px] shrink-0 ${s.searchType==="lot"?"bg-orange-50 text-orange-600":"bg-blue-50 text-blue-600"}`,children:s.searchType==="lot"?e.jsx(F,{size:32}):e.jsx(X,{size:32})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h4",{className:"font-black text-slate-900 leading-none mb-2 text-xl italic tracking-tighter",children:s.displayId}),e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase truncate pr-4",children:s.item||s.itemCode})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3 shrink-0",children:[e.jsx("span",{className:"text-[10px] font-black bg-slate-100 text-slate-600 px-3 py-1.5 rounded-xl uppercase tracking-tighter border border-slate-200",children:s.machine||"Planning"}),e.jsx("div",{className:"w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center text-slate-300 group-hover:bg-blue-600 group-hover:text-white transition-all shadow-inner",children:e.jsx(Y,{size:20})})]})]},a)),u&&v.length===0&&e.jsxs("div",{className:"py-24 text-center bg-white rounded-[60px] border-2 border-dashed border-slate-100 opacity-60",children:[e.jsx(ee,{size:64,className:"mx-auto text-slate-200 mb-4"}),e.jsx("p",{className:"text-sm font-black uppercase tracking-widest text-slate-400",children:"Niets gevonden"})]})]})]})]})]}),Q==="camera"&&e.jsxs("div",{className:"fixed inset-0 z-[300] bg-black flex flex-col animate-in fade-in",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-6 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent z-[320]",children:[e.jsx("button",{onClick:b,className:"p-4 bg-white/10 rounded-full text-white active:scale-90 transition-all border border-white/10 backdrop-blur-md shadow-2xl",children:e.jsx(T,{size:32})}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"font-black uppercase tracking-[0.4em] text-[11px] text-white italic drop-shadow-lg block",children:"QR Scanner"}),e.jsx("span",{className:"text-[8px] font-bold text-blue-400 uppercase tracking-widest",children:"Active Precision Scan"})]}),H?e.jsx("button",{onClick:Z,className:`p-4 rounded-full transition-all border border-white/10 backdrop-blur-md ${R?"bg-amber-400 text-slate-900 shadow-[0_0_25px_rgba(251,191,36,0.6)]":"bg-white/10 text-white"}`,children:e.jsx(F,{size:24})}):e.jsx("div",{className:"w-16"})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden flex items-center justify-center bg-slate-950",children:[e.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("canvas",{ref:j,className:"hidden"}),e.jsxs("div",{className:"absolute inset-0 z-[310] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30"}),e.jsxs("div",{className:`relative w-80 h-80 bg-transparent rounded-[60px] flex flex-col items-center justify-center transition-all duration-500 border-4 ${n?"border-emerald-400 scale-110 shadow-[0_0_50px_rgba(16,185,129,0.5)]":"border-white/60"}`,children:[e.jsx("div",{className:`absolute top-0 left-0 w-full h-1.5 shadow-[0_0_25px_rgba(59,130,246,0.9)] animate-scanner-line ${n?"bg-emerald-400":"bg-blue-500"}`}),n?e.jsx("div",{className:"animate-in zoom-in text-emerald-400 flex flex-col items-center gap-4 bg-black/40 p-6 rounded-full backdrop-blur-sm",children:e.jsx(te,{size:80,strokeWidth:3})}):e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx(re,{size:80,className:"text-white/20 animate-pulse"}),e.jsx("span",{className:"text-[9px] font-black text-white/50 uppercase tracking-[0.4em] drop-shadow-md",children:"Centraal Uitlijnen"})]}),e.jsx("div",{className:`absolute -top-3 -left-3 w-16 h-16 border-t-8 border-l-8 rounded-tl-3xl transition-colors ${n?"border-emerald-400":"border-blue-500"}`}),e.jsx("div",{className:`absolute -top-3 -right-3 w-16 h-16 border-t-8 border-r-8 rounded-tr-3xl transition-colors ${n?"border-emerald-400":"border-blue-500"}`}),e.jsx("div",{className:`absolute -bottom-3 -left-3 w-16 h-16 border-b-8 border-l-8 rounded-bl-3xl transition-colors ${n?"border-emerald-400":"border-blue-500"}`}),e.jsx("div",{className:`absolute -bottom-3 -right-3 w-16 h-16 border-b-8 border-r-8 rounded-br-3xl transition-colors ${n?"border-emerald-400":"border-blue-500"}`})]})]}),C&&e.jsx("div",{className:"absolute bottom-40 left-8 right-8 p-6 bg-red-600 text-white rounded-3xl text-center text-xs font-black uppercase shadow-2xl z-[350] border-2 border-red-400",children:C})]}),e.jsxs("div",{className:"p-10 bg-slate-900 border-t border-white/10 z-[320] shadow-2xl",children:[e.jsx("p",{className:"text-blue-400 text-[10px] font-black uppercase tracking-[0.3em] text-center mb-8 flex items-center justify-center gap-3 opacity-90 leading-none",children:"Plaats de QR-code in het witte kader"}),e.jsx("button",{onClick:b,className:"w-full py-6 bg-white/5 hover:bg-white/10 border-2 border-white/20 text-white rounded-[35px] font-black uppercase text-xs tracking-widest active:scale-95 transition-all shadow-lg",children:"Scanner Sluiten"})]})]}),e.jsx("style",{children:`
        @keyframes scanner-line {
            0% { top: 0%; opacity: 0; }
            15% { opacity: 1; }
            85% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        .animate-scanner-line {
            animation: scanner-line 2.0s ease-in-out infinite;
        }
      `})]})};export{de as default};
