import{c as Ie,j as e,S as yt,k as St,l as Ae,Z as ke,B as Jt,A as Te,m as Ct,X as Ne,f as es,L as fe,n as It,u as Ue,d as G,e as U,o as ts,p as Je,q as lt,P as et,r as tt,s as st,g as Fe,t as Dt,I as ss,v as as,w as rs,x as ls,y as ns,z as is,E as os,G as cs,H as ds}from"./index-DNbqce-j.js";import{r as a,u as At,b as xs}from"./react-vendor-CkwvfVK2.js";import{o as pe,j as ce,l as ne,s as de,E as us,y as ve,q as Se,w as Be,D as ze,t as Ye,z as ms,k as ft,p as ps,x as fs,B as ht,G as hs}from"./firebase-DdpHYWNd.js";import{g as nt}from"./index-CSXCcwhn.js";import{r as Pe,t as it,a as ot}from"./index-jHXuI3CI.js";import{m as Tt,a as Ot,n as ie,p as _e,C as bs,g as Xe,f as gs}from"./hubHelpers-if0OQD1V.js";import{A as Ke}from"./activity-BBrgQQV7.js";import{A as Ee}from"./alert-triangle-BUFzzSRW.js";import{A as Ve}from"./alert-octagon-CsnuCDni.js";import{C as js}from"./check-CcAUrFwy.js";import{T as Mt}from"./timer-Dsj0FPXu.js";import{C as Ce}from"./clock-yngyoSLs.js";import{P as ct}from"./play-circle-CeaJOrWR.js";import{D as Ns}from"./constants-CTjDY--F.js";import{G as ws,H as zt,U as dt}from"./users-BzjIxhpA.js";import{p as vs,Q as ks,r as bt}from"./labelHelpers-CAArPLe7.js";import{R as Pt}from"./refresh-cw-BMZ4Lrni.js";import{I as gt}from"./inbox-DmJ6uQ9K.js";import{C as ys}from"./chevron-left-BrN2e-EN.js";import{s as Et}from"./index-DYfIlivi.js";import{a as Ss}from"./index-BsxtD_7s.js";import{g as Lt,f as Oe,i as at}from"./index-CFK5EZMp.js";import{A as Me}from"./arrow-left-CeHKlJCF.js";import{d as $t}from"./index-DvKXYWrU.js";import{C as Ge}from"./calendar-C-DwY-3M.js";import{s as We}from"./index-B01KZ34F.js";import{C as Ze}from"./cpu-BQwTkJut.js";import{r as Cs,u as Is}from"./xlsx-DLNWaC59.js";import{F as Ht}from"./file-spreadsheet-BlD7PTYV.js";import{U as Ds}from"./upload-DE5XOlRL.js";import{T as As}from"./table-CCPXu8vm.js";import"./setPrototypeOf-DgZC2w_0.js";import"./defineProperty-Cg-f50Hq.js";import"./index-CHWv9JIR.js";import"./index-TtjwkAWP.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=Ie("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=Ie("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=Ie("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=Ie("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=Ie("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=Ie("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);function zs(t,s){var r,l,x,i,d,n,o,y;Pe(1,arguments);var c=it(t),b=c.getFullYear(),u=Lt(),m=ot((r=(l=(x=(i=s==null?void 0:s.firstWeekContainsDate)!==null&&i!==void 0?i:s==null||(d=s.locale)===null||d===void 0||(n=d.options)===null||n===void 0?void 0:n.firstWeekContainsDate)!==null&&x!==void 0?x:u.firstWeekContainsDate)!==null&&l!==void 0?l:(o=u.locale)===null||o===void 0||(y=o.options)===null||y===void 0?void 0:y.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var S=new Date(0);S.setFullYear(b+1,0,m),S.setHours(0,0,0,0);var v=We(S,s),N=new Date(0);N.setFullYear(b,0,m),N.setHours(0,0,0,0);var D=We(N,s);return c.getTime()>=v.getTime()?b+1:c.getTime()>=D.getTime()?b:b-1}function Ps(t,s){var r,l,x,i,d,n,o,y;Pe(1,arguments);var c=Lt(),b=ot((r=(l=(x=(i=s==null?void 0:s.firstWeekContainsDate)!==null&&i!==void 0?i:s==null||(d=s.locale)===null||d===void 0||(n=d.options)===null||n===void 0?void 0:n.firstWeekContainsDate)!==null&&x!==void 0?x:c.firstWeekContainsDate)!==null&&l!==void 0?l:(o=c.locale)===null||o===void 0||(y=o.options)===null||y===void 0?void 0:y.firstWeekContainsDate)!==null&&r!==void 0?r:1),u=zs(t,s),m=new Date(0);m.setFullYear(u,0,b),m.setHours(0,0,0,0);var S=We(m,s);return S}var Es=6048e5;function Ls(t,s){Pe(1,arguments);var r=it(t),l=We(r,s).getTime()-Ps(r,s).getTime();return Math.round(l/Es)+1}function $s(t){return Pe(1,arguments),it(t).getFullYear()}function Hs(t,s){var r;Pe(1,arguments);var l=ot((r=void 0)!==null&&r!==void 0?r:2);if(l!==2&&l!==1&&l!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var x=_s(t),i;if(x.date){var d=Gs(x.date,l);i=Ws(d.restDateString,d.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var n=i.getTime(),o=0,y;if(x.time&&(o=Us(x.time),isNaN(o)))return new Date(NaN);if(x.timezone){if(y=Ys(x.timezone),isNaN(y))return new Date(NaN)}else{var c=new Date(n+o),b=new Date(0);return b.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),b.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),b}return new Date(n+o+y)}var Re={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Rs=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Fs=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Bs=/^([+-])(\d{2})(?::?(\d{2}))?$/;function _s(t){var s={},r=t.split(Re.dateTimeDelimiter),l;if(r.length>2)return s;if(/:/.test(r[0])?l=r[0]:(s.date=r[0],l=r[1],Re.timeZoneDelimiter.test(s.date)&&(s.date=t.split(Re.timeZoneDelimiter)[0],l=t.substr(s.date.length,t.length))),l){var x=Re.timezone.exec(l);x?(s.time=l.replace(x[1],""),s.timezone=x[1]):s.time=l}return s}function Gs(t,s){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),l=t.match(r);if(!l)return{year:NaN,restDateString:""};var x=l[1]?parseInt(l[1]):null,i=l[2]?parseInt(l[2]):null;return{year:i===null?x:i*100,restDateString:t.slice((l[1]||l[2]).length)}}function Ws(t,s){if(s===null)return new Date(NaN);var r=t.match(Rs);if(!r)return new Date(NaN);var l=!!r[4],x=De(r[1]),i=De(r[2])-1,d=De(r[3]),n=De(r[4]),o=De(r[5])-1;if(l)return Xs(s,n,o)?Ks(s,n,o):new Date(NaN);var y=new Date(0);return!Zs(s,i,d)||!qs(s,x)?new Date(NaN):(y.setUTCFullYear(s,i,Math.max(x,d)),y)}function De(t){return t?parseInt(t):1}function Us(t){var s=t.match(Fs);if(!s)return NaN;var r=Qe(s[1]),l=Qe(s[2]),x=Qe(s[3]);return Qs(r,l,x)?r*Tt+l*Ot+x*1e3:NaN}function Qe(t){return t&&parseFloat(t.replace(",","."))||0}function Ys(t){if(t==="Z")return 0;var s=t.match(Bs);if(!s)return 0;var r=s[1]==="+"?-1:1,l=parseInt(s[2]),x=s[3]&&parseInt(s[3])||0;return Js(l,x)?r*(l*Tt+x*Ot):NaN}function Ks(t,s,r){var l=new Date(0);l.setUTCFullYear(t,0,4);var x=l.getUTCDay()||7,i=(s-1)*7+r+1-x;return l.setUTCDate(l.getUTCDate()+i),l}var Vs=[31,null,31,30,31,30,31,31,30,31,30,31];function Bt(t){return t%400===0||t%4===0&&t%100!==0}function Zs(t,s,r){return s>=0&&s<=11&&r>=1&&r<=(Vs[s]||(Bt(t)?29:28))}function qs(t,s){return s>=1&&s<=(Bt(t)?366:365)}function Xs(t,s,r){return s>=1&&s<=53&&r>=0&&r<=6}function Qs(t,s,r){return t===24?s===0&&r===0:r>=0&&r<60&&s>=0&&s<60&&t>=0&&t<25}function Js(t,s){return s>=0&&s<=59}const ea=["Niet conform tekening","Verkeerde diameter","Oppervlakteschade","Barst/scheur","Materiaaltekort","Verkeerde specificatie","Maatafwijking","Kwaliteit onvoldoende","Anders"],ta=[{id:"BH11",name:"BH11",category:"winding"},{id:"BH12",name:"BH12",category:"winding"},{id:"BH15",name:"BH15",category:"winding"},{id:"BH16",name:"BH16",category:"winding"},{id:"BH17",name:"BH17",category:"winding"},{id:"BH18",name:"BH18",category:"winding"},{id:"BH31",name:"BH31",category:"winding"},{id:"BH05",name:"BH05",category:"pipes"},{id:"BH07",name:"BH07",category:"pipes"},{id:"BH08",name:"BH08",category:"pipes"},{id:"BH09",name:"BH09",category:"pipes"},{id:"Mazak",name:"Mazak",category:"post-processing"},{id:"Nabewerking",name:"Nabewerking",category:"post-processing"},{id:"BM01",name:"BM01",category:"inspection"},{id:"Station BM01",name:"Station BM01",category:"inspection"}],Nt=t=>{const s=nt(t),r=$s(t);return{week:s,year:r}},_t=t=>{if(!t)return!1;try{const s=new Date(t);return(new Date-s)/(1e3*60*60*24)>7}catch{return!1}},sa=t=>{if(!t)return{material:"Unknown",diameter:null};const s=String(t).split("-");return{material:s[0]||"Unknown",diameter:s[1]?parseInt(s[1]):null,pressure:s[2]||null}},rt=({status:t,showIcon:s=!0})=>{if(!t)return null;const l=(x=>{const i=String(x).toLowerCase();return i==="goed"||i==="approved"?{label:"Goed",style:"bg-emerald-50 text-emerald-600 border-emerald-200",icon:e.jsx(yt,{size:12})}:i==="tijdelijke afkeur"||i==="temp_rejected"||i==="held_qc"?{label:"Herstellen",style:"bg-orange-50 text-orange-600 border-orange-200",icon:e.jsx(Mt,{size:12,className:"animate-spin-slow"})}:i==="definitieve afkeur"||i==="rejected"?{label:"Afkeur",style:"bg-rose-50 text-rose-600 border-rose-200",icon:e.jsx(St,{size:12})}:i==="finished"||i==="voltooid"?{label:"Voltooid",style:"bg-blue-50 text-blue-700 border-blue-200",icon:e.jsx(Ae,{size:12})}:i==="in production"||i==="in_progress"||i==="bezig"?{label:"Actief",style:"bg-blue-600 text-white border-blue-500 shadow-sm animate-pulse",icon:e.jsx(ke,{size:12,fill:"currentColor"})}:i==="pending"||i==="te doen"?{label:"Wachtrij",style:"bg-slate-100 text-slate-500 border-slate-200",icon:e.jsx(Ce,{size:12})}:{label:x,style:"bg-slate-50 text-slate-400 border-slate-200",icon:e.jsx(ct,{size:12})}})(t);return e.jsxs("div",{className:`
        px-3 py-1.5 rounded-full border shadow-sm
        text-[9px] font-black uppercase tracking-widest italic
        flex items-center gap-2 select-none transition-all duration-300
        ${l.style}
      `,children:[s&&l.icon,e.jsx("span",{className:"leading-none",children:l.label})]})},aa=({activeUnits:t,smartSuggestions:s,selectedStation:r,onProcessUnit:l,onClickUnit:x,onSendReminder:i})=>r==="BM01"||r==="Station BM01"?null:e.jsxs("div",{className:"col-span-12 lg:col-span-4 flex flex-col gap-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-blue-100 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-blue-50/50 p-4 border-b border-blue-100 flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-blue-800 text-sm uppercase tracking-tight flex items-center gap-2",children:[e.jsx(Ke,{size:16})," Nu Actief"]}),e.jsx("span",{className:"bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded-full",children:t.length})]}),e.jsx("div",{className:"p-2",children:t.length>0?e.jsx("div",{className:"space-y-2",children:t.map(d=>{var c,b;const n=sa(d.item),o=((c=d.inspection)==null?void 0:c.status)==="Tijdelijke afkeur",y=o&&_t((b=d.inspection)==null?void 0:b.timestamp);return e.jsxs("div",{onClick:()=>x(d),className:`p-3 bg-white border rounded-xl shadow-sm flex flex-col gap-2 cursor-pointer transition-all hover:shadow-md ${o?"border-orange-200 bg-orange-50":"border-blue-50"}`,children:[n.warning&&e.jsxs("div",{className:`mb-2 p-1.5 rounded-lg flex items-center gap-2 text-[10px] font-black uppercase tracking-wide animate-pulse ${n.colorClasses}`,children:[n.icon," ",n.warning]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-black text-gray-800",children:d.lotNumber}),d.orderId==="NOG_TE_BEPALEN"&&e.jsx("span",{className:"bg-red-100 text-red-600 px-1 py-0.5 rounded text-[8px] font-black mr-2",children:"EXTRA"}),n.type!=="EST"&&e.jsxs("div",{className:`mt-1 flex items-center gap-1 text-[10px] font-bold px-1.5 py-0.5 rounded border w-fit ${n.colorClasses}`,children:[n.icon,n.label]}),e.jsx("p",{className:"text-[10px] text-gray-500 truncate max-w-[150px] mt-0.5",children:d.item})]}),e.jsx("span",{className:"text-[10px] font-mono text-blue-500 bg-blue-50 px-1.5 py-0.5 rounded",children:d.startTime?new Date(d.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),o&&d.inspection&&e.jsxs("div",{className:"bg-white/60 p-2 rounded-lg text-[10px] border border-orange-100",children:[e.jsxs("p",{className:"font-bold text-orange-700 flex items-center gap-1",children:[e.jsx(Ee,{size:10})," Tijdelijke Afkeur"]}),d.inspection.reasons&&e.jsxs("p",{className:"text-orange-600 mt-1",children:["Reden: ",d.inspection.reasons.join(", ")]}),d.note&&e.jsxs("p",{className:"text-gray-500 italic mt-1",children:['"',d.note,'"']}),e.jsx("p",{className:"text-gray-400 mt-1 text-[9px]",children:d.inspection.timestamp?new Date(d.inspection.timestamp).toLocaleString():""}),y&&e.jsxs("div",{className:"mt-2 flex items-center justify-between bg-red-100 p-2 rounded border border-red-200",children:[e.jsxs("span",{className:"font-black text-red-700 flex items-center gap-1",children:[e.jsx(Ve,{size:14})," > 7 DAGEN!"]}),d.reminderSent?e.jsxs("span",{className:"text-[9px] text-gray-500 italic flex items-center gap-1",children:[e.jsx(Jt,{size:10})," Reminder verstuurd"]}):e.jsx("span",{className:"text-[9px] text-red-400 italic",children:"Wordt verstuurd..."})]})]}),e.jsx("div",{className:"flex gap-2 mt-2 pt-2 border-t border-slate-100",children:e.jsxs("button",{onClick:u=>{u.stopPropagation(),l(d)},className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-bold text-[10px] uppercase flex items-center justify-center gap-2",children:[e.jsx(Te,{size:14})," Klaar / Verder"]})})]},d.lotNumber)})}):e.jsxs("div",{className:"text-center py-8 text-blue-300",children:[e.jsx(ke,{size:24,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-[10px] font-bold uppercase",children:"Geen activiteit"})]})})]}),s.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl border border-purple-100 shadow-sm overflow-hidden animate-in slide-in-from-right-4 duration-500",children:[e.jsx("div",{className:"bg-purple-50/50 p-4 border-b border-purple-100",children:e.jsxs("h3",{className:"font-black text-purple-800 text-sm uppercase tracking-tight flex items-center gap-2",children:[e.jsx(Os,{size:16})," Slimme Suggesties"]})}),e.jsx("div",{className:"p-3 space-y-3",children:s.map((d,n)=>e.jsx("div",{className:"bg-purple-50 rounded-xl p-3 border border-purple-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg text-purple-600 shadow-sm",children:e.jsx(Ms,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-purple-900 leading-tight mb-1",children:"Combineer Orders?"}),e.jsxs("p",{className:"text-[10px] text-purple-700 mb-2",children:["Product ",e.jsx("strong",{children:d.product})," komt"," ",e.jsxs("strong",{children:[d.count,"x"]})," voor in week"," ",d.weeks.join(" & "),"."]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:d.orders.map(o=>e.jsxs("span",{className:"px-1.5 py-0.5 bg-white rounded text-[9px] font-mono font-bold text-purple-500 border border-purple-100",children:[o.orderId," (W",o.weekNumber,")"]},o.orderId))})]})]})},n))})]})]}),ra=({product:t,onClose:s,onConfirm:r,currentStation:l})=>{const{showWarning:x}=Ct(),[i,d]=a.useState("completed"),[n,o]=a.useState([]),[y,c]=a.useState(""),[b,u]=a.useState(!1),m=N=>{o(D=>D.includes(N)?D.filter(Z=>Z!==N):[...D,N])},S=async()=>{if(i!=="completed"&&n.length===0){x("Selecteer minimaal één reden voor afkeur","Incompleet");return}u(!0),await r(i,{reasons:n,note:y}),u(!1)},v=()=>l==="BM01"?"Afronden / Gereed":"Naar Eindinspectie (BM01)";return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col border border-slate-200",children:[e.jsxs("div",{className:"bg-slate-50 px-6 py-4 border-b border-slate-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-slate-800 uppercase tracking-tight",children:"Kwaliteitscontrole & Afronden"}),e.jsx("p",{className:"text-xs text-slate-500 font-mono font-bold",children:t.lotNumber})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-slate-200 rounded-full",children:e.jsx(Ne,{size:20,className:"text-slate-400"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>d("completed"),className:`p-3 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${i==="completed"?"border-green-500 bg-green-50 text-green-700 shadow-md transform scale-105":"border-slate-100 hover:border-green-200 text-slate-400"}`,children:[e.jsx(es,{size:24}),e.jsx("span",{className:"font-black text-xs uppercase",children:"Akkoord"})]}),e.jsxs("button",{onClick:()=>d("temp_reject"),className:`p-3 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${i==="temp_reject"?"border-orange-500 bg-orange-50 text-orange-700 shadow-md transform scale-105":"border-slate-100 hover:border-orange-200 text-slate-400"}`,children:[e.jsx(Ee,{size:24}),e.jsx("span",{className:"font-black text-xs uppercase",children:"Herstel"})]}),e.jsxs("button",{onClick:()=>d("rejected"),className:`p-3 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${i==="rejected"?"border-red-500 bg-red-50 text-red-700 shadow-md transform scale-105":"border-slate-100 hover:border-red-200 text-slate-400"}`,children:[e.jsx(St,{size:24}),e.jsx("span",{className:"font-black text-xs uppercase",children:"Afkeur"})]})]}),i!=="completed"&&e.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-100 animate-in slide-in-from-top-2",children:[e.jsxs("h4",{className:"font-bold text-red-900 text-xs uppercase mb-3 flex items-center gap-2",children:[e.jsx(Ve,{size:14})," Reden van"," ",i==="temp_reject"?"Herstel":"Afkeur"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:ea.map(N=>e.jsxs("div",{onClick:()=>m(N),className:`p-2 rounded-lg border cursor-pointer text-xs font-medium transition-all flex items-center gap-2 ${n.includes(N)?"bg-white border-red-500 text-red-700 shadow-sm":"bg-white/50 border-transparent text-slate-500 hover:bg-white"}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full border flex items-center justify-center ${n.includes(N)?"bg-red-500 border-red-500":"border-slate-300"}`,children:n.includes(N)&&e.jsx(js,{size:8,className:"text-white"})}),N]},N))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-2",children:"Opmerking (Optioneel)"}),e.jsx("textarea",{value:y,onChange:N=>c(N.target.value),className:"w-full p-3 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Bijv. kras op flensvlak...",rows:3})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 border-t border-slate-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg text-slate-500 font-bold hover:bg-slate-200 text-sm",children:"Annuleren"}),e.jsxs("button",{onClick:S,disabled:b,className:`px-6 py-2 rounded-lg font-bold text-white text-sm shadow-md flex items-center gap-2 transition-all active:scale-95 ${i==="completed"?"bg-blue-600 hover:bg-blue-700":"bg-red-600 hover:bg-red-700"}`,children:[b?e.jsx(fe,{size:14,className:"animate-spin"}):e.jsx(It,{size:16}),i==="completed"?v():"Opslaan"]})]})]})})},Gt=({product:t,isOpen:s,onClose:r,appId:l})=>{const{user:x}=Ue(),[i,d]=a.useState("Approved"),[n,o]=a.useState({}),[y,c]=a.useState(""),[b,u]=a.useState(!1),[m,S]=a.useState([]);a.useEffect(()=>{if(!s)return;const M=pe(ce(U,...G.OCCUPANCY),W=>{S(W.docs.map(C=>({id:C.id,...C.data()})))});return()=>M()},[s]);const v=["NABEWERKING","MAZAK","BM01"].includes(((t==null?void 0:t.currentStation)||"").toUpperCase()),N=v?[]:Ns[t==null?void 0:t.type]||["TW","L","Weight"],D=a.useMemo(()=>{if(!t)return{nextMachine:"",label:""};const M=(t.currentStation||t.originMachine||"").toUpperCase(),W=(t.item||"").toUpperCase();let C="",p="",F="";return["BH18","BH31","BH16"].includes(M)?(C="NABEWERKING",F="Nabewerking",p="Naar Nabewerking"):["BH12","BH17","BH11","BH15"].includes(M)?W.startsWith("FL")?(C="MAZAK",F="Mazak",p="Naar Mazak (FL Item)"):(C="NABEWERKING",F="Nabewerking",p="Naar Nabewerking"):M==="MAZAK"||M==="NABEWERKING"?(C="BM01",F="Eindinspectie",p="Naar Eindinspectie (BM01)"):M==="BM01"&&(C="GEREED",F="Finished",p="Product Voltooid"),{nextMachine:C,label:p,nextStep:F}},[t]),Z=async()=>{var M;if(!b){u(!0);try{const W=ne(U,...G.TRACKING,t.id);let C=D.nextMachine,p="in_progress",F=D.nextStep,O="Gereedgemeld";const ae=`${(M=D.nextStep)==null?void 0:M.toLowerCase()}_start`;i==="Approved"?(p=D.nextStep==="Finished"?"completed":"in_progress",O=D.label):i==="Rejected"?(p="rejected",F="REJECTED",C="AFKEUR",O="Definitief Afgekeurd"):(p="temp_reject",F="HOLD_AREA",O="In Reparatie / Herstel");const re={action:O,station:t.currentStation||t.originMachine,timestamp:new Date().toISOString(),user:(x==null?void 0:x.email)||"Operator",notes:y},I={status:p,currentStation:C,currentStep:F,releaseStatus:i,measurements:n,inspectorNotes:y,releasedAt:de(),lastStation:t.currentStation||t.originMachine,history:us(re),updatedAt:de()};if(i==="Approved"&&C&&C!=="GEREED"){const J=new Date;J.setHours(0,0,0,0);const Y=m.filter(_=>{if(_.station!==C||!_.date)return!1;const X=_.date.toDate?_.date.toDate():new Date(_.date);return X.setHours(0,0,0,0),X.getTime()===J.getTime()}).map(_=>_.operatorNumber).filter(Boolean);Y.length>0&&(I[`personnelTracking.${C}`]=Y)}if(i==="Approved"&&ae&&(I[`timestamps.${ae}`]=de()),await ve(W,I),i==="Rejected"&&t.orderId&&t.orderId!=="NOG_TE_BEPALEN")try{const J=Se(ce(U,...G.PLANNING),Be("orderId","==",t.orderId)),Y=await ze(J);if(!Y.empty){const _=Y.docs[0],X=_.data(),se=`started_${(t.originMachine||t.currentStation).replace(/[^a-zA-Z0-9]/g,"_")}`,Q=X[se]||0;Q>0&&await ve(ne(U,...G.PLANNING,_.id),{[se]:Q-1})}}catch(J){console.error("Fout bij updaten order teller:",J)}r()}catch(W){console.error("Opslagfout:",W)}finally{u(!1)}}};return!s||!t?null:e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-md animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-4xl max-h-[95vh] rounded-[40px] shadow-2xl flex flex-col overflow-hidden border border-white/10",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-slate-900 text-white rounded-2xl shadow-lg",children:e.jsx(Ae,{size:24})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h2",{className:"text-2xl font-black text-slate-900 uppercase italic tracking-tight leading-none",children:"Bewerking Afronden"}),e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1.5",children:["Lot: ",t.lotNumber," | Station: ",t.machine]})]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:e.jsx(Ne,{size:28})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-10 custom-scrollbar space-y-10 text-left",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest ml-1",children:"1. Kwaliteitscontrole"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>d("Approved"),className:`p-6 rounded-[30px] border-2 flex flex-col items-center gap-3 transition-all ${i==="Approved"?"bg-emerald-50 border-emerald-500 shadow-lg shadow-emerald-100":"bg-white border-slate-100 text-slate-400 hover:border-emerald-200"}`,children:[e.jsx(Ae,{size:32,className:i==="Approved"?"text-emerald-500":"text-slate-200"}),e.jsx("span",{className:"font-black uppercase tracking-widest text-[10px]",children:"Goedgekeurd"})]}),e.jsxs("button",{onClick:()=>d("Temp_Rejected"),className:`p-6 rounded-[30px] border-2 flex flex-col items-center gap-3 transition-all ${i==="Temp_Rejected"?"bg-amber-50 border-amber-500 shadow-lg shadow-amber-100":"bg-white border-slate-100 text-slate-400 hover:border-amber-200"}`,children:[e.jsx(Mt,{size:32,className:i==="Temp_Rejected"?"text-amber-500":"text-slate-200"}),e.jsx("span",{className:"font-black uppercase tracking-widest text-[10px]",children:"Herstellen"})]}),e.jsxs("button",{onClick:()=>d("Rejected"),className:`p-6 rounded-[30px] border-2 flex flex-col items-center gap-3 transition-all ${i==="Rejected"?"bg-red-50 border-red-500 shadow-lg shadow-red-100":"bg-white border-slate-100 text-slate-400 hover:border-red-200"}`,children:[e.jsx(Ve,{size:32,className:i==="Rejected"?"text-red-600":"text-slate-200"}),e.jsx("span",{className:"font-black uppercase tracking-widest text-[10px]",children:"Afkeur"})]})]})]}),!v&&N.length>0&&e.jsxs("section",{className:"space-y-4 animate-in fade-in",children:[e.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest ml-1",children:"2. Controlemetingen (mm)"}),e.jsx("div",{className:"bg-slate-50 p-8 rounded-[35px] border border-slate-100 grid grid-cols-2 md:grid-cols-3 gap-6",children:N.map(M=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-tighter ml-1",children:M}),e.jsx("input",{type:"text",placeholder:"Invoer...",className:"w-full bg-white border-2 border-slate-200 rounded-xl p-3 text-sm font-black text-slate-700 outline-none focus:border-blue-500 transition-all text-center",value:n[M]||"",onChange:W=>o({...n,[M]:W.target.value})})]},M))})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest ml-1",children:"3. Opmerkingen"}),e.jsxs("div",{className:"relative",children:[e.jsx(ts,{className:"absolute left-4 top-4 text-slate-300",size:20}),e.jsx("textarea",{className:"w-full bg-slate-50 border border-slate-200 rounded-3xl p-4 pl-12 min-h-[100px] outline-none focus:border-blue-500 transition-all font-medium text-sm text-slate-600",placeholder:"Eventuele bijzonderheden...",value:y,onChange:M=>c(M.target.value)})]})]})]}),e.jsxs("div",{className:"p-8 bg-slate-900 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-blue-400 text-left",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(ws,{size:20})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[8px] font-black text-slate-500 uppercase block leading-none mb-1",children:"Volgende Bestemming"}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest text-white",children:i==="Approved"?D.nextMachine==="FINISHED"?"Systeem Voltooid":D.nextMachine:"Nader te bepalen"})]})]}),e.jsxs("div",{className:"flex gap-4 w-full md:w-auto",children:[e.jsx("button",{onClick:r,className:"flex-1 md:flex-none px-8 py-4 text-white/50 hover:text-white font-black uppercase text-xs tracking-widest transition-colors",children:"Annuleren"}),e.jsxs("button",{onClick:Z,disabled:b,className:"flex-1 md:flex-none px-12 py-4 bg-blue-600 text-white rounded-2xl font-black uppercase text-xs tracking-[0.2em] shadow-xl hover:bg-blue-500 transition-all flex items-center justify-center gap-3 active:scale-95 disabled:opacity-50",children:[b?e.jsx(fe,{className:"animate-spin",size:20}):e.jsx(It,{size:20})," ","Verwerken"]})]})]})]})})},la=(t=new Date)=>{const s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),r=s.getUTCDay()||7;s.setUTCDate(s.getUTCDate()+4-r);const l=new Date(Date.UTC(s.getUTCFullYear(),0,1));return{week:Math.ceil(((s-l)/864e5+1)/7),year:s.getUTCFullYear()}},na=(t,s=[])=>{const r=new Date,l=r.getFullYear().toString().slice(-2),{week:x}=la(r),i=String(x).padStart(2,"0");let d=t.replace(/\D/g,""),n="400";d&&(d.length===3?n=d:d.length===1?n=`40${d}`:n=`4${d.padStart(2,"0")}`);const o=`40${l}${i}${n}40`,y=s.filter(b=>b.lotNumber&&b.lotNumber.toString().startsWith(o)).length,c=String(y+1).padStart(4,"0");return`${o}${c}`},ye=3.78,wt="fittings-app-v1",vt=t=>`https://api.qrserver.com/v1/create-qr-code/?size=150x150&margin=0&data=${encodeURIComponent(t)}`,kt=t=>`https://bwipjs-api.metafloor.com/?bcid=code128&text=${encodeURIComponent(t)}&scale=3&height=10&incltext&guardwhitespace`,Wt=({order:t,isOpen:s,onClose:r,onStart:l,stationId:x="",existingProducts:i=[]})=>{var re;const[d,n]=a.useState("auto"),[o,y]=a.useState(""),[c,b]=a.useState(1),[u,m]=a.useState(""),[S,v]=a.useState([]),[N,D]=a.useState(""),[Z,M]=a.useState(!1),[W,C]=a.useState(1),p=a.useRef(null);a.useEffect(()=>{(async()=>{if(s){M(!0);try{const J=ce(U,"artifacts",wt,"public","data","label_templates"),_=(await ze(J)).docs.map(X=>({id:X.id,...X.data()}));if(v(_),_.length>0){let X=_.find(oe=>oe.name.toLowerCase().includes("smal")||oe.height<45);D((X==null?void 0:X.id)||_[0].id)}}catch(J){console.error("Fout bij laden labels:",J)}finally{M(!1)}}})()},[s,wt]),a.useEffect(()=>{s&&t&&d==="auto"&&y(na(x,i||[]))},[s,t,d,x,i]);const F=a.useMemo(()=>t?vs({...t,orderNumber:t.orderId,productId:t.itemCode,description:t.item,lotNumber:o||"26-01-XXXX"}):{},[t,o]),O=a.useMemo(()=>S.find(I=>I.id===N),[S,N]);a.useEffect(()=>{if(p.current&&O){const I=p.current.clientWidth-60,J=p.current.clientHeight-180,Y=O.width*ye,_=O.height*ye;C(Math.min(1.4,I/Y,J/_))}},[O,s]);const ae=()=>{var oe;if(!O)return;const I=prompt("Hoeveel labels wilt u printen?","1");if(!I||isNaN(I)||parseInt(I)<1)return;const J=window.open("","_blank","width=800,height=600"),Y=O.width,_=O.height,X=`
      <html>
        <head>
          <style>
            @page { size: ${Y}mm ${_}mm; margin: 0; }
            body { margin: 0; padding: 0; width: ${Y}mm; height: ${_}mm; overflow: hidden; font-family: sans-serif; background: white; }
            .canvas { position: relative; width: 100%; height: 100%; }
            .el { position: absolute; color: black; line-height: 1; transform-origin: top left; }
            img { display: block; width: 100%; height: 100%; object-fit: contain; }
          </style>
          <script>
            window.onload = function() {
              for (let i = 0; i < ${I}; i++) {
                window.print();
              }
              window.close();
            };
          <\/script>
        </head>
        <body>
          <div class="canvas">
            ${(oe=O.elements)==null?void 0:oe.map(se=>{const Q=bt(se,F),w=`left:${se.x}mm; top:${se.y}mm; width:${se.width||"auto"}mm; height:${se.height||"auto"}mm; font-size:${se.fontSize}px; font-weight:${se.isBold?"900":"normal"}; transform: rotate(${se.rotation||0}deg); font-family: sans-serif; white-space: nowrap;`;return se.type==="text"?`<div class="el" style="${w}">${Q.content}</div>`:se.type==="qr"?`<div class="el" style="${w}"><img src="${vt(Q.content)}"></div>`:se.type==="barcode"?`<div class="el" style="${w}"><img src="${kt(Q.content)}"></div>`:""}).join("")}
          </div>
        </body>
      </html>
    `;J.document.write(X),J.document.close()};return!s||!t?null:e.jsx("div",{className:"fixed inset-0 bg-slate-900/90 z-[100] flex items-center justify-center p-2 md:p-4 backdrop-blur-md animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-6xl h-full md:h-[85vh] rounded-[40px] shadow-2xl flex flex-col md:flex-row overflow-hidden border border-white/10",children:[e.jsxs("div",{className:"w-full md:w-1/3 p-4 border-r border-slate-100 flex flex-col bg-slate-50/50 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("h2",{className:"text-xl font-black text-slate-900 uppercase italic tracking-tighter",children:"Order Start"}),e.jsx("p",{className:"text-[9px] text-slate-400 font-bold uppercase tracking-widest mt-0.5 text-left italic",children:x})]}),e.jsx("button",{onClick:r,className:"p-1.5 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:e.jsx(Ne,{size:20})})]}),e.jsxs("div",{className:"space-y-4 flex-1 text-left",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl border-2 border-slate-100 shadow-sm text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("div",{className:"p-1.5 bg-slate-900 text-white rounded-lg",children:e.jsx(Je,{size:14})}),e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Werkorder"})]}),e.jsx("h3",{className:"text-xl font-black text-slate-900 tracking-tight leading-none italic",children:t.orderId}),e.jsx("p",{className:"text-[10px] font-bold text-slate-500 mt-1.5 truncate uppercase",children:t.item})]}),e.jsxs("div",{className:"flex bg-slate-200 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>n("auto"),className:`flex-1 py-2 rounded-lg text-[9px] font-black uppercase tracking-widest flex items-center justify-center gap-1.5 transition-all ${d==="auto"?"bg-white text-blue-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(Pt,{size:12})," Auto"]}),e.jsxs("button",{onClick:()=>n("manual"),className:`flex-1 py-2 rounded-lg text-[9px] font-black uppercase tracking-widest flex items-center justify-center gap-1.5 transition-all ${d==="manual"?"bg-white text-blue-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(Rt,{size:12})," Manueel"]})]}),d==="auto"?e.jsxs("div",{className:"space-y-3 animate-in slide-in-from-top-2 text-left",children:[e.jsxs("div",{className:"bg-slate-900 p-4 rounded-2xl text-center shadow-xl border border-white/5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3 opacity-5",children:e.jsx(ks,{size:48})}),e.jsx("span",{className:"text-[8px] font-black text-blue-400 uppercase tracking-[0.3em] block mb-1.5",children:"Huidig Lotnummer"}),e.jsx("div",{className:"text-2xl font-mono font-black text-white italic tracking-tighter",children:o})]}),e.jsxs("div",{className:"space-y-1 text-left",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2 block",children:"Totaal Aantal"}),e.jsxs("div",{className:"flex items-center gap-3 bg-white p-3 rounded-xl border-2 border-slate-100 focus-within:border-blue-500 transition-all shadow-sm",children:[e.jsx(lt,{size:18,className:"text-blue-500"}),e.jsx("input",{type:"number",min:"1",value:c,onChange:I=>b(parseInt(I.target.value)||1),className:"w-full font-black text-slate-800 outline-none text-lg"})]})]})]}):e.jsx("div",{className:"space-y-3 animate-in slide-in-from-top-2 text-left",children:e.jsxs("div",{className:"space-y-1 text-left",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2 block",children:"Lot Handmatig Invoeren"}),e.jsx("input",{type:"text",value:u,onChange:I=>{m(I.target.value.toUpperCase()),y(I.target.value.toUpperCase())},placeholder:"YY-WW-XXXX",className:"w-full p-3 bg-white border-2 border-slate-100 rounded-2xl font-mono text-xl font-black uppercase outline-none focus:border-blue-600 shadow-sm text-center"})]})}),e.jsxs("div",{className:"pt-3 border-t border-slate-200 text-left",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase block mb-1.5 ml-2",children:"Label Formaat"}),e.jsxs("div",{className:"relative group",children:[e.jsx("select",{value:N,onChange:I=>D(I.target.value),className:"w-full p-3 bg-white border-2 border-slate-100 rounded-xl text-xs font-black text-slate-700 outline-none focus:border-blue-600 shadow-sm appearance-none cursor-pointer group-hover:border-slate-300",children:S.map(I=>e.jsxs("option",{value:I.id,children:[I.name," (",I.width,"x",I.height,"mm)"]},I.id))}),e.jsx(jt,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 flex gap-3",children:[e.jsx("button",{onClick:r,className:"flex-1 py-5 bg-white border-2 border-slate-100 text-slate-400 rounded-2xl font-black uppercase text-[10px] tracking-widest hover:bg-slate-100 transition-all",children:"Annuleer"}),e.jsxs("button",{onClick:()=>l(t,d==="auto"?o:u,c),disabled:!o,className:"flex-[2] py-5 bg-slate-900 text-white rounded-2xl font-black uppercase text-[10px] tracking-[0.15em] shadow-xl hover:bg-slate-800 transition-all flex items-center justify-center gap-3 active:scale-95 disabled:opacity-50",children:[e.jsx(ct,{size:20})," Order Starten"]})]})]}),e.jsxs("div",{ref:p,className:"flex-1 bg-slate-900 p-6 flex flex-col items-center justify-between relative overflow-hidden text-left",children:[e.jsxs("div",{className:"absolute top-4 left-4 text-[9px] font-black text-slate-500 uppercase tracking-[0.4em] flex items-center gap-2 text-left",children:[e.jsx(Ke,{size:12,className:"text-emerald-500"})," Etiket Preview"]}),e.jsx("div",{className:"flex-1 flex items-center justify-center w-full min-h-0 py-8",children:O?e.jsx("div",{className:"bg-white shadow-[0_0_100px_rgba(0,0,0,0.8)] relative transition-all duration-500 origin-center overflow-hidden border-2 border-white/10",style:{width:`${O.width*ye*W}px`,height:`${O.height*ye*W}px`},children:(re=O.elements)==null?void 0:re.map((I,J)=>{const _=bt(I,F).content,X={position:"absolute",left:`${I.x*ye*W}px`,top:`${I.y*ye*W}px`,width:I.width?`${I.width*ye*W}px`:"auto",height:I.height?`${I.height*ye*W}px`:"auto",color:"black",transform:`rotate(${I.rotation||0}deg)`,transformOrigin:"top left",overflow:"hidden",textAlign:"left"};return I.type==="text"?e.jsx("div",{style:{...X,fontSize:`${I.fontSize*W}px`,fontFamily:"sans-serif",fontWeight:I.isBold?"900":"normal",whiteSpace:"nowrap",lineHeight:"1"},children:_},J):I.type==="barcode"?e.jsx("div",{style:X,children:e.jsx("img",{src:kt(_),alt:"BC",className:"w-full h-full object-fill"})},J):I.type==="qr"?e.jsx("div",{style:X,children:e.jsx("img",{src:vt(_),alt:"QR",className:"w-full h-full object-contain"})},J):null})}):e.jsx("div",{className:"text-slate-700 p-20 border-2 border-dashed border-slate-800 rounded-[50px] animate-pulse text-xs uppercase font-black tracking-widest italic",children:"Ontwerp laden..."})}),e.jsxs("div",{className:"w-full max-w-sm bg-white/5 border border-white/10 p-4 rounded-2xl backdrop-blur-md mb-2 flex flex-col gap-3 animate-in slide-in-from-bottom-6 duration-700 text-left",children:[e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest",children:"Printer"}),e.jsx("span",{className:"text-[8px] font-black text-blue-500 uppercase bg-blue-500/10 px-2 py-0.5 rounded tracking-tighter",children:"Standaard"})]}),e.jsxs("button",{onClick:ae,disabled:!O,className:"w-full py-4 bg-blue-600 text-white rounded-xl font-black uppercase text-sm tracking-[0.2em] shadow-2xl shadow-blue-900/40 hover:bg-blue-500 active:scale-95 transition-all flex items-center justify-center gap-3 disabled:opacity-30",children:[e.jsx(jt,{size:22}),"Print Label"]}),e.jsx("p",{className:"text-[8px] text-slate-500 text-center font-bold uppercase tracking-tighter opacity-50",children:"Selecteer aantal bij print prompt"})]})]})]})})},Ut=({stationId:t,appId:s})=>{const[r,l]=a.useState([]),[x,i]=a.useState(!0),[d,n]=a.useState(null);return a.useEffect(()=>{if(!t||!s)return;i(!0);const o=ce(U,...G.TRACKING),y=pe(o,c=>{const b=c.docs.map(m=>({id:m.id,...m.data()}));ie(t);const u=b.filter(m=>{const S=ie(m.currentStation||""),v=ie(t),N=S===v,D=m.currentStep==="Lossen",Z=m.status==="in_progress"&&m.currentStep!=="Finished";return N&&D&&Z});l(u.sort((m,S)=>{var D,Z;const v=((D=m.updatedAt)==null?void 0:D.seconds)||0;return(((Z=S.updatedAt)==null?void 0:Z.seconds)||0)-v})),i(!1)},c=>{console.error("Lossen fout:",c),i(!1)});return()=>y()},[t,s]),x?e.jsx("div",{className:"p-12 text-center flex flex-col items-center gap-3",children:e.jsx(fe,{className:"animate-spin text-blue-500",size:32})}):e.jsxs("div",{className:"p-4 space-y-3 bg-white h-full overflow-y-auto custom-scrollbar text-left",children:[d&&e.jsx(Gt,{isOpen:!0,product:d,onClose:()=>n(null),appId:s}),r.length===0?e.jsxs("div",{className:"p-12 text-center bg-slate-50 rounded-[40px] border-2 border-dashed border-slate-200 opacity-40",children:[e.jsx(et,{size:48,className:"mx-auto mb-4 text-slate-300"}),e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:["Geen inkomende items voor ",t]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 ml-2",children:[e.jsx(Te,{size:16,className:"text-emerald-500"}),e.jsxs("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:["Wachtend op ontvangst (",r.length,")"]})]}),r.map(o=>e.jsxs("div",{className:"bg-white border-2 border-slate-100 rounded-[35px] p-6 shadow-sm hover:border-emerald-300 transition-all group animate-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase block mb-1",children:"Lotnummer"}),e.jsx("span",{className:"font-black text-slate-900 text-lg tracking-tighter italic",children:o.lotNumber})]}),e.jsx("div",{className:"px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-[9px] font-black uppercase",children:"Ontvangen"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-4 mb-5 border border-slate-100",children:[e.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Manufactured Item"}),e.jsx("p",{className:"text-xs font-mono font-bold text-slate-700 truncate",children:o.itemCode}),o.lastStation&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-slate-200/60 opacity-80",children:[e.jsx(zt,{size:10,className:"text-blue-500"}),e.jsxs("span",{className:"text-[8px] font-black text-slate-500 uppercase italic",children:["Herkomst: ",o.lastStation]})]})]}),e.jsxs("button",{onClick:()=>n(o),className:"w-full py-5 bg-slate-900 text-white rounded-[22px] font-black uppercase text-[10px] tracking-[0.2em] flex items-center justify-center gap-3 hover:bg-emerald-600 transition-all shadow-lg active:scale-95",children:[e.jsx(tt,{size:18})," Verwerken & Vrijgeven"]})]},o.id))]})]})},ia=({initialStation:t,onBack:s})=>{const{user:r}=Ue(),l=typeof t=="object"?t.id:t,x=typeof t=="object"?t.name:t,i=(ie(l)||"").toUpperCase().trim(),d=i==="NABEWERKING",[n,o]=a.useState(d?"lossen":"planning"),[y,c]=a.useState([]),[b,u]=a.useState([]),[m,S]=a.useState(!0),[v,N]=a.useState(null),[D,Z]=a.useState(null),[M,W]=a.useState(""),[C,p]=a.useState(!1),[F,O]=a.useState(""),[ae,re]=a.useState(!1),[I,J]=a.useState(null),[Y,_]=a.useState(new Date),[X,oe]=a.useState(!1),se=nt(Y),Q="fittings-app-v1",w=f=>{if(!f)return null;if(f.toDate)return f.toDate();const ee=new Date(f);return at(ee)?ee:null},h=f=>{const ee=w(f);if(!ee)return"text-slate-400";const V=$t(ee,new Date);return V<=7?"text-red-600 font-black":V<=14?"text-blue-600 font-black":"text-slate-600 font-bold"},E=f=>f.createdAt?(f.createdAt.toMillis?f.createdAt.toMillis():new Date(f.createdAt).getTime())>Date.now()-24*60*60*1e3:!1;a.useEffect(()=>{if(!l)return;S(!0);const f=pe(ce(U,...G.PLANNING),V=>{c(V.docs.map(xe=>({id:xe.id,...xe.data()})))},V=>{console.error("Orders listener error:",V),S(!1)}),ee=pe(ce(U,...G.TRACKING),V=>{u(V.docs.map(xe=>({id:xe.id,...xe.data()}))),S(!1)},V=>{console.error("Products listener error:",V),S(!1)});return()=>{console.log(`[Terminal ${l}] Cleanup: listeners worden afgesloten`),f(),ee()}},[l]);const g=a.useMemo(()=>y.filter(f=>(ie(f.machine)||"").toUpperCase()===i),[y,i]),H=a.useMemo(()=>b.filter(f=>(ie(f.machine)||"").toUpperCase()===i),[b,i]),k=a.useMemo(()=>{const f={};return b.forEach(ee=>{f[ee.orderId]||(f[ee.orderId]=0),f[ee.orderId]++}),f},[b]),B=a.useMemo(()=>H.filter(f=>f.status==="In Production"||f.status==="Held_QC").sort((f,ee)=>{var V,xe;return(((V=ee.updatedAt)==null?void 0:V.seconds)||0)-(((xe=f.updatedAt)==null?void 0:xe.seconds)||0)}),[H]),R=a.useMemo(()=>{const f=H.filter(V=>V.status==="In Production"||V.status==="Held_QC");if(!M)return f;const ee=M.toLowerCase();return f.filter(V=>(V.lotNumber||"").toLowerCase().includes(ee)||(V.orderId||"").toLowerCase().includes(ee))},[H,M]),K=a.useMemo(()=>{const f=g.filter(V=>V.status!=="pending"&&V.status!=="in_progress"?!1:X||M?!0:(V.weekNumber||V.week)===se);if(!M)return f.sort((V,xe)=>V.isUrgent===xe.isUrgent?0:V.isUrgent?-1:1);const ee=M.toLowerCase();return f.filter(V=>(V.orderId||"").toLowerCase().includes(ee)||(V.item||"").toLowerCase().includes(ee))},[g,se,X,M]),$=a.useMemo(()=>g.find(f=>f.id===v||f.orderId===v),[g,v]),L=a.useMemo(()=>R.find(f=>f.id===D),[R,D]),he=async(f,ee)=>{try{const V=de(),xe=String(f.orderId).trim(),Le=String(f.itemCode||f.productId).trim(),$e=`${xe}_${Le}_${ee}`.replace(/[^a-zA-Z0-9]/g,"_");await Ye(ne(U,...G.TRACKING,$e),{id:$e,orderId:f.orderId,lotNumber:ee,itemCode:Le,machine:i,stationLabel:x,status:"In Production",currentStep:"Wikkelen",createdAt:V,updatedAt:V,history:[{action:"Start Wikkelen",station:x,timestamp:new Date().toISOString(),user:(r==null?void 0:r.email)||"Operator"}],item:f.item||""}),await ve(ne(U,...G.PLANNING,f.id),{status:"in_progress",activeLot:ee,actualStart:V}),re(!1),d||o("wikkelen")}catch(V){alert("Fout: "+V.message)}};return m?e.jsx("div",{className:"flex h-screen items-center justify-center bg-white",children:e.jsx(fe,{className:"animate-spin text-blue-600",size:48})}):e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 text-slate-900 overflow-hidden animate-in fade-in",children:[!d&&e.jsx("div",{className:"p-4 bg-white border-b border-slate-200 shrink-0 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4 justify-between",children:[e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-2xl flex-1 max-w-xl",children:[e.jsx("button",{onClick:()=>o("planning"),className:`flex-1 px-4 md:px-6 py-2 rounded-xl text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all ${n==="planning"?"bg-white text-blue-600 shadow-sm":"text-slate-500"}`,children:"Planning"}),e.jsx("button",{onClick:()=>o("wikkelen"),className:`flex-1 px-4 md:px-6 py-2 rounded-xl text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all ${n==="wikkelen"?"bg-white text-orange-600 shadow-sm":"text-slate-500"}`,children:"Wikkelen"}),e.jsx("button",{onClick:()=>o("lossen"),className:`flex-1 px-4 md:px-6 py-2 rounded-xl text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all ${n==="lossen"?"bg-white text-emerald-600 shadow-sm":"text-slate-500"}`,children:"Lossen"})]}),e.jsxs("button",{onClick:()=>p(!0),className:"p-3 bg-white border-2 border-slate-100 text-slate-600 rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-slate-50 transition-all flex items-center gap-2 shadow-sm",children:[e.jsx(Rt,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Zoeken"})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:d?e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden bg-white",children:[e.jsxs("div",{className:"w-full lg:w-1/3 border-r border-slate-100 flex flex-col bg-slate-50/40",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 bg-white text-left",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 text-left leading-none",children:[e.jsx(gt,{size:16,className:"text-blue-500"})," Wachtrij Ontvangst"]}),e.jsx("span",{className:"bg-blue-100 text-blue-600 px-2 py-0.5 rounded-md text-[9px] font-black uppercase",children:B.length})]}),e.jsxs("div",{className:"relative",children:[e.jsx(st,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-300",size:16}),e.jsx("input",{type:"text",placeholder:"Filter lotnummer...",className:"w-full pl-10 pr-4 py-3 bg-slate-50 border-2 border-slate-100 rounded-2xl text-sm font-bold outline-none focus:border-blue-500 transition-all shadow-sm",value:M,onChange:f=>W(f.target.value)})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar text-left text-left",children:B.length===0?e.jsxs("div",{className:"p-10 text-center flex flex-col items-center opacity-30 mt-10",children:[e.jsx(et,{size:48,className:"text-slate-300 mb-4"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-left",children:"Geen inkomende items"})]}):B.filter(f=>{var ee;return!M||((ee=f.lotNumber)==null?void 0:ee.toLowerCase().includes(M.toLowerCase()))}).map(f=>e.jsxs("div",{onClick:()=>Z(f.id),className:`p-5 rounded-[25px] border-2 transition-all cursor-pointer flex items-center justify-between group ${D===f.id?"bg-blue-600 border-blue-600 text-white shadow-xl translate-x-1":"bg-white border-slate-100 hover:border-blue-200"}`,children:[e.jsxs("div",{className:"text-left text-left",children:[e.jsx("h4",{className:"font-black italic text-lg leading-none mb-1",children:f.lotNumber}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-[10px] font-bold uppercase tracking-tighter ${D===f.id?"text-blue-100":"text-slate-400"}`,children:["Model: ",f.itemCode]}),e.jsx("span",{className:`text-[9px] font-black px-1.5 rounded border ${D===f.id?"border-white/20 bg-white/10":"border-slate-100 bg-slate-50"}`,children:f.lastStation||"???"})]})]}),e.jsx(Fe,{size:18,className:D===f.id?"text-white":"text-slate-300"})]},f.id))})]}),e.jsx("div",{className:"flex-1 bg-slate-50 overflow-y-auto custom-scrollbar p-6 lg:p-12 text-left text-left",children:D?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"bg-slate-900 rounded-[45px] p-8 text-white shadow-2xl flex flex-col md:row justify-between items-center relative overflow-hidden text-left",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-5",children:e.jsx(et,{size:180})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("span",{className:"text-[10px] font-black text-blue-400 uppercase tracking-widest block mb-2 text-left",children:"Actueel Dossier"}),e.jsx("h2",{className:"text-4xl md:text-5xl font-black italic tracking-tighter leading-none text-left",children:L==null?void 0:L.lotNumber})]}),e.jsxs("div",{className:"bg-white/10 px-6 py-3 rounded-[20px] border border-white/5 text-right",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase block mb-1 text-left",children:"Herkomst"}),e.jsx("span",{className:"text-lg font-black text-emerald-400 uppercase italic tracking-widest",children:(L==null?void 0:L.lastStation)||"Onbekend"})]})]}),e.jsxs("div",{className:"bg-white rounded-[45px] p-8 md:p-12 border border-slate-200 shadow-sm space-y-10 text-left text-left",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-10 text-left",children:[e.jsxs("div",{className:"space-y-6 text-left",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 text-left",children:"Item Info"}),e.jsx("p",{className:"text-2xl font-black text-slate-800 italic uppercase leading-tight text-left",children:L==null?void 0:L.item})]}),e.jsxs("div",{className:"p-5 bg-slate-50 rounded-3xl border-2 border-slate-100 text-left text-left",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase block mb-1 text-left",children:"Code"}),e.jsx("p",{className:"text-sm font-mono font-black text-blue-700 text-left",children:L==null?void 0:L.itemCode})]})]}),e.jsxs("div",{className:"space-y-6 text-left text-left",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 text-left text-left text-left",children:"Gekoppelde Order"}),e.jsx("p",{className:"text-2xl font-black text-slate-800 italic leading-none text-left",children:L==null?void 0:L.orderId})]}),e.jsx(rt,{status:L==null?void 0:L.status})]})]}),e.jsxs("button",{onClick:()=>J(L),className:"w-full py-8 bg-slate-900 text-white rounded-[35px] font-black uppercase text-lg shadow-2xl hover:bg-emerald-600 transition-all flex items-center justify-center gap-6 active:scale-95 group",children:[e.jsx(tt,{size:32})," Afronden & Vrijgeven"]})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-40 text-center",children:[e.jsx(gt,{size:80,className:"text-slate-300 mb-4"}),e.jsx("h4",{className:"text-3xl font-black uppercase italic tracking-tighter",children:"Wacht op selectie"}),e.jsx("p",{className:"text-sm font-medium text-slate-400",children:"Kies een lotnummer om te verwerken"})]})})]}):e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col lg:flex-row text-left",children:n==="planning"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`w-full lg:w-5/12 p-4 md:p-6 bg-white border-r border-slate-100 flex flex-col overflow-hidden text-left ${v?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"relative mb-4 group text-left",children:[e.jsx(st,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300",size:18}),e.jsx("input",{type:"text",placeholder:"Zoek order...",className:"w-full pl-12 pr-10 py-4 bg-slate-50 border-2 border-slate-100 rounded-[20px] text-sm font-bold outline-none focus:border-blue-500 transition-all",value:M,onChange:f=>W(f.target.value)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-slate-50 p-2 rounded-[25px] border border-slate-100 mb-6 shrink-0 text-left",children:[e.jsx("button",{onClick:()=>_(Et(Y,1)),className:"p-3 bg-white rounded-2xl shadow-sm hover:text-blue-500 transition-all",children:e.jsx(ys,{size:20})}),e.jsxs("div",{className:"text-center px-4 text-left",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase block mb-0.5 text-center",children:"Week"}),e.jsx("span",{className:"text-xl font-black text-slate-900 italic tracking-tighter text-center",children:X||M?"Resultaten":se})]}),e.jsx("button",{onClick:()=>_(Ss(Y,1)),className:"p-3 bg-white rounded-2xl shadow-sm hover:text-blue-500 transition-all",children:e.jsx(Fe,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 custom-scrollbar pr-1 text-left text-left",children:K.length===0?e.jsx("div",{className:"p-12 text-center opacity-30 italic font-bold uppercase text-xs",children:"Geen orders gevonden"}):K.map(f=>{const ee=k[f.orderId]||0,V=parseInt(f.plan)||1,xe=E(f);return e.jsxs("div",{onClick:()=>N(f.id),className:`p-4 md:p-5 rounded-[25px] border-2 transition-all cursor-pointer flex items-center justify-between relative overflow-hidden text-left ${v===f.id?"bg-blue-50 border-blue-500 shadow-sm":"bg-white border-slate-100 hover:border-blue-200"}`,children:[xe&&e.jsx("div",{className:"absolute top-0 left-0 px-2 py-0.5 bg-emerald-500 text-white text-[7px] font-black uppercase tracking-tighter rounded-br-lg z-10",children:"Nieuw"}),e.jsxs("div",{className:"flex items-center gap-4 text-left text-left overflow-hidden",children:[e.jsx("div",{className:`p-3 rounded-2xl shrink-0 ${v===f.id?"bg-blue-600 text-white":"bg-slate-50 text-slate-400"}`,children:e.jsx(Je,{size:20})}),e.jsxs("div",{className:"text-left text-left overflow-hidden text-left",children:[e.jsxs("h4",{className:"font-black text-sm leading-none flex items-center gap-2 text-left",children:[f.orderId," ",xe&&e.jsx(Dt,{size:10,className:"text-emerald-500"})]}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 truncate uppercase text-left",children:f.item})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 shrink-0 text-right text-right",children:[e.jsxs("span",{className:"text-[10px] font-black text-slate-900 block italic leading-none",children:[ee," / ",V," ST"]}),e.jsx("span",{className:`text-[9px] uppercase tracking-tighter ${h(f.deliveryDate)}`,children:f.deliveryDate?Oe(w(f.deliveryDate),"dd-MM"):"--"})]})]},f.id)})})]}),e.jsx("div",{className:`flex-1 p-6 md:p-8 bg-slate-50 flex flex-col overflow-y-auto custom-scrollbar text-left text-left ${v?"flex":"hidden lg:flex"}`,children:$?e.jsxs("div",{className:"space-y-6 text-left text-left animate-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"bg-slate-900 rounded-[35px] p-6 text-white shadow-xl flex justify-between items-center relative overflow-hidden text-left text-left",children:[e.jsx("button",{onClick:()=>N(null),className:"lg:hidden p-2 text-white/50 mr-2",children:e.jsx(Me,{size:20})}),e.jsxs("div",{className:"text-left text-left flex-1",children:[e.jsx("span",{className:"text-[8px] font-black text-blue-400 uppercase block mb-1 text-left",children:"Actueel Dossier"}),e.jsx("h2",{className:"text-3xl font-black italic tracking-tighter leading-none text-left",children:$.orderId})]}),e.jsx(rt,{status:$.status})]}),e.jsxs("div",{className:"bg-white rounded-[40px] p-8 border border-slate-200 shadow-sm space-y-8 text-left text-left",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-6 text-left",children:[e.jsxs("div",{className:"space-y-2 flex-1 text-left text-left",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 text-left",children:"Omschrijving"}),e.jsx("h3",{className:"text-xl font-black text-slate-800 italic uppercase leading-tight text-left",children:$.item})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-slate-50 px-6 py-4 rounded-3xl border border-slate-100 text-center",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase block mb-1 text-center",children:"Gepland"}),e.jsxs("span",{className:"text-2xl font-black text-slate-800 italic",children:[$.plan," ST"]})]}),e.jsxs("div",{className:"bg-blue-50 px-6 py-4 rounded-3xl border border-blue-100 text-center",children:[e.jsx("span",{className:"text-[9px] font-black text-blue-500 uppercase block mb-1 text-center",children:"Nog doen"}),e.jsx("span",{className:"text-2xl font-black text-blue-600 italic",children:Math.max(0,parseInt($.plan)-(k[$.orderId]||0))})]})]})]}),e.jsxs("button",{onClick:()=>re(!0),className:"w-full py-6 bg-blue-600 text-white rounded-[30px] font-black uppercase text-base shadow-xl hover:bg-blue-500 transition-all flex items-center justify-center gap-4 active:scale-95",children:[e.jsx(ct,{size:28})," Start Productie"]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center opacity-30 text-center p-20",children:[e.jsx(Je,{size:80,className:"mb-6 text-slate-200"}),e.jsx("h4",{className:"text-2xl font-black uppercase italic text-slate-300",children:"Selecteer een order"})]})})]}):n==="wikkelen"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`w-full lg:w-5/12 p-6 bg-white border-r border-slate-100 flex flex-col overflow-hidden text-left text-left ${D?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 px-2 text-left text-left",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 text-left text-left",children:[e.jsx(ke,{size:16,className:"text-orange-500"})," Actieve Wikkelingen"]}),e.jsx("span",{className:"bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-[10px] font-black",children:R.length})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 custom-scrollbar text-left text-left",children:R.map(f=>e.jsxs("div",{onClick:()=>Z(f.id),className:`p-5 rounded-[30px] border-2 transition-all cursor-pointer flex items-center justify-between text-left ${D===f.id?"bg-orange-50 border-orange-500 shadow-md":"bg-white border-slate-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-4 text-left text-left",children:[e.jsx("div",{className:"p-3 bg-orange-50 text-orange-600 rounded-2xl",children:e.jsx(ke,{size:20})}),e.jsxs("div",{className:"text-left text-left",children:[e.jsx("h4",{className:"font-black italic leading-none mb-1",children:f.lotNumber}),e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:["Order: ",f.orderId]})]})]}),e.jsx(Fe,{size:18,className:"text-slate-300"})]},f.id))})]}),e.jsx("div",{className:`flex-1 p-6 md:p-8 bg-slate-50 flex flex-col overflow-y-auto custom-scrollbar text-left text-left ${D?"flex":"hidden lg:flex"}`,children:L?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 text-left text-left animate-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"bg-slate-900 rounded-[35px] p-6 text-white flex justify-between items-center border-4 border-orange-500/20 relative overflow-hidden shadow-xl text-left text-left text-left text-left",children:[e.jsx("button",{onClick:()=>Z(null),className:"lg:hidden p-2 text-white/50 mr-2",children:e.jsx(Me,{size:20})}),e.jsxs("div",{className:"text-left text-left flex-1",children:[e.jsx("span",{className:"text-[8px] font-black text-orange-400 uppercase block mb-1 text-left",children:"Dossier"}),e.jsx("h2",{className:"text-3xl font-black italic leading-none text-left",children:L.lotNumber})]}),e.jsx("div",{className:"p-3 bg-orange-600 rounded-2xl shadow-lg animate-pulse",children:e.jsx(ke,{size:24})})]}),e.jsxs("div",{className:"bg-white rounded-[40px] p-8 border border-slate-200 shadow-sm space-y-8 text-left text-left text-left",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 text-left",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase block mb-2 text-left",children:"Gekoppelde Order"}),e.jsx("p",{className:"text-xl font-black text-slate-800 leading-none mb-2 text-left",children:L.orderId}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase text-left",children:L.item})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase block mb-2 text-left",children:"Model"}),e.jsx("p",{className:"text-sm font-mono font-bold text-slate-600 bg-slate-50 p-3 rounded-xl border border-slate-100 text-left",children:L.itemCode})]})]}),e.jsxs("button",{onClick:()=>J(L),className:"w-full py-6 bg-slate-900 text-white rounded-[30px] font-black uppercase text-base shadow-xl hover:bg-emerald-600 transition-all flex items-center justify-center gap-4 active:scale-95",children:[e.jsx(tt,{size:28})," Product Gereedmelden"]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center opacity-30 text-center",children:[e.jsx(ke,{size:80,className:"mb-6 text-slate-200"}),e.jsx("h4",{className:"text-2xl font-black uppercase italic text-slate-300",children:"Selecteer actief lot"})]})})]}):e.jsx("div",{className:"flex-1 overflow-hidden h-full",children:e.jsx(Ut,{stationId:l,appId:Q})})})}),C&&e.jsx("div",{className:"fixed inset-0 z-[120] bg-slate-950/90 backdrop-blur-md flex items-center justify-center p-4 animate-in fade-in",children:e.jsxs("div",{className:"w-full max-w-md bg-white rounded-[40px] shadow-2xl overflow-hidden p-10 text-left text-left",children:[e.jsx("h3",{className:"text-xl font-black uppercase italic mb-6 text-left",children:"Snel Zoeken"}),e.jsx("input",{autoFocus:!0,type:"text",value:F,onChange:f=>O(f.target.value),className:"w-full p-6 bg-slate-50 border-2 border-slate-100 rounded-2xl text-2xl font-mono font-black text-slate-900 outline-none focus:border-blue-600 transition-all uppercase text-center",placeholder:"NUMMER..."}),e.jsxs("div",{className:"flex gap-4 mt-8 text-left",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 py-4 text-slate-400 font-black uppercase text-[10px]",children:"Annuleren"}),e.jsx("button",{onClick:()=>{W(F),p(!1)},className:"flex-[2] py-4 bg-blue-600 text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl active:scale-95 transition-all",children:"Zoeken"})]})]})}),ae&&$&&e.jsx(Wt,{isOpen:!0,onClose:()=>re(!1),order:$,stationId:l,onStart:he,existingProducts:b}),I&&e.jsx(Gt,{isOpen:!0,product:I,onClose:()=>{J(null),Z(null)},appId:Q})]})},oa=()=>typeof window<"u"&&window.__app_id?window.__app_id:"fittings-app-v1",ca=({order:t,onClose:s,onLinkProduct:r})=>{const[l,x]=a.useState(""),[i,d]=a.useState([]),[n,o]=a.useState(!1),y=async()=>{if(!(!l||l.length<2)){o(!0);try{const b=oa(),u=ce(U,"artifacts",b,"public","data","products"),m=Se(u,Be("name",">=",l),Be("name","<=",l+""),ms(10)),S=await ze(m);d(S.docs.map(v=>({id:v.id,...v.data()})))}catch(b){console.error("Zoekfout:",b)}finally{o(!1)}}},c=b=>{r(t.id,b),s()};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden border border-gray-100 scale-100 animate-in zoom-in-95 flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-gray-800 uppercase italic tracking-tight",children:"Koppel Product"}),e.jsxs("p",{className:"text-xs text-gray-500 font-medium font-mono",children:["Order: ",t.orderId]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(Ne,{className:"w-6 h-6 text-slate-500"})})]}),e.jsxs("div",{className:"p-8 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",placeholder:"Zoek op productnaam...",className:"flex-1 p-3 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500 outline-none",value:l,onChange:b=>x(b.target.value),onKeyDown:b=>b.key==="Enter"&&y(),autoFocus:!0}),e.jsx("button",{onClick:y,disabled:n,className:"bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm hover:bg-blue-700 transition-colors disabled:opacity-50",children:n?e.jsx(fe,{className:"animate-spin"}):"Zoek"})]}),e.jsx("div",{className:"space-y-2",children:i.map(b=>e.jsxs("div",{onClick:()=>c(b),className:"p-3 border rounded-xl hover:bg-blue-50 flex justify-between items-center transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[b.imageUrl?e.jsx("img",{src:b.imageUrl,alt:"",className:"w-10 h-10 object-cover rounded-lg bg-gray-100"}):e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-300",children:e.jsx(ss,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-gray-800",children:b.name}),e.jsx("p",{className:"text-xs text-gray-400",children:b.articleCode})]})]}),e.jsx("div",{className:"bg-emerald-500 text-white px-4 py-2 rounded-lg text-xs font-bold shadow-sm",children:"Kies"})]},b.id))})]})]})})},da=()=>typeof window<"u"&&window.__app_id?window.__app_id:"fittings-app-v1",xa=({initialStationId:t,onExit:s,searchOrder:r})=>{var xt;const{t:l}=as(),{user:x}=Ue(),{showSuccess:i,showError:d,showInfo:n,showWarning:o}=Ct(),y=At(),[c,b]=a.useState(t||"BH11"),[u,m]=a.useState("terminal"),[S,v]=a.useState([]),[N,D]=a.useState([]),[Z,M]=a.useState([]),[W,C]=a.useState([]),[p,F]=a.useState(!0),[O,ae]=a.useState(r||null),re=new Date,I=Nt(re),[J,Y]=a.useState(!1),[_,X]=a.useState(null),[oe,se]=a.useState(!1),[Q,w]=a.useState(null),[h,E]=a.useState(!1),[g,H]=a.useState(null),[k,B]=a.useState(!1),[R,K]=a.useState(null),$=da(),L=["mazak","nabewerking","bm01","station bm01"].includes((c||"").toLowerCase());a.useEffect(()=>{t&&(b(t),["Mazak","Nabewerking","BM01","Station BM01"].includes(t)?m("winding"):m("terminal"))},[t]),a.useEffect(()=>{if(O&&S.length>0){console.log(`🔍 WorkstationHub: Zoeken naar order ${O}`);const A=S.find(j=>j.orderId===O||j.id===O);A?(console.log("✅ Order gevonden:",A),X(A),m("terminal"),n(`Order ${O} geladen`)):(console.log(`⚠️ Order ${O} niet gevonden in planning`),o(`Order ${O} niet gevonden`))}},[O,S]),a.useEffect(()=>{F(!0);const A=ce(U,...G.PLANNING),j=pe(Se(A),T=>{const q=T.docs.map(ue=>{var je;const le=ue.data();let me=(je=le.plannedDate)!=null&&je.toDate?le.plannedDate.toDate():new Date,{week:be,year:ge}=Nt(me);return{id:ue.id,...le,orderId:le.orderId||le.orderNumber||ue.id,item:le.item||le.productCode||"Onbekend Item",plan:le.plan||le.quantity||0,dateObj:me,weekNumber:parseInt(le.week||le.weekNumber||be),weekYear:parseInt(le.year||ge)}});v(q),F(!1)}),P=pe(Se(ce(U,...G.TRACKING)),T=>{D(T.docs.map(q=>({id:q.id,...q.data()})))}),z=pe(ce(U,...G.OCCUPANCY),T=>{M(T.docs.map(q=>({id:q.id,...q.data()})))}),te=pe(ce(U,...G.PERSONNEL),T=>{C(T.docs.map(q=>({id:q.id,...q.data()})))});return()=>{j(),P(),z(),te()}},[]),a.useEffect(()=>{const j=setTimeout(async()=>{if(!N.length)return;const P=N.filter(z=>{var ge,je;const te=String(z.originMachine||z.currentStation||""),T=ie(c),q=ie(te);if(!(z.currentStation===c||q===T))return!1;const me=((ge=z.inspection)==null?void 0:ge.status)==="Tijdelijke afkeur"&&_t((je=z.inspection)==null?void 0:je.timestamp),be=z.reminderSent===!0;return me&&!be});for(const z of P)try{await ft(ce(U,...G.MESSAGES),{title:"⏰ Automatische Reminder: Tijdelijke Afkeur",message:`Product ${z.lotNumber} ligt al meer dan 7 dagen op ${c} ter reparatie. Graag actie.`,type:"alert",status:"unread",createdAt:de(),source:"WorkstationHub",relatedLot:z.lotNumber});const te=ne(U,...G.TRACKING,z.id||z.lotNumber);await ve(te,{reminderSent:!0,reminderSentAt:de()})}catch(te){console.error("Fout bij versturen auto-reminder:",te)}},2e3);return()=>clearTimeout(j)},[N,c]);const he=A=>{const j=(A||"").toUpperCase();return j.includes("OCHTEND")||j.includes("MORNING")||j.includes("EARLY")?"bg-amber-100 text-amber-800 border-amber-300":j.includes("AVOND")||j.includes("EVENING")||j.includes("LATE")?"bg-indigo-100 text-indigo-800 border-indigo-300":j.includes("NACHT")||j.includes("NIGHT")?"bg-purple-100 text-purple-800 border-purple-300":j.includes("DAG")||j==="DAGDIENST"?"bg-blue-100 text-blue-800 border-blue-300":"bg-slate-100 text-slate-800 border-slate-300"},f=A=>{const j=new Date,P=j.getHours(),z=j.getMinutes(),te=P*60+z,T=(A||"").toUpperCase();return T.includes("OCHTEND")||T.includes("MORNING")||T.includes("EARLY")?te>=330&&te<840:T.includes("AVOND")||T.includes("EVENING")||T.includes("LATE")?te>=840&&te<1350:T.includes("NACHT")||T.includes("NIGHT")?te>=1350||te<330:T.includes("DAG")||T==="DAGDIENST"?te>=435&&te<960:!0};a.useMemo(()=>{var te;if(!c||!Z.length||!W.length)return null;const A=new Date;A.setHours(0,0,0,0);const j=Z.filter(T=>{if(T.station!==c||!T.date)return!1;const q=T.date.toDate?T.date.toDate():new Date(T.date);return q.setHours(0,0,0,0),q.getTime()===A.getTime()}).sort((T,q)=>{var me,be;const ue=(me=T.timestamp)!=null&&me.toDate?T.timestamp.toDate():new Date(T.timestamp);return((be=q.timestamp)!=null&&be.toDate?q.timestamp.toDate():new Date(q.timestamp))-ue})[0];if(!j)return null;const P=W.find(T=>T.operatorNumber===j.operatorNumber);if(!P)return null;const z=(te=j.timestamp)!=null&&te.toDate?j.timestamp.toDate():new Date(j.timestamp);return{name:P.name||P.operatorNumber,operatorNumber:P.operatorNumber,timestamp:z,date:j.date.toDate?j.date.toDate():new Date(j.date)}},[c,Z,W]);const ee=a.useMemo(()=>{if(!c||Z.length===0||W.length===0)return[];const A=new Date;A.setHours(0,0,0,0);const j=ie(c);return Z.filter(P=>{if(ie(P.machineId||P.station)!==j||!P.date)return!1;const z=P.date.toDate?P.date.toDate():new Date(P.date);return z.setHours(0,0,0,0),z.getTime()!==A.getTime()?!1:f(P.shift)}).map(P=>{const z=W.find(te=>te.id===P.operatorNumber||te.employeeNumber===P.operatorNumber);return{...P,operatorName:P.operatorName||(z==null?void 0:z.name)||`Operator ${P.operatorNumber}`,shift:P.shift||"DAGDIENST"}})},[c,Z,W]);a.useMemo(()=>{if(!c)return[];if(c==="BM01"||c==="Station BM01")return S;const A=ie(c),j=`started_${c.replace(/[^a-zA-Z0-9]/g,"_")}`,P={};return N.forEach(z=>{z.orderId&&(z.status==="rejected"||z.currentStep==="REJECTED"||(P[z.orderId]||(P[z.orderId]={started:0,finished:0}),P[z.orderId].started++,z.currentStep==="Finished"&&P[z.orderId].finished++))}),S.filter(z=>{if(z.status==="cancelled")return!1;const te=ie(z.machine);return z.machine===c||te===A}).map(z=>{const te=P[z.orderId]||{finished:0},T=z[j]||0,q=Math.max(0,Number(z.plan||0)-T);return{...z,liveToDo:q,liveFinish:te.finished,startedAtStation:T}}).sort((z,te)=>z.dateObj-te.dateObj||String(z.orderId).localeCompare(String(te.orderId)))},[S,N,c]);const V=a.useMemo(()=>{if(!c)return[];const A=ie(c);return N.filter(j=>{if(j.currentStep==="Finished"||j.currentStep==="REJECTED")return!1;const P=String(j.originMachine||j.currentStation||""),z=ie(P);return c==="Mazak"?j.currentStation==="Mazak"||j.currentStation==="MAZAK":c==="Nabewerking"?j.currentStation==="Nabewerking"||j.currentStation==="NABW":c==="BM01"||c==="Station BM01"?j.currentStation==="BM01":c.startsWith("BH")?(P===c||z===A)&&(j.currentStep==="Wikkelen"||j.currentStep==="HOLD_AREA"):!1})},[N,c]),xe=()=>{s?s():y("/portal")},Le=async(A,j,P=1,z=!1,te=null)=>{if(!(!x||!j))try{const T=new Date,q=j.slice(0,-4),ue=parseInt(j.slice(-4),10);let le=[];for(let me=0;me<P;me++){const be=ue+me,ge=`${q}${String(be).padStart(4,"0")}`,je=ne(U,...G.TRACKING,ge),qt=N.filter(we=>we.orderId===A.orderId).length,Xt=Number(A.plan||0),ut=qt+me+1>Xt,Qt=Z.filter(we=>{if(we.station!==c||!we.date)return!1;const mt=we.date.toDate?we.date.toDate():new Date(we.date);mt.setHours(0,0,0,0);const pt=new Date;return pt.setHours(0,0,0,0),mt.getTime()===pt.getTime()}).map(we=>we.operatorNumber).filter(Boolean),He={lotNumber:ge,orderId:ut?"NOG_TE_BEPALEN":A.orderId,item:A.item,drawing:A.drawing||"",originMachine:c,currentStation:c,currentStep:"Wikkelen",status:"in_progress",startTime:T.toISOString(),createdAt:de(),updatedAt:de(),operator:x.email,timestamps:{wikkelen_start:de(),station_start:de()},personnelTracking:{[c]:Qt}};ut&&(He.isOverproduction=!0,He.originalOrderId=A.orderId,He.note="Overproductie uit string-run",le.push(ge)),await Ye(je,He)}if(le.length>0&&(await ft(ce(U,...G.MESSAGES),{title:"⚠ Overproductie Melding",message:`Op ${c} zijn ${le.length} extra producten gemaakt.`,type:"warning",status:"unread",createdAt:de(),source:"WorkstationHub"}),alert(`Let op: Er zijn ${le.length} producten meer gemaakt dan gepland.`)),A.status!=="completed"){const me=`started_${c.replace(/[^a-zA-Z0-9]/g,"_")}`,be=A[me]||0;await ve(ne(U,...G.PLANNING,A.id),{status:"in_progress",lastUpdated:de(),[me]:be+count})}se(!1)}catch(T){console.error(T),d(T.message,"Fout bij starten")}},$e=async(A,j)=>{try{await ve(ne(U,...G.PLANNING,A),{linkedProductId:j.id,linkedProductImage:j.imageUrl,lastUpdated:new Date}),i("Product succesvol gekoppeld!"),E(!1),H(null)}catch(P){console.error(P),d("Kon product niet koppelen","Koppelen mislukt")}},Kt=async(A,j)=>{if(R)try{const P=ne(U,...G.TRACKING,R.id||R.lotNumber),z=new Date;z.setHours(0,0,0,0);const te=Z.filter(q=>{if(q.station!==c||!q.date)return!1;const ue=q.date.toDate?q.date.toDate():new Date(q.date);return ue.setHours(0,0,0,0),ue.getTime()===z.getTime()}).map(q=>q.operatorNumber).filter(Boolean),T={updatedAt:de(),note:j.note||"",processedBy:(x==null?void 0:x.email)||"Unknown"};if(te.length>0&&(T[`personnelTracking.${c}`]=te),A==="completed")c==="BM01"||c==="Station BM01"?(T.currentStation="GEREED",T.currentStep="Finished",T.status="completed",T["timestamps.finished"]=de()):(T.currentStation="BM01",T.currentStep="Eindinspectie",T["timestamps.eindinspectie_start"]=de());else if(A==="temp_reject")T.inspection={status:"Tijdelijke afkeur",reasons:j.reasons,timestamp:new Date().toISOString()},T.currentStep="HOLD_AREA";else if(A==="rejected"&&(T.status="rejected",T.currentStep="REJECTED",T.currentStation="AFKEUR",T.inspection={status:"Afkeur",reasons:j.reasons,timestamp:new Date().toISOString()},R.orderId&&R.orderId!=="NOG_TE_BEPALEN"))try{const q=Se(ce(U,...G.PLANNING),Be("orderId","==",R.orderId)),ue=await ze(q);if(!ue.empty){const le=ue.docs[0],me=le.data(),ge=`started_${(R.originMachine||R.currentStation).replace(/[^a-zA-Z0-9]/g,"_")}`,je=me[ge]||0;je>0&&await ve(ne(U,...G.PLANNING,le.id),{[ge]:je-1})}}catch(q){console.error("Fout bij updaten order teller:",q)}await ve(P,T),B(!1),K(null)}catch(P){console.error("Fout bij afronden:",P),d("Kon wijzigingen niet opslaan","Fout bij opslaan")}},Vt=async A=>{const j=String(c).toLowerCase();if(j==="nabewerking"||j==="mazak"||j==="bm01"||c==="Station BM01"){K(A),B(!0);return}try{const P=ne(U,...G.TRACKING,A.id||A.lotNumber);await ve(P,{currentStep:"Lossen",updatedAt:de(),"timestamps.lossen_start":de()}),m("lossen")}catch(P){console.error("Fout bij proces:",P),d("Kon status niet updaten","Fout bij proces")}},qe=async A=>{try{const j=await ps(ne(U,...G.PRODUCTS,A));j.exists()?w({id:j.id,...j.data()}):o("Product niet gevonden in database","Niet gevonden")}catch(j){console.error(j),d("Kon product niet laden","Fout bij laden")}},Zt=A=>{const j=S.find(P=>P.orderId===A.orderId);if(j&&j.linkedProductId)qe(j.linkedProductId);else if(A.originalOrderId){const P=S.find(z=>z.orderId===A.originalOrderId);P&&P.linkedProductId?qe(P.linkedProductId):o(`Geen dossier bij order ${A.originalOrderId}`,"Dossier ontbreekt")}else o(`Geen dossier gekoppeld aan order ${A.orderId}`,"Dossier ontbreekt")};return e.jsxs("div",{className:"flex flex-col w-full h-[100dvh] bg-gray-50/50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-30 shadow-sm",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex h-16 items-center gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:xe,className:"mr-2 sm:mr-4 px-3 py-1.5 sm:px-4 sm:py-2 bg-white border border-gray-200 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-2 font-bold text-[10px] sm:text-xs uppercase tracking-wider",children:[e.jsx(rs,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Terug"})]}),e.jsx("span",{className:"text-lg sm:text-xl font-black text-gray-900 italic tracking-tight truncate max-w-[150px] sm:max-w-none",children:((xt=ta.find(A=>A.id===c))==null?void 0:xt.name)||c})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-2 px-3 py-2 bg-white rounded-lg border border-slate-200 shadow-sm",children:[e.jsx(Ce,{className:"w-4 h-4 text-slate-500"}),e.jsx("div",{className:"flex items-center gap-1.5 flex-wrap",children:ee.map((A,j)=>e.jsx("div",{className:`px-3 py-1.5 rounded-md text-xs font-bold uppercase border ${he(A.shift)}`,title:`${A.operatorName} - ${A.shift}`,children:A.operatorName},j))})]}),e.jsx("div",{className:"flex-1 hidden md:flex justify-end items-center",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsx(Ge,{size:16,className:"text-blue-600"}),e.jsxs("div",{className:"text-xs font-bold text-gray-700",children:["Week ",I.week," • ",re.toLocaleDateString("nl-NL",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]}),e.jsx("div",{className:"text-xs font-mono font-bold text-blue-600 border-l border-gray-300 pl-3",children:re.toLocaleTimeString("nl-NL",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"md:hidden relative ml-2",children:[e.jsx("button",{onClick:()=>Y(!J),className:"p-2 bg-gray-100 rounded-lg text-gray-600 active:bg-gray-200",children:J?e.jsx(Ne,{size:20}):e.jsx(ls,{size:20})}),J&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-200 p-2 flex flex-col gap-1 z-50 animate-in slide-in-from-top-2",children:[ee.length>0&&e.jsxs("div",{className:"px-3 py-3 bg-slate-50 rounded-lg border border-slate-200 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-slate-700 mb-2",children:[e.jsx(Ce,{className:"w-3 h-3"}),e.jsx("span",{children:"Ingeplande Bezetting"})]}),e.jsx("div",{className:"space-y-1.5",children:ee.map((A,j)=>e.jsx("div",{className:`px-2 py-1.5 rounded-md text-[10px] font-bold uppercase border ${he(A.shift)}`,children:A.operatorName},j))})]}),e.jsx("button",{onClick:()=>{m("terminal"),Y(!1)},className:`px-4 py-3 rounded-lg text-xs font-black uppercase text-left w-full ${u==="terminal"?"bg-blue-50 text-blue-600":"text-gray-500"}`,children:"Planning"}),e.jsx("button",{onClick:()=>{m("winding"),Y(!1)},className:`px-4 py-3 rounded-lg text-xs font-black uppercase text-left w-full ${u==="winding"?"bg-blue-50 text-blue-600":"text-gray-500"}`,children:c==="BM01"||c==="Station BM01"?"Inspectie":"Productie"}),!["BM01","Station BM01","Mazak","Nabewerking"].includes(c)&&e.jsx("button",{onClick:()=>{m("lossen"),Y(!1)},className:`px-4 py-3 rounded-lg text-xs font-black uppercase text-left w-full ${u==="lossen"?"bg-blue-50 text-blue-600":"text-gray-500"}`,children:"Lossen"}),e.jsx("button",{onClick:()=>{m("efficiency"),Y(!1)},className:`px-4 py-3 rounded-lg text-xs font-black uppercase text-left w-full ${u==="efficiency"?"bg-blue-50 text-blue-600":"text-gray-500"}`,children:"Efficiency"})]})]})})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto w-full p-2 sm:p-6 lg:p-8",children:p?e.jsx("div",{className:"flex flex-col justify-center items-center h-full",children:e.jsx(fe,{className:"animate-spin rounded-full h-12 w-12 text-blue-600 mb-4"})}):e.jsxs(e.Fragment,{children:[u==="winding"&&e.jsx(aa,{activeUnits:V,smartSuggestions:L?[]:[],selectedStation:c,onProcessUnit:Vt,onClickUnit:Zt}),u==="lossen"&&e.jsx("div",{className:"h-full bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsx(Ut,{currentUser:x,products:N,currentStation:c,stationId:c,appId:$})}),u==="terminal"&&e.jsx("div",{className:"h-full",children:e.jsx(ia,{currentUser:x,initialStation:c,products:N,onBack:()=>m("planning")})})]})}),e.jsx(Wt,{order:_,isOpen:oe,onClose:()=>se(!1),onStart:Le,stationId:c,existingProducts:N,onOpenProductInfo:qe}),Q&&e.jsx(ns,{product:Q,onClose:()=>w(null),userRole:(x==null?void 0:x.role)||"operator"}),h&&g&&e.jsx(ca,{order:g,onClose:()=>{E(!1),H(null)},onLinkProduct:$e}),k&&R&&e.jsx(ra,{product:R,onClose:()=>{B(!1),K(null)},onConfirm:Kt,currentStation:c})]})},ua=({isOpen:t,onClose:s,person:r,currentDepartment:l})=>{const[x,i]=a.useState(""),[d,n]=a.useState(""),[o,y]=a.useState(""),[c,b]=a.useState([]),[u,m]=a.useState(!1),S=Oe(new Date,"yyyy-MM-dd");a.useEffect(()=>{if(!t)return;const p=pe(ne(U,...G.FACTORY_CONFIG),F=>{if(F.exists()){const ae=(F.data().departments||[]).filter(re=>re.id!==l.id);b(ae)}});return()=>p()},[t,l]);const v=c.find(p=>p.id===x),N=v?v.stations||[]:[],D=v?v.shifts||[]:[],Z=p=>{try{const F=_e(p.start,"HH:mm",new Date);let ae=(_e(p.end,"HH:mm",new Date)-F)/(1e3*60*60);ae<0&&(ae+=24);const re=p.id==="DAGDIENST"?.75:0;return Math.max(0,ae-re)}catch{return 8}},M=D.find(p=>p.id===o),W=M?Z(M):0,C=async()=>{if(!(!x||!d||!o||!r)){m(!0);try{const p=D.find(O=>O.id===o);if(!p){alert("Selecteer een geldige shift."),m(!1);return}const F=`loan_${r.operatorNumber}_${x}_${Date.now()}`;await Ye(ne(U,...G.OCCUPANCY,F),{operatorNumber:r.operatorNumber,operatorName:r.operatorName,machineId:d,departmentId:x,date:S,shift:p.label,shiftStart:p.start,shiftEnd:p.end,hoursWorked:Z(p),isPloeg:p.id!=="DAGDIENST",isLoan:!0,loanFromDepartment:l.id,loanFromStation:r.machineId,originalShift:r.shift,timestamp:new Date().toISOString()}),s()}catch(p){console.error("Fout bij uitlenen personeel:",p),alert("Er is een fout opgetreden bij het uitlenen van personeel.")}finally{m(!1)}}};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-[40px] shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-8 text-white",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black uppercase italic tracking-tighter",children:"Personeel Uitlenen"}),e.jsx("p",{className:"text-sm text-blue-100 mt-2 font-bold",children:"Tijdelijk toewijzen aan andere afdeling"})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/20 rounded-xl transition-colors",children:e.jsx(Ne,{size:24})})]})}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"bg-slate-50 p-6 rounded-3xl border-2 border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-slate-800 rounded-xl",children:e.jsx(dt,{size:20,className:"text-white"})}),e.jsx("h3",{className:"text-lg font-black text-slate-800 uppercase italic",children:"Huidige Toewijzing"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-slate-600",children:"Naam:"}),e.jsx("span",{className:"text-sm font-black text-slate-900 uppercase italic",children:r==null?void 0:r.operatorName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-slate-600",children:"Afdeling:"}),e.jsx("span",{className:"text-sm font-black text-slate-900 uppercase italic",children:l==null?void 0:l.name})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-slate-600",children:"Station:"}),e.jsx("span",{className:"text-sm font-black text-slate-900 uppercase italic",children:r==null?void 0:r.machineId})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-slate-600",children:"Shift:"}),e.jsxs("span",{className:"text-sm font-black text-slate-900",children:[r==null?void 0:r.shiftStart," - ",r==null?void 0:r.shiftEnd]})]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(Te,{size:24,className:"text-blue-600"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-xl",children:e.jsx(is,{size:20,className:"text-white"})}),e.jsx("h3",{className:"text-lg font-black text-slate-800 uppercase italic",children:"Uitlenen Aan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-slate-600 uppercase tracking-widest mb-2",children:"Doel Afdeling"}),e.jsxs("select",{value:x,onChange:p=>{i(p.target.value),n("")},className:"w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900 focus:outline-none focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"",children:"-- Selecteer afdeling --"}),c.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]}),x&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 duration-300",children:[e.jsx("label",{className:"block text-xs font-black text-slate-600 uppercase tracking-widest mb-2",children:"Doel Station"}),e.jsxs("select",{value:d,onChange:p=>n(p.target.value),className:"w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900 focus:outline-none focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"",children:"-- Selecteer station --"}),N.map(p=>e.jsx("option",{value:p.name,children:p.name},p.id))]})]}),x&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 duration-300",children:[e.jsx("label",{className:"block text-xs font-black text-slate-600 uppercase tracking-widest mb-2",children:"Shift Planning"}),e.jsxs("select",{value:o,onChange:p=>y(p.target.value),className:"w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900 focus:outline-none focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"",children:"-- Selecteer shift --"}),D.map(p=>e.jsxs("option",{value:p.id,children:[p.label," (",p.start," - ",p.end,")"]},p.id))]}),M&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-bold text-blue-900",children:"Gewerkte uren:"}),e.jsxs("span",{className:"font-black text-blue-600",children:[W.toFixed(1)," uur"]})]})})]})]}),e.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{size:20,className:"text-amber-600 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-sm font-bold text-amber-900",children:[e.jsx("strong",{children:"Let op:"})," De persoon krijgt de shift-tijden van de gekozen afdeling en shift. De originele planning blijft behouden voor referentie."]})})]})})]}),e.jsxs("div",{className:"p-8 bg-slate-50 flex justify-end gap-4 border-t-2 border-slate-200",children:[e.jsx("button",{onClick:s,className:"px-6 py-3 bg-white border-2 border-slate-200 rounded-2xl font-black text-slate-700 uppercase text-sm hover:bg-slate-100 transition-all",children:"Annuleren"}),e.jsx("button",{onClick:C,disabled:!x||!d||!o||u,className:"px-6 py-3 bg-blue-600 text-white rounded-2xl font-black uppercase text-sm hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Bezig..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:16}),"Uitlenen"]})})]})]})}):null},ma=({scope:t,machines:s=[],editable:r=!0})=>{Ue();const[l,x]=a.useState([]),[i,d]=a.useState([]),[n,o]=a.useState({departments:[]}),[y,c]=a.useState(!0),[b,u]=a.useState(null),[m,S]=a.useState({}),[v,N]=a.useState(null),[D,Z]=a.useState(!1),[M,W]=a.useState(null),[C,p]=a.useState(null),[F,O]=a.useState(!1),[ae,re]=a.useState(null),[I,J]=a.useState(null),Y=Oe(new Date,"yyyy-MM-dd"),_=Ls(new Date,{weekStartsOn:0});a.useEffect(()=>{console.log("[PersonnelOccupancy] Starting data sync..."),console.log("[PersonnelOccupancy] PATHS.PERSONNEL:",G.PERSONNEL),console.log("[PersonnelOccupancy] PATHS.OCCUPANCY:",G.OCCUPANCY),console.log("[PersonnelOccupancy] PATHS.FACTORY_CONFIG:",G.FACTORY_CONFIG);const w=pe(Se(ce(U,...G.PERSONNEL),fs("name")),g=>{console.log("[PersonnelOccupancy] Personnel loaded:",g.docs.length),x(g.docs.map(H=>({id:H.id,...H.data()})))},g=>{console.error("[PersonnelOccupancy] Personnel listener error:",g),x([])}),h=pe(ce(U,...G.OCCUPANCY),g=>{console.log("[PersonnelOccupancy] Occupancy loaded:",g.docs.length),d(g.docs.map(H=>({id:H.id,...H.data()})))},g=>{console.error("[PersonnelOccupancy] Occupancy listener error:",g),d([])}),E=pe(ne(U,...G.FACTORY_CONFIG),g=>{if(g.exists()){console.log("[PersonnelOccupancy] Factory config loaded"),o(g.data());const H={};(g.data().departments||[]).forEach(k=>{H[k.id]=!0}),S(H)}else console.warn("[PersonnelOccupancy] Factory config document does not exist"),o({departments:[]});c(!1)},g=>{console.error("[PersonnelOccupancy] Factory config listener error:",g),o({departments:[]}),c(!1)});return()=>{console.log("[PersonnelOccupancy] Cleanup: closing listeners"),w(),h(),E()}},[]);const X=(w,h)=>{var B,R;const E=(n.departments||[]).find(K=>K.id===h),g={label:"DAGDIENST",start:"07:30",end:"16:15"};let H=null,k=!1;if(!E||!E.shifts||E.shifts.length===0)H=g;else if((B=w.rotationSchedule)!=null&&B.enabled&&((R=w.rotationSchedule.shifts)==null?void 0:R.length)>0){k=!0;const K=w.rotationSchedule.startWeek||1,$=w.rotationSchedule.shifts,he=((_-K)%$.length+$.length)%$.length,f=$[he];H=E.shifts.find(ee=>ee.id===f)||E.shifts[0]}else if(w.rotationType==="STATIC")H=E.shifts.find(K=>K.id===w.shiftId)||g,w.shiftId!=="DAGDIENST"&&w.shiftId&&(k=!0);else if(w.rotationType==="RELATIVE"){k=!0;const K=w.startWeek||_,$=Math.abs(_-K)%2!==0,L=E.shifts.findIndex(f=>f.id===w.startShiftId),he=$?L===0?1:0:L===-1?0:L;H=E.shifts[he]||E.shifts[0]}else H=E.shifts.find(K=>K.id===w.shiftId)||g,w.shiftId!=="DAGDIENST"&&w.shiftId&&(k=!0);try{const K=_e(H.start,"HH:mm",new Date);let L=(_e(H.end,"HH:mm",new Date)-K)/(1e3*60*60);return L<0&&(L+=24),{...H,hours:Math.max(0,L-(k?0:.75)),isPloeg:k}}catch{return{...g,hours:8,isPloeg:!1}}};a.useEffect(()=>{if(l.length===0||i.length===0)return;const h=setTimeout(async()=>{const E=[];if(i.forEach(g=>{const H=l.find(K=>K.employeeNumber===g.operatorNumber);if(!H)return;const k=X(H,g.departmentId),B=g.shift||"",R=k.label||"";g.date===Y&&B!==R&&(console.log(`⚠️ Shift mismatch voor ${H.name}: opgeslagen="${B}", actueel="${R}"`),E.push(g.id))}),E.length>0){console.log(`🧹 Cleaning up ${E.length} verkeerde occupancy records...`);for(const g of E)try{await ht(ne(U,...G.OCCUPANCY,g))}catch(H){console.error("Cleanup error:",H)}}},2e3);return()=>clearTimeout(h)},[l,i,Y]);const oe=a.useMemo(()=>{let w=0,h=0;const E=i.filter(k=>k.date===Y&&k.operatorNumber),g=new Set,H=new Set;return E.forEach(k=>{const B=parseFloat(k.hoursWorked||0);w+=B,g.add(k.operatorNumber);const R=(k.machineId||"").toUpperCase();(R.startsWith("BH")||R.startsWith("BA"))&&(h+=B,H.add(k.operatorNumber))}),{daily:w,activeCount:g.size,productionHours:h,productionCount:H.size,supportHours:w-h}},[i,Y]),se=a.useMemo(()=>{const w=n.departments||[],h=(t||"").toLowerCase();let E=t==="all"?w:w.filter(g=>g.id.toLowerCase()===h||g.slug===h||g.name.toLowerCase().includes(h));return console.log("[PersonnelOccupancy displaySections] scope:",t,"allDepts:",w.length,"filtered:",E.length,"filtered names:",E.map(g=>g.name)),E.length===0&&t!=="all"&&console.warn("[PersonnelOccupancy] No departments found for scope:",t,"all departments:",w.map(g=>({id:g.id,slug:g.slug,name:g.name}))),E.map(g=>({...g,stations:[...g.stations||[]].sort((H,k)=>H.name.toLowerCase().includes("teamleader")?-1:1)}))},[n.departments,t]);if(y)return e.jsx("div",{className:"p-20 text-center",children:e.jsx(fe,{className:"animate-spin mx-auto text-blue-600",size:48})});const Q=w=>{const h=(w||"").toUpperCase();return h.includes("OCHTEND")||h.includes("MORNING")||h.includes("EARLY")?{bg:"bg-amber-50",border:"border-amber-300",text:"text-amber-800",badge:"bg-amber-100 text-amber-700",ring:"ring-amber-100"}:h.includes("AVOND")||h.includes("EVENING")||h.includes("LATE")?{bg:"bg-indigo-50",border:"border-indigo-300",text:"text-indigo-800",badge:"bg-indigo-100 text-indigo-700",ring:"ring-indigo-100"}:h.includes("NACHT")||h.includes("NIGHT")?{bg:"bg-purple-50",border:"border-purple-300",text:"text-purple-800",badge:"bg-purple-100 text-purple-700",ring:"ring-purple-100"}:h.includes("DAG")||h==="DAGDIENST"?{bg:"bg-blue-50",border:"border-blue-300",text:"text-blue-800",badge:"bg-blue-100 text-blue-700",ring:"ring-blue-100"}:{bg:"bg-slate-50",border:"border-slate-300",text:"text-slate-800",badge:"bg-slate-100 text-slate-700",ring:"ring-slate-100"}};return!n.departments||n.departments.length===0?e.jsxs("div",{className:"p-20 text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-6 bg-amber-50 rounded-3xl border-2 border-amber-200",children:e.jsx(Ee,{className:"text-amber-600 mx-auto",size:48})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase",children:"Geen Fabrieksstructuur Gevonden"}),e.jsx("p",{className:"text-sm text-slate-600 max-w-md mx-auto",children:"De fabrieksstructuur (afdelingen en werkstations) is nog niet geconfigureerd."})]}),e.jsxs("div",{className:"text-xs text-slate-500 font-mono bg-slate-100 p-4 rounded-xl max-w-2xl mx-auto text-left",children:[e.jsx("p",{className:"font-bold mb-2",children:"Debug Info:"}),e.jsxs("p",{children:["Path: ",G.FACTORY_CONFIG.join("/")]}),e.jsxs("p",{children:["Personnel: ",l.length," records"]}),e.jsxs("p",{children:["Occupancy: ",i.length," records"]})]}),e.jsx("button",{onClick:()=>window.location.href="/admin/database",className:"px-6 py-3 bg-blue-600 text-white rounded-2xl font-bold uppercase text-xs tracking-widest hover:bg-blue-700 transition-all",children:"Ga naar Database Setup"})]}):e.jsxs("div",{className:"space-y-6 text-left animate-in fade-in duration-500 w-full pb-32 px-1",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-[35px] border-2 border-slate-100 shadow-sm text-left",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1",children:"Totaal Man-uren"}),e.jsxs("div",{className:"flex items-baseline gap-2 text-left",children:[e.jsx("span",{className:"text-3xl font-black text-slate-900 italic tracking-tighter",children:oe.daily.toFixed(1)}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Uur"})]}),e.jsxs("div",{className:"text-[9px] text-slate-500 mt-2",children:[oe.activeCount," operators"]})]}),e.jsxs("div",{className:"bg-emerald-600 p-6 rounded-[35px] shadow-lg text-white text-left",children:[e.jsx("span",{className:"text-[9px] font-black text-emerald-100/50 uppercase tracking-widest block mb-1 text-left",children:"Productie Uren"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-black italic tracking-tighter",children:oe.productionHours.toFixed(1)}),e.jsx("span",{className:"text-[10px] font-bold text-emerald-200 uppercase",children:"Uur"})]}),e.jsxs("div",{className:"text-[9px] text-emerald-200 mt-2",children:[oe.productionCount," op BH/BA stations"]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-[35px] shadow-xl text-white text-left",children:[e.jsx("span",{className:"text-[9px] font-black text-blue-400 uppercase tracking-widest block mb-1 text-left",children:"Ondersteuning"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-black italic tracking-tighter",children:oe.supportHours.toFixed(1)}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Uur"})]}),e.jsx("div",{className:"text-[9px] text-slate-500 mt-2",children:"Overige stations"})]}),e.jsxs("div",{className:"bg-blue-600 p-6 rounded-[35px] shadow-lg text-white text-left",children:[e.jsx("span",{className:"text-[9px] font-black text-blue-100/50 uppercase tracking-widest block mb-1 text-left",children:"Efficiency"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-3xl font-black italic tracking-tighter",children:[oe.daily>0?Math.round(oe.productionHours/oe.daily*100):0,"%"]})}),e.jsxs("div",{className:"text-[9px] text-blue-200 mt-2",children:["Week ",_]})]})]}),se.map(w=>e.jsxs("section",{className:"space-y-4 text-left",children:[e.jsxs("div",{className:"w-full flex items-center justify-between border-b-2 border-slate-200 pb-3 ml-2 p-2 rounded-xl",children:[e.jsxs("button",{onClick:()=>S(h=>({...h,[w.id]:!h[w.id]})),className:"flex items-center gap-3 text-left flex-1 hover:bg-slate-100/50 p-2 rounded-xl transition-all",children:[e.jsx("div",{className:"p-2 bg-slate-800 text-white rounded-xl shadow-md",children:e.jsx(lt,{size:16})}),e.jsx("h3",{className:"text-lg font-black text-slate-800 uppercase italic tracking-tight",children:w.name})]}),r&&e.jsx("button",{onClick:()=>{J(w),O(!0)},className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-xl transition-all",title:"Personeel toevoegen",children:e.jsx(Ft,{size:20})}),e.jsx("button",{onClick:()=>S(h=>({...h,[w.id]:!h[w.id]})),className:"p-2",children:e.jsx(bs,{className:`transition-transform duration-300 ${m[w.id]!==!1?"":"rotate-180"}`,size:20})})]}),m[w.id]!==!1&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 animate-in zoom-in-95 duration-200 text-left",children:w.stations.map(h=>{const E=h.name,g=E.toLowerCase().includes("teamleader"),H=i.filter(R=>ie(R.machineId)===ie(E)&&R.date===Y&&R.departmentId===w.id),k=H.length>0,B={};return H.forEach(R=>{const K=R.shift||"DAGDIENST";B[K]||(B[K]=[]),B[K].push(R)}),e.jsxs("div",{className:`p-5 rounded-[35px] border-2 transition-all duration-500 relative flex flex-col shadow-sm ${g?k?"bg-slate-900 border-amber-400 ring-4 ring-amber-400/10 shadow-xl":"bg-slate-900 border-slate-800 opacity-80 shadow-inner":k?"bg-white border-blue-500 ring-4 ring-blue-50/50":"bg-white border-slate-100 hover:border-blue-200"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4 text-left",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:`text-[8px] font-black uppercase tracking-widest block mb-0.5 ${g?"text-amber-500 italic":"text-slate-400 opacity-60"}`,children:g?"Regie":"Station ID"}),e.jsx("h4",{className:`text-lg font-black tracking-tighter italic uppercase truncate leading-none ${g?"text-white":"text-slate-900"}`,children:E})]}),g?e.jsx(yt,{size:20,className:k?"text-amber-400":"text-slate-600"}):e.jsx(Ze,{size:20,className:k?"text-blue-600":"text-slate-200"})]}),e.jsxs("div",{className:"space-y-2 mb-4 flex-1 text-left text-left",children:[Object.entries(B).map(([R,K])=>{const $=Q(R);return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`h-1 flex-1 rounded ${$.badge}`}),e.jsx("span",{className:`text-[8px] font-black uppercase tracking-wider ${$.text}`,children:R}),e.jsx("div",{className:`h-1 flex-1 rounded ${$.badge}`})]}),K.map(L=>{var he;return e.jsxs("div",{className:`p-3 rounded-2xl border-2 flex flex-col gap-2 animate-in slide-in-from-right-1 ${g?"bg-white/5 border-white/10 text-white":`${$.bg} ${$.border}`} ${L.isLoan?"ring-2 ring-green-400":`ring-1 ${$.ring}`}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-left",children:[e.jsxs("div",{className:"text-left overflow-hidden text-left flex-1",children:[e.jsx("h5",{className:`text-sm font-black uppercase italic truncate mb-0.5 text-left ${g?"text-amber-400":$.text}`,children:L.operatorName}),e.jsxs("div",{className:"flex items-center gap-1.5 opacity-70 text-left flex-wrap",children:[e.jsx("span",{className:`text-[7px] font-black px-1.5 py-0.5 rounded ${L.isPloeg?"bg-rose-100 text-rose-700":"bg-emerald-100 text-emerald-700"}`,children:L.isPloeg?"PLOEG":"DAG"}),e.jsxs("span",{className:`text-[7px] font-bold uppercase ${g?"text-slate-400":"text-slate-600"}`,children:["#",L.operatorNumber]}),L.isLoan&&e.jsx("span",{className:"text-[7px] font-black px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"UITGELEEND"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r&&!L.isLoan&&e.jsx("button",{onClick:()=>{W(L),p(w),Z(!0)},className:"p-1 text-blue-400 hover:text-blue-600 transition-colors",title:"Uitlenen aan andere afdeling",children:e.jsx(Te,{size:14})}),e.jsx("button",{onClick:()=>ht(ne(U,...G.OCCUPANCY,L.id)),className:"p-1 text-slate-400 hover:text-rose-500 transition-colors",children:e.jsx(Ne,{size:14})})]})]}),e.jsxs("div",{className:`pt-2 border-t flex items-center justify-between ${g?"border-white/5":"border-slate-300/60"}`,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ce,{size:10,className:$.text}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-tighter text-slate-500",children:"Inzet:"})]}),e.jsxs("span",{className:`text-[10px] font-black ${g?"text-white":$.text}`,children:[((he=L.hoursWorked)==null?void 0:he.toFixed(1))||0,"u"]})]})]},L.id)})]},R)}),!k&&e.jsx("div",{className:`py-4 border border-dashed rounded-2xl flex flex-col items-center justify-center opacity-40 ${g?"border-white/10":"border-slate-200"}`,children:e.jsx("span",{className:`text-[7px] font-black uppercase tracking-widest text-center ${g?"text-slate-600":"text-slate-400"}`,children:"Vrij"})})]})]},h.id)})})]},w.id)),e.jsx(ua,{isOpen:D,onClose:()=>{Z(!1),W(null),p(null)},person:M,currentDepartment:C}),F&&I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl animate-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-black text-slate-900 uppercase italic",children:"Personeel toevoegen"}),e.jsx("button",{onClick:()=>O(!1),className:"p-2 hover:bg-slate-100 rounded-xl transition-all",children:e.jsx(Ne,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-black text-slate-400 uppercase tracking-widest block mb-2",children:"Station"}),e.jsxs("select",{value:(ae==null?void 0:ae.id)||"",onChange:w=>{var h;return re(((h=I.stations)==null?void 0:h.find(E=>E.id===w.target.value))||null)},className:"w-full p-3 border-2 border-slate-200 rounded-xl text-sm font-bold focus:outline-none focus:border-blue-600",children:[e.jsx("option",{value:"",children:"Selecteer een station..."}),(I.stations||[]).map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-black text-slate-400 uppercase tracking-widest block mb-2",children:"Personeelslid"}),e.jsxs("select",{onChange:w=>{const h=l.find(E=>E.id===w.target.value);if(h&&ae){const E=X(h,I.id),g=Date.now(),H=`${I.id}-${ae.id}-${h.id}-${g}`;Ye(ne(U,...G.OCCUPANCY,H),{departmentId:I.id,machineId:ae.id,operatorNumber:h.id,operatorName:h.name,date:Y,hoursWorked:E.hours||0,isPloeg:E.isPloeg,shift:E.label||"DAGDIENST",isLoan:!1},{merge:!0}),O(!1)}},className:"w-full p-3 border-2 border-slate-200 rounded-xl text-sm font-bold focus:outline-none focus:border-blue-600",children:[e.jsx("option",{value:"",children:"Selecteer personeelslid..."}),l.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-200",children:e.jsx("button",{onClick:()=>O(!1),className:"w-full px-4 py-2 bg-slate-100 text-slate-700 rounded-xl font-bold uppercase text-xs tracking-wider hover:bg-slate-200 transition-all",children:"Annuleren"})})]})]})})]})},pa=({stationId:t,allOrders:s,allProducts:r,onClose:l})=>{const[x,i]=a.useState("active"),[d,n]=a.useState("week"),o=ie(t),y=a.useMemo(()=>r.filter(u=>{if(u.currentStep==="Finished"||u.currentStep==="REJECTED")return!1;const m=String(u.originMachine||u.currentStation||"");return ie(m)===o}),[r,o]),c=a.useMemo(()=>{const u=s.filter(v=>v.normMachine===o&&v.status!=="completed").sort((v,N)=>v.weekYear!==N.weekYear?v.weekYear-N.weekYear:v.weekNumber!==N.weekNumber?v.weekNumber-N.weekNumber:v.dateObj-N.dateObj),m=u.reduce((v,N)=>{const D=N.weekNumber||Xe(new Date).week;return v[D]||(v[D]=[]),v[D].push(N),v},{}),S=Object.keys(m).sort((v,N)=>v-N);return{groups:m,sortedWeeks:S,total:u.length}},[s,o]),b=a.useMemo(()=>{const u=new Date,m=Xe(u);return r.filter(S=>{var Z;const v=String(S.originMachine||S.currentStation||"");if(ie(v)!==o||S.currentStep!=="Finished")return!1;const N=(Z=S.updatedAt)!=null&&Z.toDate?S.updatedAt.toDate():new Date(S.updatedAt||0),D=Xe(N);if(d==="week")return D.year===m.year&&D.week===m.week;if(d==="2weeks"){const M=Math.abs(u-N);return Math.ceil(M/(1e3*60*60*24))<=14}if(d==="month"){const M=Math.abs(u-N);return Math.ceil(M/(1e3*60*60*24))<=30}return!0}).sort((S,v)=>{var N,D;return(((N=v.updatedAt)==null?void 0:N.seconds)||0)-(((D=S.updatedAt)==null?void 0:D.seconds)||0)})},[r,o,d]);return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-4xl overflow-hidden border border-gray-100 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${y.length>0?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"}`,children:e.jsx(Ke,{size:24,className:y.length>0?"animate-pulse":""})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-gray-800 uppercase italic tracking-tight",children:t}),e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:y.length>0?"Productie Actief":"Station Standby"})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(Ne,{className:"w-6 h-6 text-slate-500"})})]}),e.jsxs("div",{className:"flex border-b border-gray-100 px-6 gap-6 bg-white sticky top-0 z-10",children:[e.jsxs("button",{onClick:()=>i("active"),className:`py-4 text-sm font-bold uppercase tracking-wider border-b-2 transition-colors flex items-center gap-2 ${x==="active"?"border-blue-600 text-blue-600":"border-transparent text-gray-400 hover:text-gray-600"}`,children:[e.jsx(ke,{size:16})," Nu Actief (",y.length,")"]}),e.jsxs("button",{onClick:()=>i("planning"),className:`py-4 text-sm font-bold uppercase tracking-wider border-b-2 transition-colors flex items-center gap-2 ${x==="planning"?"border-blue-600 text-blue-600":"border-transparent text-gray-400 hover:text-gray-600"}`,children:[e.jsx(Ge,{size:16})," Planning (",c.total,")"]}),e.jsxs("button",{onClick:()=>i("history"),className:`py-4 text-sm font-bold uppercase tracking-wider border-b-2 transition-colors flex items-center gap-2 ${x==="history"?"border-blue-600 text-blue-600":"border-transparent text-gray-400 hover:text-gray-600"}`,children:[e.jsx(zt,{size:16})," Historie"]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto custom-scrollbar bg-slate-50/30 flex-1",children:[x==="active"&&e.jsx("div",{className:"space-y-3",children:y.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(ke,{size:48,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{className:"text-sm font-bold uppercase",children:"Geen actieve productie op dit moment."})]}):y.map(u=>{var m;return e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-blue-100 shadow-sm flex justify-between items-center border-l-4 border-l-green-500 animate-in slide-in-from-bottom-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-black text-gray-800",children:u.lotNumber}),e.jsx("p",{className:"text-sm font-bold text-gray-500",children:u.item})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"bg-green-100 text-green-700 px-3 py-1 rounded-lg text-xs font-bold uppercase animate-pulse inline-block mb-1",children:"Draaiend"}),e.jsxs("p",{className:"text-[10px] text-gray-400 font-bold uppercase",children:["Operator: ",((m=u.operator)==null?void 0:m.split("@")[0])||"Unknown"]})]})]},u.id)})}),x==="planning"&&e.jsxs("div",{className:"space-y-6",children:[c.sortedWeeks.map(u=>e.jsxs("div",{className:"animate-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsxs("span",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:["Week ",u]}),e.jsx("div",{className:"h-px bg-slate-200 flex-1"})]}),e.jsx("div",{className:"space-y-2",children:c.groups[u].map(m=>e.jsxs("div",{className:"bg-white p-3 rounded-xl border border-gray-200 shadow-sm flex justify-between items-center hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-blue-50 w-10 h-10 rounded-lg flex items-center justify-center font-black text-blue-600 text-xs",children:m.plan}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-black text-gray-800",children:m.orderId}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1",children:m.item})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`text-[10px] font-bold uppercase px-2 py-1 rounded ${m.status==="in_progress"?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-500"}`,children:m.status==="in_progress"?"Actief":"Gepland"}),m.liveFinish>0&&e.jsxs("p",{className:"text-[10px] text-green-600 font-bold mt-1",children:[m.liveFinish," gereed"]})]})]},m.id))})]},u)),c.total===0&&e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(Ge,{size:32,className:"mx-auto mb-2 opacity-20"}),e.jsx("p",{className:"text-xs font-bold uppercase",children:"Geen orders gepland"})]})]}),x==="history"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex bg-white p-1 rounded-lg border border-gray-200 w-fit",children:["week","2weeks","month","all"].map(u=>e.jsx("button",{onClick:()=>n(u),className:`px-3 py-1.5 rounded-md text-xs font-bold uppercase transition-all ${d===u?"bg-blue-50 text-blue-600 shadow-sm":"text-gray-400 hover:text-gray-600"}`,children:u==="all"?"Alles":u},u))}),e.jsxs("p",{className:"text-xs text-gray-400 font-bold uppercase tracking-widest pl-1",children:[b.length," items gereed"]}),e.jsx("div",{className:"space-y-2",children:b.map(u=>e.jsxs("div",{className:"bg-white p-3 rounded-xl border border-gray-100 flex justify-between items-center opacity-75 hover:opacity-100 transition-opacity",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700",children:u.lotNumber}),e.jsx("p",{className:"text-xs text-gray-400 line-clamp-1",children:u.item})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-[10px] font-bold uppercase",children:"Gereed"}),e.jsx("p",{className:"text-[10px] text-gray-400 font-mono mt-0.5",children:gs(u.updatedAt)})]})]},u.id))})]})]})]})})},fa=({orders:t=[],selectedOrderId:s,onSelect:r})=>{const[l,x]=a.useState(""),i=a.useMemo(()=>{const n=(l||"").toLowerCase().trim();return n?t.filter(o=>{const y=((o==null?void 0:o.orderId)||"").toLowerCase(),c=((o==null?void 0:o.itemCode)||(o==null?void 0:o.productId)||"").toLowerCase(),b=((o==null?void 0:o.item)||"").toLowerCase(),u=((o==null?void 0:o.project)||"").toLowerCase();return y.includes(n)||c.includes(n)||b.includes(n)||u.includes(n)}):t},[t,l]),d=n=>{if(!n.createdAt)return!1;const o=n.createdAt.toMillis?n.createdAt.toMillis():new Date(n.createdAt).getTime(),y=Date.now()-24*60*60*1e3;return o>y};return e.jsxs("div",{className:"flex flex-col h-full bg-white border-r border-slate-200 animate-in fade-in duration-300",children:[e.jsx("div",{className:"p-4 border-b border-slate-100 bg-slate-50/50",children:e.jsxs("div",{className:"relative group",children:[e.jsx(st,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors",size:16}),e.jsx("input",{type:"text",placeholder:"Zoek order of item...",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-xl text-xs font-bold outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all shadow-sm",value:l,onChange:n=>x(n.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center opacity-40",children:[e.jsx(os,{size:32,className:"mb-2 text-slate-300"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"Geen resultaten"})]}):i.map(n=>{const o=s===n.id||s===n.orderId,y=d(n);return e.jsxs("button",{onClick:()=>r(n.id),className:`w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 group relative overflow-hidden
                  ${o?"bg-blue-50 border-blue-500 shadow-md shadow-blue-100":"bg-white border-slate-50 hover:border-slate-200 hover:bg-slate-50"}
                `,children:[y&&e.jsx("div",{className:"absolute top-0 left-0 px-2 py-0.5 bg-emerald-500 text-white text-[7px] font-black uppercase tracking-tighter rounded-br-lg shadow-sm z-10",children:"Nieuw"}),n.isUrgent&&e.jsx("div",{className:"absolute top-0 right-0 w-1.5 h-full bg-red-500 animate-pulse"}),e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`font-black text-sm tracking-tighter truncate ${o?"text-blue-700":"text-slate-900"}`,children:n.orderId||"Geen ID"}),y&&e.jsx(Dt,{size:10,className:"text-emerald-500 animate-bounce"})]}),n.project&&e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-tighter text-slate-400 truncate max-w-[120px]",children:n.project})]}),e.jsx(rt,{status:n.status})]}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 truncate mb-3",children:n.itemCode||n.productId||"Geen artikelcode"}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{size:10,className:"text-slate-300"}),e.jsxs("span",{className:"text-[9px] font-black text-slate-400 uppercase",children:["W",n.weekNumber||n.week||"--"]})]}),e.jsx(Fe,{size:14,className:`transition-transform duration-300 ${o?"text-blue-500 translate-x-1":"text-slate-200 group-hover:text-slate-400"}`})]})]},n.id)})})]})},ha=({isOpen:t,onClose:s,onSuccess:r})=>{const[l,x]=a.useState([]),[i,d]=a.useState(!1),[n,o]=a.useState(!1),[y,c]=a.useState(new Set),[b,u]=a.useState("new_only"),m=a.useRef(null);a.useEffect(()=>{(async()=>{if(t)try{const p=await ze(ce(U,...G.PLANNING)),F=new Set(p.docs.map(O=>O.id));c(F)}catch(p){console.error("Fout bij ophalen bestaande orders:",p)}})()},[t]);const S=C=>{if(!C)return"-";const p=String(C).toUpperCase();return p.startsWith("40")?p.substring(2):p},v=C=>{if(!C)return{delivery:null,planned:null};let p=null;if(C instanceof Date?p=C:(p=new Date(C),at(p)||(p=Hs(C))),!at(p))return{delivery:null,planned:null};const F=Et(p,2);return{delivery:p,planned:F}},N=C=>{if(!C)return"text-slate-900";const F=$t(C,new Date);return F<=7?"text-red-600 font-black":F<=14?"text-blue-600 font-black":"text-slate-900 font-bold"},D=async C=>{const p=C.target.files[0];if(!p)return;d(!0);const F=new FileReader;F.onload=O=>{try{const ae=O.target.result,re=Cs(ae,{type:"binary",cellDates:!0}),I=re.SheetNames[0],J=re.Sheets[I],Y=Is.sheet_to_json(J,{header:1,defval:""}),_=Y.findIndex(Q=>Q.includes("Machine")&&Q.includes("order"));if(_===-1){alert("Header niet gevonden. Zorg dat de kolommen 'Machine' en 'order' aanwezig zijn."),d(!1);return}const X=Y[_],se=Y.slice(_+1).filter(Q=>Q[X.indexOf("order")]&&Q[X.indexOf("Machine")]).map(Q=>{const w=String(Q[X.indexOf("order")]).trim(),h=String(Q[X.indexOf("Manufactured Item")]).trim(),E=`${w}_${h}`.replace(/[^a-zA-Z0-9]/g,"_"),g=Q[X.indexOf("datum")],{delivery:H,planned:k}=v(g);return{id:E,orderId:w,machine:S(Q[X.indexOf("Machine")]),deliveryDate:H,plannedDate:k,weekNumber:parseInt(Q[X.indexOf("Week")])||null,itemCode:h,item:Q[X.indexOf("Item Desc")]||"-",extraCode:Q[X.indexOf("code")]||"-",plan:parseInt(Q[X.indexOf("Plan")])||1,status:"pending",isExisting:y.has(E)}});x(se)}catch{alert("Fout bij het verwerken van het bestand.")}finally{d(!1)}},F.readAsBinaryString(p)},Z=async()=>{if(l.length===0||n)return;o(!0);const C=b==="new_only"?l.filter(O=>!O.isExisting):l;if(C.length===0){alert("Geen nieuwe orders om te importeren."),o(!1);return}const p=400;let F=0;try{for(let O=0;O<C.length;O+=p){const ae=hs(U),re=C.slice(O,O+p);re.forEach(I=>{const{isExisting:J,...Y}=I,_=ne(U,...G.PLANNING,I.id);ae.set(_,{...Y,lastUpdated:de(),importDate:de()},{merge:!0})}),await ae.commit(),F+=re.length}alert(`Import voltooid! ${F} regels verwerkt.`),r&&r(),s()}catch{alert("Fout tijdens opslaan.")}finally{o(!1)}};if(!t)return null;const M=l.filter(C=>!C.isExisting).length,W=l.filter(C=>C.isExisting).length;return e.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-6xl max-h-[90vh] rounded-[40px] shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-600 text-white rounded-2xl shadow-lg shadow-blue-200",children:e.jsx(Ht,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-slate-900 uppercase italic tracking-tight",children:"Planning Import"}),e.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mt-1 italic",children:["Urgentie:"," ",e.jsx("span",{className:"text-slate-900 font-black",children:"Zwart > 2w"})," ","| ",e.jsx("span",{className:"text-blue-600 font-black",children:"Blauw 2w"})," |"," ",e.jsx("span",{className:"text-red-600 font-black",children:"Rood 1w"})]})]})]}),e.jsx("button",{onClick:s,className:"p-3 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:e.jsx(Ne,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar",children:l.length===0?e.jsxs("div",{onClick:()=>{var C;return(C=m.current)==null?void 0:C.click()},className:"border-4 border-dashed border-slate-100 rounded-[40px] p-16 text-center hover:border-blue-400 hover:bg-blue-50/30 transition-all cursor-pointer group",children:[e.jsx("input",{type:"file",ref:m,onChange:D,className:"hidden",accept:".csv, .xlsx, .xls"}),i?e.jsx(fe,{size:64,className:"mx-auto text-blue-500 animate-spin mb-6"}):e.jsx(Ds,{size:64,className:"mx-auto text-slate-200 group-hover:text-blue-400 transition-colors mb-6"}),e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase italic",children:"Selecteer Planning Bestand"}),e.jsx("p",{className:"text-slate-400 font-medium mt-2",children:"Berekening startdatum en urgentie vindt automatisch plaats"})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-emerald-50 p-6 rounded-3xl border border-emerald-100 text-center",children:[e.jsx("span",{className:"text-[10px] font-black text-emerald-400 uppercase tracking-widest block mb-1",children:"Nieuwe Orders"}),e.jsx("span",{className:"text-3xl font-black text-emerald-600 italic",children:M})]}),e.jsxs("div",{className:"bg-blue-50 p-6 rounded-3xl border border-blue-100 text-center",children:[e.jsx("span",{className:"text-[10px] font-black text-blue-400 uppercase tracking-widest block mb-1",children:"Reeds in Systeem"}),e.jsx("span",{className:"text-3xl font-black text-blue-600 italic",children:W})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-3xl text-white",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-3 italic",children:"Import Strategie"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>u("new_only"),className:`w-full py-2 px-4 rounded-xl text-[10px] font-black uppercase flex items-center justify-between border ${b==="new_only"?"bg-emerald-600 border-emerald-500 text-white":"bg-white/5 border-white/10 text-slate-400"}`,children:["Alleen Nieuwe ",e.jsx(Ft,{size:14})]}),e.jsxs("button",{onClick:()=>u("overwrite"),className:`w-full py-2 px-4 rounded-xl text-[10px] font-black uppercase flex items-center justify-between border ${b==="overwrite"?"bg-orange-600 border-orange-500 text-white":"bg-white/5 border-white/10 text-slate-400"}`,children:["Overschrijf alles ",e.jsx(Pt,{size:14})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[30px] overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"bg-slate-100 px-6 py-3 border-b border-slate-200 flex justify-between items-center font-black uppercase text-[10px] text-slate-500 tracking-widest",children:[e.jsx("span",{children:"Preview & Urgentie Controle"}),e.jsx(As,{size:16,className:"opacity-30"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white text-slate-400 font-black uppercase tracking-widest border-b border-slate-100",children:[e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4",children:"Order"}),e.jsx("th",{className:"px-6 py-4",children:"Leverdatum (E)"}),e.jsx("th",{className:"px-6 py-4",children:"Productie Start (-2w)"}),e.jsx("th",{className:"px-6 py-4",children:"Machine"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:l.slice(0,15).map((C,p)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`${C.isExisting?"bg-blue-100 text-blue-700":"bg-emerald-100 text-emerald-700"} px-2 py-0.5 rounded-lg text-[9px] font-black uppercase`,children:C.isExisting?"Bestaand":"Nieuw"})}),e.jsx("td",{className:"px-6 py-4 font-black text-slate-900",children:C.orderId}),e.jsx("td",{className:"px-6 py-4 text-slate-400",children:C.deliveryDate?Oe(C.deliveryDate,"dd-MM-yyyy"):"-"}),e.jsx("td",{className:`px-6 py-4 ${N(C.deliveryDate)}`,children:C.plannedDate?Oe(C.plannedDate,"dd-MM-yyyy"):"-"}),e.jsx("td",{className:"px-6 py-4 text-slate-500 font-bold uppercase",children:C.machine})]},p))})]})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-100 p-5 rounded-3xl flex items-start gap-4 shadow-sm",children:[e.jsx(cs,{className:"text-blue-500 shrink-0 mt-1",size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-black text-blue-900 uppercase",children:"Kleurcodering Productie Start"}),e.jsxs("p",{className:"text-xs text-blue-800 font-medium leading-relaxed mt-1 italic",children:["Het systeem bepaalt de kleur van de startdatum op basis van de resterende tijd tot levering:",e.jsx("br",{}),"•"," ",e.jsx("span",{className:"text-slate-900 font-bold",children:"Zwart:"})," ","Productie start ligt nog in de toekomst.",e.jsx("br",{}),"•"," ",e.jsx("span",{className:"text-blue-600 font-bold",children:"Blauw:"})," ","Vandaag is de uiterste startdatum (2 weken zone).",e.jsx("br",{}),"•"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"Rood:"})," De order is urgent of de startdatum is al verstreken (1 week zone)."]})]})]})]})}),e.jsxs("div",{className:"p-8 bg-slate-50 border-t border-slate-100 flex justify-between items-center shrink-0",children:[e.jsx("button",{onClick:()=>x([]),disabled:l.length===0||n,className:"text-slate-400 hover:text-slate-600 font-black text-[10px] uppercase tracking-widest disabled:opacity-0 transition-all",children:"Bestand Wissen"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:s,className:"px-8 py-4 bg-white border-2 border-slate-200 text-slate-400 rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-slate-100",children:"Annuleren"}),e.jsxs("button",{onClick:Z,disabled:l.length===0||n,className:"px-10 py-4 bg-blue-600 text-white rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl shadow-blue-200 hover:bg-blue-700 transition-all flex items-center gap-3 disabled:opacity-50",children:[n?e.jsx(fe,{className:"animate-spin",size:20}):e.jsx(Ae,{size:20}),n?"Importeren...":`Importeer ${b==="new_only"?M:l.length} Regels`]})]})]})]})})},Yt=({onBack:t,onExit:s,fixedScope:r="all",departmentName:l="Algemeen",allowedMachines:x=[]})=>{const[i,d]=a.useState("dashboard"),[n,o]=a.useState([]),[y,c]=a.useState([]),[b,u]=a.useState([]),[m,S]=a.useState(null),[v,N]=a.useState(!0),[D,Z]=a.useState(null),[M,W]=a.useState(null),[C,p]=a.useState(!1),[F,O]=a.useState(""),[ae,re]=a.useState([]),[I,J]=a.useState(!1),[Y,_]=a.useState(null),[X,oe]=a.useState(!1);a.useEffect(()=>{const h=pe(ce(U,...G.PLANNING),k=>{o(k.docs.map(B=>({id:B.id,...B.data()}))),N(!1)},k=>{console.error("Planning Sync Error:",k),Z(k.code),N(!1)}),E=pe(ce(U,...G.TRACKING),k=>c(k.docs.map(B=>({id:B.id,...B.data()}))),k=>console.warn("Tracked Products Sync Error:",k.code)),g=pe(ce(U,...G.OCCUPANCY),k=>u(k.docs.map(B=>({id:B.id,...B.data()}))),k=>console.warn("Occupancy Sync Error:",k.code)),H=pe(ne(U,...G.FACTORY_CONFIG),k=>{k.exists()&&S(k.data())},k=>console.warn("Factory Config Sync Error:",k));return()=>{h(),E(),g(),H()}},[]);const se=a.useMemo(()=>(x||[]).map(h=>ie(h)),[x]);a.useEffect(()=>{console.log("[TeamleaderHub] fixedScope:",r),console.log("[TeamleaderHub] allowedMachines:",x),console.log("[TeamleaderHub] allowedNorms:",se)},[r,x,se]),a.useEffect(()=>{console.log("[TeamleaderHub] selectedStationDetail changed:",Y)},[Y]);const Q=a.useMemo(()=>n?n.map(h=>({...h,normMachine:ie(h.machine||"")})).filter(h=>se.includes(h.normMachine)||se.length===0):[],[n,se]),w=a.useMemo(()=>{var H;if(v)return{totalPlanned:0,activeCount:0,finishedCount:0,rejectedCount:0,bezettingAantal:0,machineGridData:[]};nt(new Date);const h=new Set(Q.map(k=>k.orderId));let E=[];if(m&&m.departments){const B={fittings:"fittings",pipes:"pipes",spools:"spools"}[r.toLowerCase()]||r.toLowerCase();console.log("[TeamleaderHub metrics] fixedScope:",r,"targetSlug:",B),console.log("[TeamleaderHub metrics] departments:",m.departments.map(K=>({id:K.id,slug:K.slug,name:K.name})));const R=m.departments.find(K=>{var $;return K.slug===B||K.id===B||(($=K.name)==null?void 0:$.toLowerCase())===B});console.log("[TeamleaderHub metrics] found dept:",R==null?void 0:R.name,"stations count:",(H=R==null?void 0:R.stations)==null?void 0:H.length),E=R?(R.stations||[]).filter(K=>{var $;return(($=K.name)==null?void 0:$.toLowerCase())!=="teamleader"}):[]}const g=E.map(k=>{const B=k.name,R=y.filter($=>($.machine||"").toLowerCase()===B.toLowerCase()),K=b.filter($=>($.machineId||"").toLowerCase()===B.toLowerCase());return{id:B,planned:Q.filter($=>($.machine||"").toLowerCase()===B.toLowerCase()).reduce(($,L)=>$+Number(L.plan||0),0),finished:R.filter($=>$.status==="Finished").length,active:R.filter($=>$.status==="In Production").length,operatorCount:K.length,operatorNames:K.map($=>$.operatorName).join(", ")}});return{totalPlanned:Q.filter(k=>!["cancelled","rejected","REJECTED"].includes(k.status)).reduce((k,B)=>k+Number(B.plan||0),0),activeCount:y.filter(k=>k.status==="In Production"&&h.has(k.orderId)).length,finishedCount:y.filter(k=>k.status==="Finished"&&h.has(k.orderId)).length,rejectedCount:y.filter(k=>k.status==="Rejected"&&h.has(k.orderId)).length,bezettingAantal:b.filter(k=>E.some(B=>(B.name||"").toLowerCase()===(k.machineId||"").toLowerCase())).length,machineGridData:g}},[v,Q,y,b,m,r]);return v?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center bg-slate-50 gap-4",children:[e.jsx(fe,{className:"animate-spin text-blue-600",size:48}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 italic",children:"Productiedata synchroniseren..."})]}):D?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-10 text-center",children:[e.jsx(Ee,{size:48,className:"text-rose-500 mb-4"}),e.jsx("h3",{className:"text-xl font-black uppercase italic",children:"Database Verbindingsfout"}),e.jsxs("p",{className:"text-slate-500 text-sm mt-2 max-w-xs",children:["De app kon geen verbinding maken met Firestore (Fout: ",D,")."]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-8 px-8 py-3 bg-slate-900 text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl",children:"Opnieuw Proberen"})]}):e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 text-left w-full animate-in fade-in duration-300 overflow-hidden relative",children:[e.jsxs("div",{className:"p-4 bg-white border-b border-slate-200 flex justify-between items-center shrink-0 z-40 shadow-sm px-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{onClick:t||s,className:"p-3 bg-slate-100 hover:bg-slate-200 text-slate-500 rounded-2xl transition-all active:scale-90",children:e.jsx(Me,{size:24})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase italic tracking-tighter leading-none",children:"Teamleader Hub"}),e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1.5",children:[l," Dashboard"]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:()=>J(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-xl shadow-lg font-black text-[10px] uppercase tracking-wider flex items-center gap-2 active:scale-95 transition-all",children:[e.jsx(Ht,{size:16})," Import"]})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden p-6 w-full flex flex-col text-left",children:[e.jsxs("div",{className:"flex bg-slate-200/50 p-1 rounded-2xl mb-6 w-fit shrink-0",children:[e.jsx("button",{onClick:()=>d("dashboard"),className:`px-6 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${i==="dashboard"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Dashboard"}),e.jsx("button",{onClick:()=>d("bezetting"),className:`px-6 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${i==="bezetting"?"bg-white text-emerald-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Personeel"}),e.jsx("button",{onClick:()=>d("planning"),className:`px-6 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${i==="planning"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Volledige Lijst"})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative",children:i==="dashboard"?e.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar space-y-8 pr-2 pb-20",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:[{id:"gepland",label:"Totaal Plan",val:w.totalPlanned,icon:lt,color:"text-slate-400"},{id:"in_proces",label:"Lopend",val:w.activeCount,icon:ke,color:"text-blue-500"},{id:"gereed",label:"Gereed",val:w.finishedCount,icon:Ae,color:"text-emerald-500"},{id:"afkeur",label:"Afkeur",val:w.rejectedCount,icon:Ve,color:"text-rose-500"},{id:"bezetting",label:"Bezetting",val:w.bezettingAantal,icon:dt,color:"text-indigo-500"}].map(h=>e.jsxs("div",{className:"bg-white p-6 rounded-[35px] border-2 border-slate-100 shadow-sm text-left group hover:border-blue-200 transition-all",children:[e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(h.icon,{size:14,className:h.color})," ",h.label]}),e.jsx("p",{className:"text-3xl font-black text-slate-800 italic",children:h.val})]},h.id))}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-black text-slate-800 uppercase italic tracking-widest ml-1",children:"Live Station Monitor"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:w.machineGridData.map(h=>e.jsxs("div",{onClick:()=>{console.log("[TeamleaderHub] Station clicked:",h.id),_(h.id)},className:"bg-white border border-slate-200 rounded-[35px] p-6 shadow-sm hover:shadow-xl hover:border-blue-400 transition-all cursor-pointer group relative overflow-hidden text-left",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity",children:e.jsx(Ze,{size:80})}),e.jsxs("div",{className:"text-left mb-4",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1",children:"Station"}),e.jsx("h4",{className:"text-xl font-black text-slate-900 tracking-tighter uppercase italic",children:h.id})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-4 border-t border-slate-50",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase block mb-0.5",children:"Plan"}),e.jsx("span",{className:"text-sm font-black text-slate-700 italic",children:h.planned})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[8px] font-black text-blue-400 uppercase block mb-0.5",children:"Actief"}),e.jsx("span",{className:"text-sm font-black text-blue-600 italic",children:h.active})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[8px] font-black text-emerald-400 uppercase block mb-0.5",children:"Klaar"}),e.jsx("span",{className:"text-sm font-black text-emerald-600 italic",children:h.finished})]})]})]},h.id))})]})]}):i==="bezetting"?e.jsx("div",{className:"h-full overflow-y-auto custom-scrollbar pb-20",children:e.jsx(ma,{scope:r,machines:x})}):e.jsxs("div",{className:"h-full flex gap-6 overflow-hidden",children:[e.jsx("div",{className:"w-80 shrink-0 flex flex-col min-h-0",children:e.jsx(fa,{orders:Q,selectedOrderId:M,onSelect:W})}),e.jsxs("div",{className:"flex-1 bg-white rounded-[40px] border border-slate-200 shadow-sm flex flex-col justify-center items-center opacity-40 italic text-center",children:[e.jsx(Ts,{size:64,className:"mb-4 text-slate-300"}),e.jsx("p",{className:"font-black uppercase tracking-widest text-xs text-slate-400",children:"Selecteer een order uit de lijst"})]})]})})]}),I&&e.jsx(ha,{isOpen:!0,onClose:()=>J(!1)}),Y&&e.jsx(pa,{stationId:Y,allOrders:Q,allProducts:y,onClose:()=>_(null)})]})},ba=({department:t,onBack:s,searchOrder:r})=>{const[l,x]=a.useState(null),[i,d]=a.useState(!1),[n,o]=a.useState(null),[y,c]=a.useState(!0);a.useEffect(()=>{const u=ne(U,...G.FACTORY_CONFIG),m=pe(u,S=>{S.exists()&&o(S.data()),c(!1)},S=>{console.error("Factory config error:",S),c(!1)});return()=>m()},[]);const b=a.useMemo(()=>{if(!n||!t)return[];const m={FITTINGS:"fittings",PIPES:"pipes",SPOOLS:"spools"}[t]||t.toLowerCase(),S=(n.departments||[]).find(v=>{var N;return v.slug===m||v.id===m||((N=v.name)==null?void 0:N.toLowerCase())===m});return S?(S.stations||[]).map(v=>({id:v.id||v.name,name:v.name})):[]},[n,t]);return i?e.jsx(Yt,{onBack:()=>d(!1),fixedScope:t.toLowerCase(),departmentName:t}):l?e.jsx(xa,{initialStationId:l,onExit:()=>x(null),searchOrder:r}):y?e.jsx("div",{className:"h-full w-full bg-white flex items-center justify-center",children:e.jsx(fe,{className:"animate-spin text-blue-600",size:48})}):e.jsx("div",{className:"h-full w-full bg-white flex flex-col p-8 overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full flex-1 flex flex-col py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-2 text-slate-400 hover:text-slate-600 font-black uppercase text-[10px] tracking-[0.2em] transition-all bg-slate-50 px-6 py-3 rounded-xl border border-slate-200 mb-6",children:[e.jsx(Me,{size:14})," Terug naar Productie Hub"]}),e.jsxs("h1",{className:"text-4xl md:text-5xl font-black text-slate-900 mb-3 uppercase italic tracking-tighter leading-none",children:[t," ",e.jsx("span",{className:"text-blue-600",children:"Stations"})]}),e.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-widest text-[10px]",children:"Selecteer een werkstation of management optie"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:b.map(u=>{var m,S,v,N,D,Z,M,W,C,p,F,O;return e.jsxs("button",{onClick:()=>{var ae,re;((ae=u.name)==null?void 0:ae.toLowerCase())==="teamleader"||((re=u.id)==null?void 0:re.toLowerCase())==="teamleader"?d(!0):x(u.name)},className:`group relative p-6 rounded-2xl border-2 border-slate-200 bg-white hover:border-blue-500 hover:shadow-xl text-center transition-all duration-200 ${((m=u.name)==null?void 0:m.toLowerCase())==="teamleader"||((S=u.id)==null?void 0:S.toLowerCase())==="teamleader"?"col-span-2 row-span-2":""}`,children:[e.jsx("div",{className:`${((v=u.name)==null?void 0:v.toLowerCase())==="teamleader"||((N=u.id)==null?void 0:N.toLowerCase())==="teamleader"?"w-20 h-20":"w-12 h-12"} rounded-xl flex items-center justify-center text-white mb-3 shadow-md mx-auto transition-transform group-hover:scale-110 ${((D=u.name)==null?void 0:D.toLowerCase())==="teamleader"||((Z=u.id)==null?void 0:Z.toLowerCase())==="teamleader","bg-blue-600"}`,children:((M=u.name)==null?void 0:M.toLowerCase())==="teamleader"||((W=u.id)==null?void 0:W.toLowerCase())==="teamleader"?e.jsx(dt,{size:40}):e.jsx(Ze,{size:24})}),e.jsx("h3",{className:`${((C=u.name)==null?void 0:C.toLowerCase())==="teamleader"||((p=u.id)==null?void 0:p.toLowerCase())==="teamleader"?"text-lg":"text-sm"} font-black text-slate-800 uppercase tracking-tight group-hover:text-blue-600 transition-colors`,children:((F=u.name)==null?void 0:F.toLowerCase())==="teamleader"||((O=u.id)==null?void 0:O.toLowerCase())==="teamleader"?e.jsxs(e.Fragment,{children:["Teamleader ",e.jsx("br",{})," Hub"]}):u.name})]},u.id)})})]})})},ga=({onExit:t,onEnterWorkstation:s})=>e.jsx(Yt,{fixedScope:null,onExit:t,onEnterWorkstation:s}),er=()=>{var b,u;const t=At(),s=xs(),[r,l]=a.useState(null),[x,i]=a.useState(!1),[d,n]=a.useState(""),[o,y]=a.useState(null);a.useEffect(()=>{var m,S;try{console.log("[DigitalPlanningHub] Location:",s.pathname),console.log("[DigitalPlanningHub] State:",s.state),(m=s.state)!=null&&m.searchOrder&&(console.log("[DigitalPlanningHub] Search order:",s.state.searchOrder),y(s.state.searchOrder)),(S=s.state)!=null&&S.initialView&&(console.log("[DigitalPlanningHub] Setting activeDept:",s.state.initialView),l(s.state.initialView))}catch(v){console.error("Fout bij initialiseren planning view:",v),n(v.message),i(!0)}},[(b=s.state)==null?void 0:b.initialView,(u=s.state)==null?void 0:u.searchOrder]);const c=[{id:"FITTINGS",title:"Fitting Productions",icon:e.jsx(ds,{size:40}),description:"Hulpstukken & Voorbewerking",color:"bg-emerald-600"},{id:"PIPES",title:"Pipe Productions",icon:e.jsx(Ze,{size:40}),description:"Leidingwerk & Lamineren",color:"bg-orange-600"},{id:"SPOOLS",title:"Spools Productions",icon:e.jsx(Ke,{size:40}),description:"Assemblage & Prefab",color:"bg-purple-600"},{id:"PLANNER",title:"Central Planner",icon:e.jsx(Ge,{size:40}),description:"Werkvoorbereiding & Planning",color:"bg-slate-600"}];return x?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-10 bg-slate-50",children:[e.jsx(Ee,{size:48,className:"text-rose-500 mb-4"}),e.jsx("h2",{className:"text-xl font-black uppercase",children:"Systeemfout in Planning"}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:"De module kon niet correct worden geladen."}),d&&e.jsx("p",{className:"text-rose-600 text-xs mt-2 font-mono bg-rose-50 p-3 rounded",children:d}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-xl font-bold uppercase text-xs",children:"Herstellen"})]}):r==="PLANNER"?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(fe,{className:"animate-spin text-blue-500"})}),children:e.jsx(ga,{onBack:()=>l(null)})}):r?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(fe,{className:"animate-spin text-blue-500"})}),children:e.jsx(ba,{department:r,onBack:()=>l(null),searchOrder:o},r)}):e.jsx("div",{className:"h-full w-full bg-white flex flex-col p-8 overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full flex-1 flex flex-col justify-center py-10",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("h1",{className:"text-5xl md:text-6xl font-black text-slate-900 mb-3 uppercase italic tracking-tighter leading-none",children:["Productie ",e.jsx("span",{className:"text-blue-600",children:"Hub"})]}),e.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-widest text-[10px]",children:"Industrial Operations Center"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto w-full",children:c.map(m=>e.jsxs("button",{onClick:()=>l(m.id),className:"group relative p-10 rounded-3xl border-2 border-slate-200 bg-white hover:border-blue-500 hover:shadow-2xl text-center transition-all duration-300",children:[e.jsx("div",{className:`w-20 h-20 rounded-2xl flex items-center justify-center text-white mb-6 shadow-lg mx-auto transition-transform group-hover:scale-110 ${m.color}`,children:m.icon}),e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight mb-2 group-hover:text-blue-600 transition-colors italic",children:m.title}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide leading-relaxed",children:m.description})]},m.id))}),e.jsx("div",{className:"mt-16 flex justify-center",children:e.jsxs("button",{onClick:()=>t("/portal"),className:"flex items-center gap-2 text-slate-400 hover:text-slate-600 font-black uppercase text-[10px] tracking-[0.2em] transition-all bg-slate-50 px-6 py-3 rounded-xl border border-slate-200",children:[e.jsx(Me,{size:14})," Terug naar Portal"]})})]})})};export{er as default};
