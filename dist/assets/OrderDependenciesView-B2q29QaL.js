import{c as F,d as w,e as y,j as e,f as k}from"./index-DNbqce-j.js";import{r as o,h as R}from"./react-vendor-CkwvfVK2.js";import{o as I,j as q,y as z,E as U,l as D,L as V}from"./firebase-DdpHYWNd.js";import{G as E}from"./users-BzjIxhpA.js";import{P as $}from"./plus-fTGSighL.js";import{C as A}from"./clock-yngyoSLs.js";import{T as J}from"./trash-2-CmT6fCSF.js";import{A as L}from"./alert-triangle-BUFzzSRW.js";import{T as K}from"./AdminDashboard-BkhDkzix.js";import"./arrow-left-CeHKlJCF.js";import"./book-open-Dw5UZXUq.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=F("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),le=()=>{const[n,P]=o.useState([]),[a,O]=o.useState(null),[S,v]=o.useState(!1),[b,g]=o.useState(""),[T,G]=o.useState(!0);o.useEffect(()=>{const s=I(q(y,...w.PLANNING),r=>{const l=r.docs.map(d=>({id:d.id,...d.data()}));P(l),G(!1)});return()=>s()},[]);const u=s=>(s.dependencies||[]).map(r=>n.find(l=>l.id===r)).filter(Boolean),j=s=>n.filter(r=>(r.dependencies||[]).includes(s)),p=o.useMemo(()=>{if(n.length===0)return[];const s={};n.forEach(t=>{s[t.id]={order:t,dependencies:t.dependencies||[],duration:t.estimatedHours||8,earliestStart:0,latestStart:0}});const r=(t,c=new Set)=>{if(c.has(t))return s[t].earliestStart;c.add(t);const i=s[t];if(!i)return 0;let m=0;return i.dependencies.forEach(h=>{var f;const N=r(h,c)+((f=s[h])==null?void 0:f.duration)||0;m=Math.max(m,N)}),i.earliestStart=m,i.earliestStart};n.forEach(t=>r(t.id));const l=Math.max(...Object.values(s).map(t=>t.earliestStart+t.duration)),d=(t,c=new Set)=>{if(c.has(t))return s[t].latestStart;c.add(t);const i=s[t];if(!i)return 0;const m=j(t);if(m.length===0)i.latestStart=l-i.duration;else{let h=1/0;m.forEach(N=>{d(N.id,c);const f=s[N.id];h=Math.min(h,f.latestStart)}),i.latestStart=h-i.duration}return i.latestStart};return n.forEach(t=>d(t.id)),n.filter(t=>{const c=s[t.id],i=c.latestStart-c.earliestStart;return Math.abs(i)<.01})},[n]),M=async()=>{if(!(!a||!b)){if(C(a.id,b)){alert("⚠️ Dit zou een circulaire dependency creëren!");return}await z(D(y,...w.PLANNING,a.id),{dependencies:U(b)}),g(""),v(!1)}},B=async(s,r)=>{await z(D(y,...w.PLANNING,s),{dependencies:V(r)})},C=(s,r,l=new Set)=>{if(s===r)return!0;if(l.has(r))return!1;l.add(r);const d=n.find(x=>x.id===r);return!d||!d.dependencies?!1:d.dependencies.some(x=>C(s,x,l))},H=s=>{const l=u(s).every(d=>d.status==="shipped");return s.status==="shipped"?e.jsx(k,{className:"text-emerald-600",size:20}):l?e.jsx(K,{className:"text-blue-600",size:20}):e.jsx(A,{className:"text-amber-600",size:20})};return T?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border-2 border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-800",children:["Order ",e.jsx("span",{className:"text-purple-600",children:"Dependencies"})]}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Beheer afhankelijkheden en critical path tussen orders"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"px-4 py-2 bg-red-50 border-2 border-red-200 rounded-xl",children:[e.jsx("div",{className:"text-xs text-red-600 font-bold uppercase tracking-wider",children:"Critical Path"}),e.jsx("div",{className:"text-2xl font-black text-red-600",children:p.length}),e.jsx("div",{className:"text-xs text-red-500 mt-1",children:"orders"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200",children:[e.jsx("div",{className:"p-4 border-b-2 border-slate-200 bg-slate-50",children:e.jsx("h3",{className:"text-sm font-bold text-slate-800",children:"Orders"})}),e.jsx("div",{className:"p-4 max-h-[700px] overflow-y-auto space-y-2",children:n.map(s=>{const r=u(s),l=j(s.id),d=p.some(t=>t.id===s.id),x=(a==null?void 0:a.id)===s.id;return e.jsxs("div",{onClick:()=>O(s),className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${x?"border-purple-500 bg-purple-50":d?"border-red-300 bg-red-50 hover:border-red-400":"border-slate-200 bg-white hover:border-slate-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[H(s),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-slate-800",children:s.orderId||s.item}),e.jsx("div",{className:"text-xs text-slate-500",children:s.itemCode||s.extraCode})]})]}),d&&e.jsx("span",{className:"px-2 py-1 bg-red-500 text-white text-xs font-bold rounded",children:"CRITICAL"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[e.jsx(Q,{size:12}),e.jsxs("span",{children:[r.length," deps"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(E,{size:12}),e.jsxs("span",{children:[l.length," blocked"]})]}),e.jsxs("div",{className:"text-slate-500",children:[s.estimatedHours||8,"h"]})]})]},s.id)})})]}),e.jsx("div",{className:"space-y-6",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:a.orderId||a.item}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase",children:"Item"}),e.jsx("div",{className:"font-bold text-slate-800",children:a.itemCode||a.extraCode})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase",children:"Status"}),e.jsx("div",{className:"font-bold text-slate-800",children:a.status||"planned"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase",children:"Machine"}),e.jsx("div",{className:"font-bold text-slate-800",children:a.machine||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase",children:"Geschatte uren"}),e.jsxs("div",{className:"font-bold text-slate-800",children:[a.estimatedHours||8,"h"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200",children:[e.jsxs("div",{className:"p-4 border-b-2 border-slate-200 bg-slate-50 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-800",children:"Dependencies (moet wachten op)"}),e.jsx("button",{onClick:()=>v(!S),className:"p-1 hover:bg-slate-200 rounded-lg transition-colors",children:e.jsx($,{size:16})})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[S&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("select",{value:b,onChange:s=>g(s.target.value),className:"w-full px-3 py-2 border-2 border-slate-200 rounded-lg mb-2 text-sm",children:[e.jsx("option",{value:"",children:"Selecteer order..."}),n.filter(s=>s.id!==a.id&&!(a.dependencies||[]).includes(s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.orderId||s.item," - ",s.itemCode]},s.id))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:M,className:"px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-bold transition-colors",children:"Toevoegen"}),e.jsx("button",{onClick:()=>{v(!1),g("")},className:"px-3 py-1.5 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-xs font-bold transition-colors",children:"Annuleren"})]})]}),u(a).length===0?e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"Geen dependencies - kan direct starten"}):u(a).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-50 border-2 border-amber-200 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="shipped"?e.jsx(k,{className:"text-emerald-600",size:16}):e.jsx(A,{className:"text-amber-600",size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-slate-800",children:s.orderId||s.item}),e.jsx("div",{className:"text-xs text-slate-500",children:s.itemCode})]})]}),e.jsx("button",{onClick:()=>B(a.id,s.id),className:"p-1 hover:bg-red-100 rounded-lg transition-colors",children:e.jsx(J,{className:"text-red-600",size:14})})]},s.id))]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200",children:[e.jsx("div",{className:"p-4 border-b-2 border-slate-200 bg-slate-50",children:e.jsx("h3",{className:"text-sm font-bold text-slate-800",children:"Blocked Orders (wachten op deze order)"})}),e.jsx("div",{className:"p-4 space-y-2",children:j(a.id).length===0?e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"Geen blocked orders"}):j(a.id).map(s=>e.jsx("div",{className:"p-3 bg-blue-50 border-2 border-blue-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"text-blue-600",size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-slate-800",children:s.orderId||s.item}),e.jsx("div",{className:"text-xs text-slate-500",children:s.itemCode})]})]})},s.id))})]})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border-2 border-slate-200 p-12 text-center",children:[e.jsx(E,{className:"mx-auto mb-4 text-slate-300",size:48}),e.jsx("div",{className:"text-slate-400",children:"Selecteer een order om dependencies te bekijken"})]})})]}),p.length>0&&e.jsxs("div",{className:"mt-6 bg-white rounded-2xl shadow-sm border-2 border-red-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-red-600 mb-4 flex items-center gap-2",children:[e.jsx(L,{size:20}),"Critical Path Analysis"]}),e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-4",children:p.map((s,r)=>e.jsxs(R.Fragment,{children:[e.jsxs("div",{className:"flex-shrink-0 p-3 bg-red-50 border-2 border-red-300 rounded-xl min-w-[150px]",children:[e.jsx("div",{className:"font-bold text-sm text-slate-800",children:s.orderId||s.item}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[s.estimatedHours||8,"h"]})]}),r<p.length-1&&e.jsx("div",{className:"text-red-400 font-bold",children:"→"})]},s.id))}),e.jsx("div",{className:"mt-4 p-3 bg-red-50 rounded-xl border border-red-200",children:e.jsxs("div",{className:"text-xs text-red-800",children:[e.jsx("strong",{children:"Let op:"})," Deze orders vormen het critical path. Vertragingen in deze orders vertragen het hele project. Prioriteer deze voor on-time delivery."]})})]})]})};export{le as default};
