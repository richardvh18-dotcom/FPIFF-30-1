import{i as L,e as S,d as j,j as e,S as R,a7 as I,E as _,s as O,O as z,g as v,L as M,D as U}from"./index-DNbqce-j.js";import{r as i}from"./react-vendor-CkwvfVK2.js";import{j as P,q as N,x as y,z as w,w as G,o as H}from"./firebase-DdpHYWNd.js";import{H as V}from"./users-BzjIxhpA.js";import{R as q}from"./refresh-cw-BMZ4Lrni.js";import{f as x}from"./index-CFK5EZMp.js";import{l as F}from"./index-DiNM8yMF.js";import"./index-jHXuI3CI.js";const se=()=>{const[b,k]=i.useState([]),[h,o]=i.useState(!0),[m,A]=i.useState("ALL"),[p,Y]=i.useState(""),[u,C]=i.useState(50),[$,Q]=i.useState(!1),[f,c]=i.useState(null),T=["PRODUCT_CREATE","PRODUCT_UPDATE","PRODUCT_DELETE","MATRIX_UPDATE","SETTINGS_UPDATE","MASTER_SYNC","LOGIN","DRILL_ADD","TOOL_ADD","TOOL_UPDATE"];i.useEffect(()=>{if(!L("ACTIVITY_LOGS")){c("Systeempad voor logging is niet geconfigureerd."),o(!1);return}o(!0),c(null);try{const t=P(S,...j.ACTIVITY_LOGS);let r=N(t,y("timestamp","desc"),w(u));m!=="ALL"&&(r=N(t,G("action","==",m),y("timestamp","desc"),w(u)));const l=H(r,s=>{const a=s.docs.map(n=>{var g;return{id:n.id,...n.data(),timestamp:((g=n.data().timestamp)==null?void 0:g.toDate())||new Date}});k(a),o(!1)},s=>{console.error("Audit Sync Error:",s),s.code==="failed-precondition"?c("Filter-index ontbreekt. Gebruik 'Alle Activiteiten' of maak de index aan in Firebase."):c(`Database fout: ${s.code}`),o(!1)});return()=>l()}catch(t){console.error("Critical Render Error:",t),c("Interne render fout. Controleer de console."),o(!1)}},[m,u]);const d=b.filter(t=>{var l,s,a;if(!p)return!0;const r=p.toLowerCase();return((l=t.userEmail)==null?void 0:l.toLowerCase().includes(r))||((s=t.details)==null?void 0:s.toLowerCase().includes(r))||((a=t.action)==null?void 0:a.toLowerCase().includes(r))}),D=()=>{if(d.length===0)return;const t=["Datum","Tijd","Actie","Gebruiker","Details"],r=d.map(a=>{var n;return[x(a.timestamp,"dd-MM-yyyy"),x(a.timestamp,"HH:mm:ss"),a.action,a.userEmail||"Systeem",`"${(n=a.details)==null?void 0:n.replace(/"/g,'""')}"`]}),l="data:text/csv;charset=utf-8,"+[t.join(","),...r.map(a=>a.join(","))].join(`
`),s=document.createElement("a");s.setAttribute("href",encodeURI(l)),s.setAttribute("download",`audit_log_${x(new Date,"yyyyMMdd")}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s)},E=t=>t.includes("DELETE")?"bg-rose-50 text-rose-600 border-rose-100":t.includes("CREATE")||t.includes("ADD")?"bg-emerald-50 text-emerald-600 border-emerald-100":t.includes("UPDATE")?"bg-blue-50 text-blue-600 border-blue-100":"bg-slate-50 text-slate-500 border-slate-100";return e.jsxs("div",{className:"flex-1 h-full flex flex-col bg-slate-50 animate-in fade-in duration-500 text-left overflow-hidden",children:[e.jsxs("div",{className:"bg-white border-b border-slate-200 p-8 flex flex-col md:flex-row justify-between items-center shrink-0 shadow-sm gap-6",children:[e.jsxs("div",{className:"flex items-center gap-6 text-left",children:[e.jsx("div",{className:"p-4 bg-slate-900 text-white rounded-[20px] shadow-lg",children:e.jsx(V,{size:28})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("h2",{className:"text-3xl font-black text-slate-900 uppercase italic tracking-tighter leading-none",children:["Activity ",e.jsx("span",{className:"text-blue-600",children:"Audit"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("span",{className:"text-[10px] font-black bg-blue-50 text-blue-600 px-3 py-1 rounded-lg border border-blue-100 italic uppercase",children:[b.length," Records In-Memory"]}),e.jsxs("span",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-1",children:[e.jsx(R,{size:12,className:"text-emerald-500"})," Root: /",j.ACTIVITY_LOGS.join("/")]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>C(t=>t+50),className:"p-4 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-2xl transition-all shadow-sm border border-slate-100",title:"Load More Records",children:e.jsx(q,{size:20,className:h?"animate-spin text-blue-500":""})}),e.jsxs("button",{onClick:D,className:"px-8 py-4 bg-slate-900 text-white rounded-2xl font-black text-[10px] uppercase tracking-[0.2em] hover:bg-blue-600 transition-all shadow-xl active:scale-95 flex items-center gap-3",children:[e.jsx(I,{size:18})," Export CSV"]})]})]}),f&&e.jsxs("div",{className:"mx-8 mt-6 bg-rose-50 border-2 border-rose-100 p-4 rounded-2xl flex items-center gap-4 text-rose-600 animate-in shake",children:[e.jsx(_,{size:20}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest",children:f})]}),e.jsxs("div",{className:"p-6 bg-white border-b border-slate-100 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 shrink-0",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(O,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors",size:18}),e.jsx("input",{type:"text",placeholder:"Zoek op gebruiker, ID of detail...",className:"w-full pl-12 pr-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl text-xs font-bold outline-none focus:border-blue-500 transition-all shadow-inner",value:p,onChange:t=>setSearchTerm(t.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300",size:18}),e.jsxs("select",{className:"w-full pl-12 pr-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl text-xs font-black uppercase tracking-widest text-slate-700 outline-none focus:border-blue-500 appearance-none cursor-pointer",value:m,onChange:t=>A(t.target.value),children:[e.jsx("option",{value:"ALL",children:"Alle Activiteiten"}),T.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(v,{size:16,className:"absolute right-5 top-1/2 -translate-y-1/2 text-slate-300 rotate-90"})]}),e.jsx("div",{className:"flex items-center justify-end px-4 gap-6 text-[10px] font-black text-slate-400 uppercase tracking-widest bg-slate-50/50 rounded-2xl border border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),e.jsxs("span",{children:["Resultaat:"," ",e.jsx("span",{className:"text-blue-600",children:d.length})]})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar",children:e.jsx("div",{className:"max-w-6xl mx-auto space-y-2 pb-40",children:h?e.jsxs("div",{className:"py-20 text-center flex flex-col items-center gap-4 opacity-50",children:[e.jsx(M,{className:"animate-spin text-blue-500",size:40}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Audit Trail Sync..."})]}):d.length===0?e.jsxs("div",{className:"py-32 text-center bg-white rounded-[40px] border-2 border-dashed border-slate-100",children:[e.jsx(U,{size:64,className:"mx-auto mb-4 text-slate-200"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-[0.3em] text-slate-300",children:"Geen logs gevonden"})]}):d.map(t=>{var r,l,s;return e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-100 hover:border-blue-200 hover:shadow-md transition-all group flex items-center gap-6",children:[e.jsxs("div",{className:"w-32 shrink-0 flex flex-col border-r border-slate-50",children:[e.jsx("span",{className:"text-xs font-black text-slate-900 tracking-tighter italic",children:x(t.timestamp,"dd MMM yyyy",{locale:F})}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400 tracking-widest uppercase",children:x(t.timestamp,"HH:mm:ss")})]}),e.jsxs("div",{className:"w-64 shrink-0 flex items-center gap-3 overflow-hidden border-r border-slate-50 px-2 text-left",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-slate-900 text-white flex items-center justify-center font-black text-[11px] shadow-lg shrink-0",children:((r=t.userEmail)==null?void 0:r.charAt(0).toUpperCase())||"S"}),e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[e.jsx("span",{className:"text-xs font-black text-slate-700 truncate uppercase tracking-tight",children:t.userEmail||"Systeem"}),e.jsxs("span",{className:"text-[8px] font-mono text-slate-300 uppercase",children:["UID: ",(l=t.userId)==null?void 0:l.substring(0,8)]})]})]}),e.jsx("div",{className:"w-48 shrink-0 flex justify-center border-r border-slate-50 px-2",children:e.jsx("span",{className:`px-4 py-1.5 rounded-lg text-[9px] font-black uppercase tracking-widest border shadow-sm ${E(t.action)}`,children:(s=t.action)==null?void 0:s.replace("PRODUCT_","").replace("MATRIX_","").replace("TOOL_","")})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-bold text-slate-600 leading-none group-hover:text-blue-600 transition-colors",children:t.details||"Details..."})}),e.jsx(v,{size:16,className:"text-slate-100 group-hover:text-blue-400 transition-all opacity-0 group-hover:opacity-100"})]},t.id)})})})]})};export{se as default};
