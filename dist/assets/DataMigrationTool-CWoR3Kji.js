import{j as e,D as v,S as P,L as k,X as z,d as S,l as O,G as I,a6 as E,e as r}from"./index-DNbqce-j.js";import{r as u}from"./react-vendor-CkwvfVK2.js";import{D,j as T,l as b,p as f,G as _,s as j,t as A}from"./firebase-DdpHYWNd.js";import{D as M,A as L}from"./AdminDashboard-BkhDkzix.js";import{S as G,T as B}from"./terminal-BLbu_z5A.js";import{P as F}from"./play-CtmZkelb.js";import"./arrow-left-CeHKlJCF.js";import"./users-BzjIxhpA.js";import"./clock-yngyoSLs.js";import"./book-open-Dw5UZXUq.js";const ee=()=>{const[c,g]=u.useState("idle"),[w,N]=u.useState([]),[d,y]=u.useState({}),[x,C]=u.useState("fittings-app-v1"),p=[{label:"Product Catalogus",id:"products",newKey:"PRODUCTS",type:"collection"},{label:"Product Afbeeldingen",id:"product_images",newKey:"IMAGE_LIBRARY",type:"collection"},{label:"Product Conversies",id:"product_conversions",newKey:"CONVERSION_MATRIX",type:"collection"},{label:"Digitale Planning",id:"digital_planning",newKey:"PLANNING",type:"collection"},{label:"Live Tracking",id:"tracked_products",newKey:"TRACKING",type:"collection"},{label:"Machine Bezetting",id:"machine_occupancy",newKey:"OCCUPANCY",type:"collection"},{label:"Inventaris & Moffen",id:"moffen",newKey:"INVENTORY",type:"collection"},{label:"CB Mof Dimensies",id:"cb_dimensions",newKey:"CB_DIMENSIONS",type:"collection"},{label:"TB Mof Dimensies",id:"tb_dimensions",newKey:"TB_DIMENSIONS",type:"collection"},{label:"Fitting Specs",id:"standard_fitting_specs",newKey:"FITTING_SPECS",type:"collection"},{label:"Socket Specs",id:"standard_socket_specs",newKey:"SOCKET_SPECS",type:"collection"},{label:"Gebruikers & Rollen",id:"user_roles",newKey:"USERS",type:"collection"},{label:"Personeel Database",id:"personnel",newKey:"PERSONNEL",type:"collection"},{label:"Berichten & Inbox",id:"messages",newKey:"MESSAGES",type:"collection"},{label:"Fabriek Configuratie",id:"config/factory_config",newKey:"FACTORY_CONFIG",type:"document"},{label:"Algemene Instellingen",id:"app_settings/general",newKey:"GENERAL_SETTINGS",type:"document"},{label:"Algemene Config (Alt)",id:"settings/general_config",newKey:"GENERAL_SETTINGS",type:"document",skipIfExists:!0},{label:"Productie Structuur",id:"settings/production_structure",newKey:"FACTORY_CONFIG",type:"document",merge:!0},{label:"Product Blueprints",id:"settings/product_templates",newKey:"BLUEPRINTS",type:"document"},{label:"Technische Tekeningen",id:"library_drawings",newKey:"DRAWING_LIBRARY",type:"collection"},{label:"Label Templates",id:"label_templates",newKey:"LABEL_TEMPLATES",type:"collection"},{label:"AI Knowledge Base",id:"ai_knowledge_base",newKey:"AI_KNOWLEDGE_BASE",type:"collection"}],s=t=>N(l=>[`[${new Date().toLocaleTimeString()}] ${t}`,...l].slice(0,100)),K=async()=>{g("scanning"),y({}),N([]),s(`üîç Scan gestart voor bron: /artifacts/${x}/public/data/`),s(`üìä Controleren van ${p.length} data bronnen...`);const t={};let l=0,o=0;for(const a of p)try{const n=E(x,...a.id.split("/"));if(a.type==="collection"){const i=await D(T(r,...n));t[a.id]=i.size,i.size>0?(s(`‚úÖ ${a.label}: ${i.size} documenten`),l++,o+=i.size):s(`‚ö™ ${a.label}: leeg`)}else try{const i=b(r,...n);(await f(i)).exists()?(t[a.id]=1,s(`‚úÖ ${a.label}: configuratie gevonden`),l++):(t[a.id]=0,s(`‚ö™ ${a.label}: niet gevonden`))}catch{t[a.id]=0,s(`‚ö™ ${a.label}: niet gevonden`)}}catch{s(`‚ùå ${a.label}: pad niet toegankelijk`),t[a.id]=0}y(t),s("---"),s(`üìà Scan compleet: ${l}/${p.length} bronnen gevonden`),s(`üì¶ Totaal: ${o} documenten gereed voor migratie`),g("ready")},R=async()=>{if(window.confirm(`Weet je zeker dat je de data wilt kopi√´ren naar de nieuwe root?

Dit overschrijft bestaande data met dezelfde ID's.`)){g("running"),s("üöÄ Migratie proces gestart...");try{for(const t of p){if(!d[t.id]){s(`‚è≠Ô∏è  Overgeslagen: ${t.label} (geen data gevonden)`);continue}const l=E(x,...t.id.split("/")),o=S[t.newKey];if(!o){s(`‚ùå FOUT: Geen mapping gevonden voor ${t.newKey}`);continue}if(s(`üì¶ Verhuizen: ${t.label} -> /${o.join("/")}`),t.type==="collection"){const a=await D(T(r,...l));let n=_(r),i=0,m=0;for(const h of a.docs){const $=b(r,...o,h.id);n.set($,{...h.data(),migratedAt:j(),sourceNode:x},{merge:!0}),i++,m++,i>=450&&(await n.commit(),s(`   ‚úì Batch committed (${m} docs)`),n=_(r),i=0)}i>0&&await n.commit(),s(`   ‚úÖ Compleet: ${m} documenten gemigreerd`)}else if(t.type==="document")try{if(t.skipIfExists){const m=b(r,...o);if((await f(m)).exists()){s(`   ‚è≠Ô∏è  Overgeslagen: ${t.label} (bestaat al)`);continue}}const a=b(r,...l),n=await f(a);if(!n.exists()){s(`   ‚ö†Ô∏è  Document niet gevonden: ${t.label}`);continue}const i=b(r,...o);t.merge?(await A(i,{...n.data(),migratedAt:j(),sourceNode:x},{merge:!0}),s(`   ‚úÖ Gemerged: ${t.label}`)):(await A(i,{...n.data(),migratedAt:j(),sourceNode:x}),s(`   ‚úÖ Compleet: ${t.label}`))}catch(a){s(`   ‚ùå Fout bij ${t.label}: ${a.message}`)}}g("done"),s("--- üéâ MIGRATIE VOLTOOID ---"),s("Alle data is succesvol gekopieerd naar de nieuwe root structuur.")}catch(t){s(`‚ùå KRITIEKE FOUT: ${t.message}`),console.error("Migration error:",t),g("error")}}};return e.jsxs("div",{className:"p-6 md:p-10 max-w-6xl mx-auto text-left space-y-8 animate-in fade-in pb-40",children:[e.jsxs("div",{className:"bg-slate-900 p-8 md:p-10 rounded-[45px] text-white shadow-2xl relative overflow-hidden border border-white/5",children:[e.jsx("div",{className:"absolute top-0 right-0 p-10 opacity-5 rotate-12",children:e.jsx(M,{size:200})}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row justify-between items-center gap-10",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"p-5 bg-blue-600 rounded-3xl shadow-xl shadow-blue-900/40",children:e.jsx(v,{size:40,strokeWidth:2.5})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("h2",{className:"text-3xl font-black uppercase italic tracking-tighter leading-none",children:["Root ",e.jsx("span",{className:"text-blue-500",children:"Migrator"})]}),e.jsxs("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-[0.3em] mt-3 flex items-center gap-2",children:[e.jsx(P,{size:14,className:"text-emerald-500"})," Versie 6.0 | Secure Path Sync"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-2xl px-4 py-2 flex flex-col justify-center",children:[e.jsx("span",{className:"text-[8px] text-slate-500 uppercase font-black tracking-widest",children:"Bron ID"}),e.jsx("input",{value:x,onChange:t=>C(t.target.value),className:"bg-transparent font-mono text-sm text-emerald-400 font-bold outline-none border-none p-0 w-32"})]}),e.jsxs("button",{onClick:K,disabled:c==="scanning"||c==="running",className:"px-8 py-4 bg-blue-600 hover:bg-blue-500 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl flex items-center gap-3 transition-all active:scale-95 disabled:opacity-50",children:[c==="scanning"?e.jsx(k,{size:18,className:"animate-spin"}):e.jsx(G,{size:18})," ","Scan Artifacts"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[c==="ready"&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-[30px] p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs font-black text-blue-900 uppercase tracking-widest mb-1",children:"Scan Compleet"}),e.jsxs("p",{className:"text-2xl font-black text-blue-600",children:[Object.values(d).filter(t=>t>0).length,"/",p.length,e.jsx("span",{className:"text-sm font-bold text-blue-400 ml-2",children:"bronnen gevonden"})]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-2",children:[Object.values(d).reduce((t,l)=>t+l,0)," totaal documenten"]})]}),e.jsx(v,{size:48,className:"text-blue-300"})]}),e.jsx("div",{className:"max-h-[600px] overflow-y-auto custom-scrollbar pr-2",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:p.map(t=>{var l;return e.jsxs("div",{className:`bg-white p-6 rounded-[30px] border-2 transition-all shadow-sm ${d[t.id]>0?"border-emerald-100 bg-emerald-50/20":"border-slate-50 opacity-40 grayscale"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"font-black text-slate-900 uppercase italic text-xs tracking-tight leading-tight",children:t.label}),e.jsx("p",{className:"text-[9px] font-mono text-slate-400 mt-1 break-all",children:t.id})]}),d[t.id]>0?e.jsx("span",{className:"text-sm font-black text-blue-600 bg-blue-50 px-2 py-1 rounded-lg ml-2 shrink-0",children:d[t.id]}):e.jsx(z,{size:14,className:"text-slate-300 ml-2 shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-3 border-t border-slate-50",children:[e.jsx(L,{size:10,className:"text-slate-300 shrink-0"}),e.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase italic break-all",children:(l=S[t.newKey])==null?void 0:l.join("/")})]})]},t.id)})})}),c==="ready"&&Object.values(d).some(t=>t>0)&&e.jsxs("button",{onClick:R,className:"w-full py-7 bg-slate-900 text-white rounded-[35px] font-black uppercase text-xs tracking-[0.3em] shadow-2xl hover:bg-emerald-600 transition-all flex items-center justify-center gap-4 active:scale-95 animate-in slide-in-from-bottom-2",children:[e.jsx(F,{size:20,fill:"currentColor"})," Start Volledige Migratie"]}),c==="done"&&e.jsxs("div",{className:"bg-emerald-50 border-2 border-emerald-200 p-8 rounded-[40px] flex items-center gap-6 animate-in zoom-in",children:[e.jsx("div",{className:"p-4 bg-emerald-500 text-white rounded-2xl shadow-lg",children:e.jsx(O,{size:32})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-black text-emerald-900 uppercase text-sm tracking-widest leading-none mb-2",children:"Success!"}),e.jsx("p",{className:"text-xs text-emerald-700 font-medium italic",children:"Alle data is gekopieerd naar de nieuwe root. Je kunt nu veilig overschakelen."})]})]})]}),e.jsx("div",{className:"lg:col-span-5",children:e.jsxs("div",{className:"bg-slate-900 rounded-[45px] p-8 border border-white/5 shadow-2xl flex flex-col h-[600px]",children:[e.jsxs("div",{className:"flex items-center gap-3 text-slate-500 mb-6 border-b border-white/5 pb-5",children:[e.jsx(B,{size:16,className:"text-blue-500"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"Migration Logic Feed"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-2 text-left",children:[w.map((t,l)=>e.jsx("div",{className:`text-[9px] font-mono leading-relaxed p-2.5 rounded-xl ${t.includes("‚úÖ")||t.includes("SUCCES")||t.includes("üéâ")?"bg-emerald-500/10 text-emerald-400 border-l-2 border-emerald-500":t.includes("‚ùå")?"bg-rose-500/10 text-rose-400 border-l-2 border-rose-500":"bg-white/5 text-blue-300/60 border-l-2 border-blue-500/30"}`,children:t},l)),w.length===0&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-20 text-slate-400 italic",children:[e.jsx(I,{size:32,className:"mb-2"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Wacht op scan..."})]})]}),c==="running"&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-white/5 animate-pulse flex items-center justify-center gap-3 text-blue-400",children:[e.jsx(k,{size:16,className:"animate-spin"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Verwerking Bezig..."})]})]})})]}),e.jsxs("div",{className:"max-w-4xl mx-auto p-10 bg-blue-50 rounded-[50px] border-2 border-blue-100 flex flex-col md:flex-row items-center gap-8 shadow-inner text-left",children:[e.jsx("div",{className:"p-4 bg-blue-600 rounded-3xl text-white shadow-lg",children:e.jsx(I,{size:32})}),e.jsxs("div",{className:"space-y-3 text-left",children:[e.jsx("h4",{className:"text-sm font-black uppercase text-blue-900 tracking-widest italic",children:"Belangrijke Migratie-Instructies:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-2 text-[10px] font-bold text-blue-700/70 uppercase leading-relaxed",children:[e.jsx("p",{children:"‚Ä¢ Deze tool KOPIEERT data, het verwijderd de oude data niet."}),e.jsxs("p",{children:["‚Ä¢ Na migratie moet je de code omschakelen via"," ",e.jsx("code",{children:"dbPaths.js"}),"."]}),e.jsx("p",{children:"‚Ä¢ Batched updates worden gebruikt voor optimale snelheid."}),e.jsx("p",{children:"‚Ä¢ De tool overschrijft bestaande records in de root met dezelfde ID's."})]})]})]})]})};export{ee as default};
